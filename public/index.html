
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ü¶Ç ÿ¥ÿßÿ™ Ÿàÿ™ŸäŸÜ ÿßŸÑÿπŸÇÿ±ÿ®</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ==================== CSS ŸÉÿßŸÖŸÑ ŸàŸÖÿπÿØŸÑ ==================== */
        /* ÿ•ÿπÿßÿØÿ© ÿ™ÿπŸäŸäŸÜ ÿßŸÑÿ£ŸÜŸÖÿßÿ∑ ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿäÿ© */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        :root {
            /* ÿßŸÑÿ£ŸÑŸàÿßŸÜ ÿßŸÑÿ£ÿ≥ÿßÿ≥Ÿäÿ© - ÿ™ÿØÿ±ÿ¨ Ÿàÿ±ÿØŸä ÿ£ŸÜŸäŸÇ */
            --primary-color: #e91e63;
            --primary-light: #f8bbd9;
            --primary-dark: #ad1457;
            --secondary-color: #9c27b0;
            --accent-color: #ff4081;
            --success-color: #4CAF50;
            --warning-color: #ff9800;
            --error-color: #f44336;
            --info-color: #2196F3;
            /* ÿ£ŸÑŸàÿßŸÜ ÿßŸÑÿÆŸÑŸÅŸäÿ© */
            --bg-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --bg-secondary: rgba(255, 255, 255, 0.95);
            --bg-tertiary: rgba(255, 255, 255, 0.1);
            --bg-card: rgba(255, 255, 255, 0.9);
            --bg-modal: rgba(0, 0, 0, 0.8);
            --bg-sidebar: rgba(255, 255, 255, 0.98);
            /* ÿ£ŸÑŸàÿßŸÜ ÿßŸÑŸÜÿµ */
            --text-primary: #2c3e50;
            --text-secondary: #7f8c8d;
            --text-muted: #bdc3c7;
            --text-white: #ffffff;
            /* ÿßŸÑÿ≠ÿØŸàÿØ ŸàÿßŸÑÿ∏ŸÑÿßŸÑ */
            --border-color: rgba(0, 0, 0, 0.1);
            --border-light: rgba(255, 255, 255, 0.2);
            --shadow-light: 0 2px 10px rgba(0, 0, 0, 0.1);
            --shadow-medium: 0 4px 20px rgba(0, 0, 0, 0.15);
            --shadow-heavy: 0 8px 30px rgba(0, 0, 0, 0.25);
            --shadow-glow: 0 0 20px rgba(233, 30, 99, 0.3);
            /* ÿßŸÑŸÖÿ≥ÿßŸÅÿßÿ™ */
            --spacing-xs: 0.25rem;
            --spacing-sm: 0.5rem;
            --spacing-md: 1rem;
            --spacing-lg: 1.5rem;
            --spacing-xl: 2rem;
            --spacing-xxl: 3rem;
            /* ÿßŸÑÿÆÿ∑Ÿàÿ∑ */
            --font-family: 'Segoe UI', 'Cairo', Tahoma, Geneva, Verdana, sans-serif;
            --font-size-xs: 0.75rem;
            --font-size-sm: 0.875rem;
            --font-size-md: 1rem;
            --font-size-lg: 1.125rem;
            --font-size-xl: 1.25rem;
            --font-size-xxl: 1.5rem;
            /* ÿßŸÑÿßŸÜÿ™ŸÇÿßŸÑÿßÿ™ */
            --transition-fast: 0.2s ease;
            --transition-medium: 0.3s ease;
            --transition-slow: 0.5s ease;
            /* ŸÜÿµŸÅ ÿßŸÑŸÇÿ∑ÿ± */
            --radius-sm: 6px;
            --radius-md: 12px;
            --radius-lg: 18px;
            --radius-xl: 24px;
            --radius-full: 50%;
        }
        body {
            font-family: var(--font-family);
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            direction: rtl;
            line-height: 1.6;
        }
        /* ÿßŸÑÿ¥ÿßÿ¥ÿßÿ™ */
        .screen {
            display: none;
            min-height: 100vh;
        }
        .screen.active {
            display: block;
        }
        /* ÿ¥ÿßÿ¥ÿ© ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ */
        #loginScreen {
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--bg-primary);
            position: relative;
            overflow: hidden;
        }
        #loginScreen::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('https://images.pexels.com/photos/1323550/pexels-photo-1323550.jpeg?auto=compress&cs=tinysrgb&w=1920&h=1080&fit=crop') center/cover;
            opacity: 0.1;
            z-index: 0;
        }
        .login-container {
            background: var(--bg-card);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-xl);
            padding: var(--spacing-xxl);
            width: 100%;
            max-width: 420px;
            box-shadow: var(--shadow-heavy);
            position: relative;
            z-index: 1;
            animation: slideInUp 0.6s ease;
        }
        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .login-header {
            text-align: center;
            margin-bottom: var(--spacing-xl);
        }
        .logo h1 {
            font-size: var(--font-size-xxl);
            margin-bottom: var(--spacing-sm);
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 700;
        }
        .logo p {
            color: var(--text-secondary);
            font-size: var(--font-size-sm);
        }
        .login-tabs {
            display: flex;
            margin-bottom: var(--spacing-lg);
            background: var(--bg-tertiary);
            border-radius: var(--radius-md);
            padding: var(--spacing-xs);
            gap: var(--spacing-xs);
        }
        .tab-btn {
            flex: 1;
            padding: var(--spacing-md);
            border: none;
            background: transparent;
            color: var(--text-secondary);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: var(--transition-fast);
            font-size: var(--font-size-sm);
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-sm);
        }
        .tab-btn.active {
            background: var(--primary-color);
            color: var(--text-white);
            box-shadow: var(--shadow-light);
            transform: translateY(-1px);
        }
        .auth-form {
            display: none;
        }
        .auth-form.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .input-group {
            position: relative;
            margin-bottom: var(--spacing-lg);
        }
        .input-group i {
            position: absolute;
            right: var(--spacing-md);
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
            z-index: 1;
        }
        .input-group input,
        .input-group select {
            width: 100%;
            padding: var(--spacing-md) var(--spacing-xl);
            border: 2px solid var(--border-color);
            border-radius: var(--radius-md);
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-size: var(--font-size-md);
            transition: var(--transition-fast);
            font-family: var(--font-family);
        }
        .input-group input:focus,
        .input-group select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(233, 30, 99, 0.1);
            transform: translateY(-1px);
        }
        .auth-btn {
            width: 100%;
            padding: var(--spacing-lg);
            border: none;
            border-radius: var(--radius-md);
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            color: var(--text-white);
            font-size: var(--font-size-md);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition-fast);
            box-shadow: var(--shadow-medium);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-sm);
        }
        .auth-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-heavy);
        }
        .auth-btn:active {
            transform: translateY(0);
        }
        /* ÿ¥ÿßÿ¥ÿ© ÿßŸÑÿ≠ÿ∏ÿ± */
        #banScreen {
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--error-color) 0%, #d32f2f 100%);
        }
        .ban-container {
            text-align: center;
            background: var(--bg-card);
            backdrop-filter: blur(20px);
            border-radius: var(--radius-xl);
            padding: var(--spacing-xxl);
            max-width: 500px;
            box-shadow: var(--shadow-heavy);
            animation: slideInUp 0.6s ease;
        }
        .ban-icon {
            font-size: 4rem;
            margin-bottom: var(--spacing-lg);
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        .ban-reason {
            font-size: var(--font-size-lg);
            margin: var(--spacing-lg) 0;
            color: var(--text-secondary);
            background: var(--bg-tertiary);
            padding: var(--spacing-lg);
            border-radius: var(--radius-md);
            border-right: 4px solid var(--error-color);
        }
        .contact-info {
            margin: var(--spacing-lg) 0;
            padding: var(--spacing-lg);
            background: var(--bg-tertiary);
            border-radius: var(--radius-md);
        }
        .contact-info a {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 600;
            transition: var(--transition-fast);
        }
        .contact-info a:hover {
            text-decoration: underline;
        }
        /* ÿßŸÑÿ¥ÿßÿ¥ÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ© */
        #mainScreen {
            display: flex;
            flex-direction: column;
            height: 100vh;
            background: var(--bg-secondary);
        }
        /* ÿßŸÑÿ¥ÿ±Ÿäÿ∑ ÿßŸÑÿπŸÑŸàŸä */
        .main-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--spacing-md) var(--spacing-lg);
            background: var(--bg-card);
            border-bottom: 1px solid var(--border-color);
            box-shadow: var(--shadow-light);
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
        }
        .header-left {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }
        .hamburger-btn {
            padding: var(--spacing-sm);
            border: none;
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: var(--transition-fast);
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .hamburger-btn:hover {
            background: var(--primary-color);
            color: var(--text-white);
            transform: translateY(-1px);
        }
        .app-logo h1 {
            font-size: var(--font-size-xl);
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 0;
            font-weight: 700;
        }
        .header-center {
            flex: 1;
            display: flex;
            justify-content: center;
            max-width: 300px;
            margin: 0 var(--spacing-lg);
        }
        .room-selector select {
            padding: var(--spacing-sm) var(--spacing-md);
            border: 2px solid var(--border-color);
            border-radius: var(--radius-md);
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-size: var(--font-size-sm);
            cursor: pointer;
            transition: var(--transition-fast);
            min-width: 200px;
        }
        .room-selector select:focus {
            outline: none;
            border-color: var(--primary-color);
        }
        .header-right {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }
        .header-btn {
            position: relative;
            padding: var(--spacing-sm);
            border: none;
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: var(--transition-fast);
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .header-btn:hover {
            background: var(--primary-color);
            color: var(--text-white);
            transform: translateY(-1px);
        }
        .notification-badge {
            position: absolute;
            top: -5px;
            left: -5px;
            background: var(--error-color);
            color: white;
            border-radius: var(--radius-full);
            padding: 2px 6px;
            font-size: var(--font-size-xs);
            min-width: 18px;
            text-align: center;
            animation: bounce 2s infinite;
        }
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-5px); }
            60% { transform: translateY(-3px); }
        }
        .user-profile-mini {
            display: flex;
            align-items: center;
            cursor: pointer;
            padding: var(--spacing-sm);
            border-radius: var(--radius-md);
            transition: var(--transition-fast);
            margin-right: var(--spacing-md);
            background: var(--bg-tertiary);
        }
        .user-profile-mini:hover {
            background: var(--primary-light);
            transform: translateY(-1px);
        }
        .user-avatar-mini {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-full);
            margin-left: var(--spacing-md);
            border: 2px solid var(--primary-color);
            object-fit: cover;
        }
        .user-info-mini {
            display: flex;
            flex-direction: column;
        }
        .user-name {
            font-weight: 600;
            font-size: var(--font-size-md);
            color: var(--text-primary);
        }
        .user-rank {
            font-size: var(--font-size-xs);
            color: var(--text-secondary);
        }
        /* ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿä */
        .main-content {
            display: flex;
            flex: 1;
            overflow: hidden;
        }
        /* ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿØÿ±ÿØÿ¥ÿ© */
        .chat-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            background: var(--bg-secondary);
        }
        .chat-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--spacing-lg);
            background: var(--bg-card);
            border-bottom: 1px solid var(--border-color);
        }
        .chat-header h2 {
            margin: 0;
            color: var(--text-primary);
            font-size: var(--font-size-xl);
        }
        .chat-controls {
            display: flex;
            gap: var(--spacing-sm);
        }
        .control-btn {
            padding: var(--spacing-sm) var(--spacing-md);
            border: none;
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: var(--transition-fast);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            font-size: var(--font-size-sm);
        }
        .control-btn:hover {
            background: var(--primary-color);
            color: var(--text-white);
            transform: translateY(-1px);
        }
        .messages-container {
            flex: 1;
            overflow-y: auto;
            padding: var(--spacing-lg);
            background: var(--bg-secondary);
            scroll-behavior: smooth;
        }
        .welcome-message {
            text-align: center;
            padding: var(--spacing-xxl);
            margin: var(--spacing-xl) 0;
        }
        .welcome-content {
            background: var(--bg-card);
            padding: var(--spacing-xl);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-light);
            border: 1px solid var(--border-color);
        }
        .welcome-content h3 {
            color: var(--primary-color);
            margin-bottom: var(--spacing-md);
            font-size: var(--font-size-xl);
        }
        .welcome-content p {
            color: var(--text-secondary);
        }
        .message {
            display: flex;
            margin-bottom: var(--spacing-lg);
            animation: messageSlideIn 0.4s ease;
            align-items: flex-start;
        }
        @keyframes messageSlideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .message.own {
            flex-direction: row-reverse;
        }
        .message-avatar {
            width: 45px;
            height: 45px;
            border-radius: var(--radius-full);
            margin: 0 var(--spacing-md);
            border: 2px solid var(--primary-color);
            cursor: pointer;
            object-fit: cover;
            transition: var(--transition-fast);
        }
        .message-avatar:hover {
            transform: scale(1.1);
            box-shadow: var(--shadow-glow);
        }
        .message-content {
            max-width: 70%;
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            padding: var(--spacing-md);
            position: relative;
            backdrop-filter: blur(10px);
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-light);
            transition: var(--transition-fast);
        }
        .message-content:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-medium);
        }
        .message.own .message-content {
            background: linear-gradient(45deg, var(--primary-color), var(--primary-light));
            color: var(--text-white);
        }
        .message-header {
            display: flex;
            align-items: center;
            margin-bottom: var(--spacing-sm);
            flex-wrap: wrap;
            gap: var(--spacing-sm);
        }
        .message-author {
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition-fast);
        }
        .message-author:hover {
            color: var(--primary-color);
        }
        .message-rank {
            font-size: var(--font-size-xs);
            padding: 2px 8px;
            border-radius: var(--radius-sm);
            background: var(--accent-color);
            color: white;
            font-weight: 500;
        }
        .message-time {
            font-size: var(--font-size-xs);
            color: var(--text-muted);
            margin-right: auto;
        }
        .message-text {
            line-height: 1.6;
            word-wrap: break-word;
            font-size: var(--font-size-md);
        }
        .message-media {
            margin-top: var(--spacing-sm);
        }
        .message-image {
            max-width: 100%;
            max-height: 300px;
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: var(--transition-fast);
        }
        .message-image:hover {
            transform: scale(1.02);
        }
        .message-audio {
            width: 100%;
            margin-top: var(--spacing-sm);
            border-radius: var(--radius-md);
        }
        .quoted-message {
            background: var(--bg-tertiary);
            border-right: 3px solid var(--primary-color);
            padding: var(--spacing-sm) var(--spacing-md);
            margin-bottom: var(--spacing-sm);
            border-radius: var(--radius-sm);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .quoted-content {
            flex: 1;
        }
        .quoted-author {
            font-weight: 600;
            color: var(--primary-color);
            font-size: var(--font-size-sm);
        }
        .quoted-text {
            color: var(--text-secondary);
            font-size: var(--font-size-sm);
            margin-right: var(--spacing-sm);
        }
        .cancel-quote {
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: var(--spacing-xs);
            border-radius: var(--radius-sm);
            transition: var(--transition-fast);
        }
        .cancel-quote:hover {
            background: var(--error-color);
            color: white;
        }
        .message-input-container {
            padding: var(--spacing-lg);
            background: var(--bg-card);
            border-top: 1px solid var(--border-color);
            backdrop-filter: blur(10px);
        }
        .input-tools {
            display: flex;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-md);
            flex-wrap: wrap;
        }
        .tool-btn {
            padding: var(--spacing-sm);
            border: none;
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: var(--transition-fast);
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .tool-btn:hover {
            background: var(--primary-color);
            color: var(--text-white);
            transform: translateY(-1px);
        }
        .tool-btn.recording {
            background: var(--error-color);
            color: white;
            animation: pulse 1s infinite;
        }
        .message-input-wrapper {
            display: flex;
            gap: var(--spacing-sm);
            align-items: flex-end;
        }
        #messageInput {
            flex: 1;
            padding: var(--spacing-md);
            border: 2px solid var(--border-color);
            border-radius: var(--radius-md);
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-size: var(--font-size-md);
            resize: none;
            min-height: 50px;
            max-height: 120px;
            font-family: var(--font-family);
            transition: var(--transition-fast);
        }
        #messageInput:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(233, 30, 99, 0.1);
        }
        .send-btn {
            padding: var(--spacing-md);
            border: none;
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            color: var(--text-white);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: var(--transition-fast);
            min-width: 60px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-light);
        }
        .send-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
        }
        /* ÿßŸÑÿ¥ÿ±Ÿäÿ∑ ÿßŸÑÿ¨ÿßŸÜÿ®Ÿä ŸÑŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ */
        .users-sidebar {
            width: 320px;
            background: var(--bg-sidebar);
            border-right: 1px solid var(--border-color);
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            backdrop-filter: blur(10px);
        }
        .sidebar-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--spacing-lg);
            border-bottom: 1px solid var(--border-color);
            background: var(--bg-card);
        }
        .sidebar-header h3 {
            margin: 0;
            color: var(--text-primary);
            font-size: var(--font-size-lg);
            font-weight: 600;
        }
        .online-count {
            background: var(--success-color);
            color: white;
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--radius-full);
            font-size: var(--font-size-xs);
            font-weight: 600;
            animation: pulse 2s infinite;
        }
        .users-list {
            flex: 1;
            padding: var(--spacing-md);
        }
        .user-item {
            display: flex;
            align-items: center;
            padding: var(--spacing-md);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: var(--transition-fast);
            border: 1px solid transparent;
            margin-bottom: var(--spacing-sm);
            background: var(--bg-card);
        }
        .user-item:hover {
            background: var(--primary-light);
            border-color: var(--primary-color);
            transform: translateY(-1px);
            box-shadow: var(--shadow-light);
        }
        .user-avatar {
            width: 45px;
            height: 45px;
            border-radius: var(--radius-full);
            margin-left: var(--spacing-md);
            border: 2px solid var(--success-color);
            object-fit: cover;
        }
        .user-details {
            flex: 1;
        }
        .user-display-name {
            font-weight: 600;
            margin-bottom: 2px;
            color: var(--text-primary);
        }
        .user-status {
            font-size: var(--font-size-xs);
            color: var(--text-muted);
        }
        /* ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑÿ™ÿ≠ŸÉŸÖ ÿßŸÑÿ≥ŸÅŸÑŸä */
        .bottom-control-bar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--spacing-md) var(--spacing-lg);
            background: var(--bg-card);
            border-top: 1px solid var(--border-color);
            backdrop-filter: blur(10px);
            flex-wrap: wrap;
            gap: var(--spacing-md);
        }
        .music-controls {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }
        .volume-control {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }
        .volume-control i {
            color: var(--text-secondary);
        }
        #volumeSlider {
            width: 100px;
            height: 4px;
            border-radius: var(--radius-sm);
            background: var(--bg-tertiary);
            outline: none;
            cursor: pointer;
        }
        #volumeSlider::-webkit-slider-thumb {
            appearance: none;
            width: 16px;
            height: 16px;
            border-radius: var(--radius-full);
            background: var(--primary-color);
            cursor: pointer;
        }
        .now-playing {
            flex: 1;
            text-align: center;
            color: var(--text-secondary);
            font-size: var(--font-size-sm);
            padding: var(--spacing-sm);
            background: var(--bg-tertiary);
            border-radius: var(--radius-md);
        }
        .song-title {
            font-weight: 500;
        }
        /* ÿßŸÑŸÖŸàÿØÿßŸÑÿßÿ™ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg-modal);
            z-index: 1000;
            backdrop-filter: blur(5px);
            align-items: center;
            justify-content: center;
        }
        .modal.show {
            display: flex;
        }
        .modal-content {
            background: var(--bg-card);
            border-radius: var(--radius-xl);
            max-width: 90vw;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-heavy);
            border: 1px solid var(--border-color);
            position: relative;
            animation: modalSlideIn 0.3s ease;
        }
        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: scale(0.9) translateY(-20px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }
        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--spacing-lg);
            border-bottom: 1px solid var(--border-color);
            position: sticky;
            top: 0;
            background: var(--bg-card);
            z-index: 1;
            backdrop-filter: blur(10px);
        }
        .modal-header h2 {
            margin: 0;
            color: var(--text-primary);
            font-size: var(--font-size-xl);
            font-weight: 600;
        }
        .close-btn {
            padding: var(--spacing-sm);
            border: none;
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: var(--transition-fast);
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .close-btn:hover {
            background: var(--error-color);
            color: white;
            transform: rotate(90deg);
        }
        /* ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ© */
        .main-menu {
            width: 700px;
        }
        .menu-items {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: var(--spacing-lg);
            padding: var(--spacing-xl);
        }
        .menu-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: var(--spacing-xl);
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            cursor: pointer;
            transition: var(--transition-fast);
            border: 1px solid var(--border-color);
            text-align: center;
            box-shadow: var(--shadow-light);
        }
        .menu-item:hover {
            background: var(--primary-light);
            transform: translateY(-5px);
            box-shadow: var(--shadow-medium);
            border-color: var(--primary-color);
        }
        .menu-item i {
            font-size: 2.5rem;
            margin-bottom: var(--spacing-md);
            color: var(--primary-color);
        }
        .menu-item span {
            font-weight: 600;
            margin-bottom: var(--spacing-sm);
            font-size: var(--font-size-lg);
            color: var(--text-primary);
        }
        .menu-item p {
            font-size: var(--font-size-sm);
            color: var(--text-secondary);
            line-height: 1.5;
        }
        /* ŸÖŸàÿØÿßŸÑ ÿßŸÑŸÖŸÑŸÅ ÿßŸÑÿ¥ÿÆÿµŸä */
        .profile-modal {
            width: 900px;
        }
        .profile-content {
            padding: 0;
        }
        .profile-cover {
            position: relative;
            height: 250px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            overflow: hidden;
        }
        .profile-cover img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .change-cover-btn {
            position: absolute;
            bottom: var(--spacing-md);
            left: var(--spacing-md);
            padding: var(--spacing-sm) var(--spacing-md);
            border: none;
            background: var(--bg-card);
            color: var(--text-primary);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: var(--transition-fast);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            font-size: var(--font-size-sm);
        }
        .change-cover-btn:hover {
            background: var(--primary-color);
            color: white;
            transform: translateY(-1px);
        }
        .profile-info {
            padding: var(--spacing-xl);
        }
        .profile-avatar-section {
            margin-bottom: var(--spacing-xl);
        }
        .profile-avatars {
            display: flex;
            gap: var(--spacing-xl);
            justify-content: center;
            margin-top: -60px;
            margin-bottom: var(--spacing-xl);
        }
        .avatar-slot {
            position: relative;
            text-align: center;
        }
        .avatar-slot img {
            width: 120px;
            height: 120px;
            border-radius: var(--radius-full);
            border: 4px solid var(--bg-card);
            object-fit: cover;
            box-shadow: var(--shadow-medium);
            transition: var(--transition-fast);
        }
        .avatar-slot img:hover {
            transform: scale(1.05);
            box-shadow: var(--shadow-glow);
        }
        .avatar-slot button {
            position: absolute;
            bottom: 5px;
            right: 5px;
            width: 36px;
            height: 36px;
            border: none;
            background: var(--primary-color);
            color: var(--text-white);
            border-radius: var(--radius-full);
            cursor: pointer;
            transition: var(--transition-fast);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-light);
        }
        .avatar-slot button:hover {
            background: var(--secondary-color);
            transform: scale(1.1);
        }
        .profile-stats {
            display: flex;
            justify-content: center;
            gap: var(--spacing-xxl);
            margin: var(--spacing-xl) 0;
        }
        .stat-item {
            text-align: center;
            padding: var(--spacing-md);
            background: var(--bg-tertiary);
            border-radius: var(--radius-md);
            min-width: 100px;
        }
        .stat-number {
            display: block;
            font-size: var(--font-size-xxl);
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: var(--spacing-xs);
        }
        .stat-label {
            font-size: var(--font-size-sm);
            color: var(--text-secondary);
            font-weight: 500;
        }
        .profile-actions {
            display: flex;
            justify-content: center;
            gap: var(--spacing-md);
            margin-top: var(--spacing-lg);
        }
        .profile-details {
            margin-top: var(--spacing-xl);
        }
        .profile-tabs {
            display: flex;
            margin-bottom: var(--spacing-lg);
            border-bottom: 1px solid var(--border-color);
            gap: var(--spacing-sm);
        }
        .profile-tabs .tab-btn {
            padding: var(--spacing-md) var(--spacing-lg);
            border: none;
            background: transparent;
            color: var(--text-secondary);
            cursor: pointer;
            transition: var(--transition-fast);
            border-bottom: 3px solid transparent;
            border-radius: var(--radius-sm) var(--radius-sm) 0 0;
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            font-weight: 500;
        }
        .profile-tabs .tab-btn.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
            background: var(--bg-tertiary);
        }
        .profile-tab {
            display: none;
            padding: var(--spacing-lg);
        }
        .profile-tab.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        .info-section,
        .settings-section,
        .music-section,
        .decorations-section {
            margin-bottom: var(--spacing-xl);
        }
        .info-section label,
        .settings-section label,
        .music-section label,
        .decorations-section label {
            display: block;
            margin-bottom: var(--spacing-sm);
            color: var(--text-primary);
            font-weight: 600;
            font-size: var(--font-size-md);
        }
        .info-section input,
        .info-section select,
        .info-section textarea,
        .settings-section input,
        .settings-section select,
        .music-section input,
        .decorations-section input,
        .decorations-section select {
            width: 100%;
            padding: var(--spacing-md);
            border: 2px solid var(--border-color);
            border-radius: var(--radius-md);
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-size: var(--font-size-md);
            transition: var(--transition-fast);
            font-family: var(--font-family);
        }
        .info-section input:focus,
        .info-section select:focus,
        .info-section textarea:focus,
        .settings-section input:focus,
        .settings-section select:focus,
        .music-section input:focus,
        .decorations-section input:focus,
        .decorations-section select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(233, 30, 99, 0.1);
        }
        .info-section textarea {
            resize: vertical;
            min-height: 100px;
            line-height: 1.6;
        }
        .feature-note {
            font-size: var(--font-size-xs);
            color: var(--text-muted);
            margin-top: var(--spacing-sm);
            font-style: italic;
            padding: var(--spacing-sm);
            background: var(--bg-tertiary);
            border-radius: var(--radius-sm);
            border-right: 3px solid var(--warning-color);
        }
        /* ÿßŸÑÿ£ÿÆÿ®ÿßÿ± */
        .news-modal {
            width: 800px;
        }
        .news-post-form {
            padding: var(--spacing-xl);
            border-bottom: 1px solid var(--border-color);
            background: var(--bg-tertiary);
        }
        .news-post-form textarea {
            width: 100%;
            padding: var(--spacing-md);
            border: 2px solid var(--border-color);
            border-radius: var(--radius-md);
            background: var(--bg-secondary);
            color: var(--text-primary);
            resize: vertical;
            min-height: 120px;
            margin-bottom: var(--spacing-md);
            font-family: var(--font-family);
            line-height: 1.6;
        }
        .news-post-form textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(233, 30, 99, 0.1);
        }
        .news-form-actions {
            display: flex;
            gap: var(--spacing-md);
            align-items: center;
            flex-wrap: wrap;
        }
        .news-feed {
            max-height: 500px;
            overflow-y: auto;
            padding: var(--spacing-lg);
        }
        .news-item {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            margin-bottom: var(--spacing-lg);
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-light);
            transition: var(--transition-fast);
        }
        .news-item:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
        }
        .news-header-info {
            display: flex;
            align-items: center;
            margin-bottom: var(--spacing-md);
        }
        .news-author-avatar {
            width: 50px;
            height: 50px;
            border-radius: var(--radius-full);
            margin-left: var(--spacing-md);
            border: 2px solid var(--primary-color);
            object-fit: cover;
        }
        .news-author-info h4 {
            margin: 0 0 4px 0;
            color: var(--text-primary);
            font-weight: 600;
        }
        .news-time {
            font-size: var(--font-size-xs);
            color: var(--text-muted);
        }
        .news-content {
            margin-bottom: var(--spacing-md);
            line-height: 1.6;
            color: var(--text-primary);
        }
        .news-media img,
        .news-media video {
            width: 100%;
            max-height: 400px;
            border-radius: var(--radius-md);
            margin-top: var(--spacing-md);
            object-fit: cover;
        }
        /* ÿßŸÑŸÇÿµÿµ */
        .stories-modal {
            width: 700px;
        }
        .add-story-section {
            padding: var(--spacing-xl);
            border-bottom: 1px solid var(--border-color);
            text-align: center;
            background: var(--bg-tertiary);
        }
        .add-story-btn {
            padding: var(--spacing-md) var(--spacing-xl);
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            color: var(--text-white);
            border: none;
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: var(--transition-fast);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            box-shadow: var(--shadow-light);
        }
        .add-story-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
        }
        .stories-container {
            display: flex;
            gap: var(--spacing-md);
            padding: var(--spacing-xl);
            overflow-x: auto;
            min-height: 300px;
        }
        .story-item {
            position: relative;
            width: 150px;
            height: 250px;
            border-radius: var(--radius-lg);
            overflow: hidden;
            cursor: pointer;
            transition: var(--transition-fast);
            border: 3px solid transparent;
            flex-shrink: 0;
            box-shadow: var(--shadow-light);
        }
        .story-item:hover {
            transform: scale(1.05);
            border-color: var(--primary-color);
            box-shadow: var(--shadow-glow);
        }
        .story-item img,
        .story-item video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        /* ÿ∫ÿ±ŸÅÿ© ÿßŸÑŸÖÿ≥ÿßÿ®ŸÇÿßÿ™ */
        .quiz-room-modal {
            width: 800px;
        }
        .quiz-stats {
            display: flex;
            justify-content: space-around;
            padding: var(--spacing-xl);
            background: var(--bg-tertiary);
            margin-bottom: var(--spacing-lg);
        }
        .quiz-question {
            padding: var(--spacing-xl);
            text-align: center;
        }
        .quiz-question h3 {
            margin-bottom: var(--spacing-xl);
            font-size: var(--font-size-xxl);
            color: var(--text-primary);
        }
        .question-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-xl);
        }
        .option-btn {
            padding: var(--spacing-lg);
            border: 2px solid var(--border-color);
            background: var(--bg-card);
            color: var(--text-primary);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: var(--transition-fast);
            font-size: var(--font-size-md);
            font-weight: 500;
        }
        .option-btn:hover {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
            transform: translateY(-2px);
        }
        .quiz-timer {
            font-size: var(--font-size-xl);
            color: var(--warning-color);
            font-weight: 700;
            background: var(--bg-tertiary);
            padding: var(--spacing-md);
            border-radius: var(--radius-md);
            display: inline-block;
        }
        /* ==================== ÿ•ÿ∂ÿßŸÅÿ© ÿ™ŸÑŸÖŸäÿ≠ ÿßŸÑŸÖÿ≥ÿßÿ®ŸÇÿ© ==================== */
        .hint-section {
            background: #fff8e1;
            border: 1px solid #ffc107;
            border-radius: var(--radius-md);
            padding: var(--spacing-md);
            margin-top: var(--spacing-md);
            animation: fadeIn 0.5s ease;
        }
        .hint-section i {
            color: #ff9800;
            margin-left: var(--spacing-sm);
        }
        /* ==================== ŸÜŸáÿßŸäÿ© ÿ•ÿ∂ÿßŸÅÿ© ÿ™ŸÑŸÖŸäÿ≠ ÿßŸÑŸÖÿ≥ÿßÿ®ŸÇÿ© ==================== */
        .quiz-leaderboard {
            padding: var(--spacing-xl);
            background: var(--bg-tertiary);
            margin-top: var(--spacing-lg);
        }
        .quiz-leaderboard h4 {
            margin-bottom: var(--spacing-lg);
            color: var(--text-primary);
            font-size: var(--font-size-xl);
            text-align: center;
        }
        /* ŸÑŸàÿ≠ÿ© ÿßŸÑÿ•ÿØÿßÿ±ÿ© */
        .admin-modal {
            width: 95vw;
            max-width: 1400px;
            height: 85vh;
        }
        .admin-content {
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        .admin-tabs {
            display: flex;
            padding: var(--spacing-lg);
            border-bottom: 1px solid var(--border-color);
            gap: var(--spacing-sm);
            flex-wrap: wrap;
            background: var(--bg-tertiary);
        }
        .admin-tabs .tab-btn {
            padding: var(--spacing-md) var(--spacing-lg);
            border: 2px solid var(--border-color);
            background: var(--bg-card);
            color: var(--text-secondary);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: var(--transition-fast);
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            font-weight: 500;
        }
        .admin-tabs .tab-btn.active {
            background: var(--primary-color);
            color: var(--text-white);
            border-color: var(--primary-color);
            transform: translateY(-1px);
            box-shadow: var(--shadow-light);
        }
        .admin-tab {
            display: none;
            flex: 1;
            overflow-y: auto;
            padding: var(--spacing-xl);
        }
        .admin-tab.active {
            display: block;
        }
        .admin-user-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--spacing-lg);
            background: var(--bg-card);
            border-radius: var(--radius-md);
            margin-bottom: var(--spacing-md);
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-light);
            transition: var(--transition-fast);
        }
        .admin-user-item:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-medium);
        }
        .admin-user-info {
            display: flex;
            align-items: center;
        }
        .admin-user-avatar {
            width: 60px;
            height: 60px;
            border-radius: var(--radius-full);
            margin-left: var(--spacing-md);
            border: 2px solid var(--primary-color);
            object-fit: cover;
        }
        .admin-user-details h4 {
            margin: 0 0 4px 0;
            color: var(--text-primary);
            font-weight: 600;
        }
        .admin-user-rank {
            font-size: var(--font-size-sm);
            color: var(--text-muted);
        }
        .admin-user-actions {
            display: flex;
            gap: var(--spacing-sm);
            flex-wrap: wrap;
        }
        .admin-action-btn {
            padding: var(--spacing-sm) var(--spacing-md);
            border: none;
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: var(--transition-fast);
            font-size: var(--font-size-sm);
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
        }
        /* ÿ•ÿ¨ÿ±ÿßÿ°ÿßÿ™ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ */
        .user-actions {
            padding: var(--spacing-xl);
        }
        .user-info {
            display: flex;
            align-items: center;
            margin-bottom: var(--spacing-xl);
            padding: var(--spacing-lg);
            background: var(--bg-tertiary);
            border-radius: var(--radius-md);
        }
        .user-info img {
            width: 60px;
            height: 60px;
            border-radius: var(--radius-full);
            margin-left: var(--spacing-md);
            border: 2px solid var(--primary-color);
            object-fit: cover;
        }
        .actions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--spacing-md);
        }
        .action-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: var(--spacing-xl);
            border: 2px solid var(--border-color);
            background: var(--bg-card);
            color: var(--text-primary);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: var(--transition-fast);
            text-decoration: none;
            text-align: center;
        }
        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
        }
        .action-btn i {
            font-size: 1.8rem;
            margin-bottom: var(--spacing-sm);
        }
        .ban-btn:hover {
            background: var(--error-color);
            color: white;
            border-color: var(--error-color);
        }
        .mute-btn:hover {
            background: var(--warning-color);
            color: white;
            border-color: var(--warning-color);
        }
        .rank-btn:hover {
            background: var(--info-color);
            color: white;
            border-color: var(--info-color);
        }
        .coins-btn:hover {
            background: var(--success-color);
            color: white;
            border-color: var(--success-color);
        }
        /* ŸÜŸÖÿßÿ∞ÿ¨ ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ°ÿßÿ™ */
        .ban-form,
        .rank-form,
        .room-form,
        .story-form {
            padding: var(--spacing-xl);
        }
        .form-group {
            margin-bottom: var(--spacing-lg);
        }
        .form-group label {
            display: block;
            margin-bottom: var(--spacing-sm);
            color: var(--text-primary);
            font-weight: 600;
            font-size: var(--font-size-md);
        }
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: var(--spacing-md);
            border: 2px solid var(--border-color);
            border-radius: var(--radius-md);
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-size: var(--font-size-md);
            font-family: var(--font-family);
            transition: var(--transition-fast);
        }
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(233, 30, 99, 0.1);
        }
        .form-group textarea {
            resize: vertical;
            min-height: 100px;
            line-height: 1.6;
        }
        /* ÿßŸÑÿ±ÿ™ÿ® */
        .ranks-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: var(--spacing-lg);
        }
        .rank-item {
            background: var(--bg-card);
            padding: var(--spacing-xl);
            border-radius: var(--radius-lg);
            text-align: center;
            border: 2px solid var(--border-color);
            transition: var(--transition-fast);
            box-shadow: var(--shadow-light);
        }
        .rank-item:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
            border-color: var(--primary-color);
        }
        .rank-emoji {
            font-size: 3rem;
            margin-bottom: var(--spacing-md);
        }
        .rank-name {
            font-weight: 600;
            margin-bottom: var(--spacing-sm);
            font-size: var(--font-size-lg);
            color: var(--text-primary);
        }
        .rank-level {
            font-size: var(--font-size-sm);
            color: var(--text-muted);
        }
        /* ÿßŸÑÿ±ÿßÿØŸäŸà */
        .radio-stations {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
            margin-bottom: var(--spacing-xl);
        }
        .station {
            display: flex;
            align-items: center;
            padding: var(--spacing-lg);
            background: var(--bg-card);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: var(--transition-fast);
            border: 2px solid var(--border-color);
        }
        .station:hover {
            background: var(--primary-light);
            border-color: var(--primary-color);
            transform: translateY(-1px);
        }
        .station i {
            margin-left: var(--spacing-md);
            color: var(--primary-color);
            font-size: var(--font-size-lg);
        }
        .station span {
            font-weight: 500;
            color: var(--text-primary);
        }
        .radio-controls {
            display: flex;
            align-items: center;
            gap: var(--spacing-lg);
            margin-bottom: var(--spacing-xl);
            justify-content: center;
            padding: var(--spacing-lg);
            background: var(--bg-tertiary);
            border-radius: var(--radius-md);
        }
        .custom-music {
            margin-top: var(--spacing-xl);
        }
        .custom-music h4 {
            margin-bottom: var(--spacing-lg);
            color: var(--text-primary);
            font-size: var(--font-size-lg);
        }
        .custom-music-list {
            margin-top: var(--spacing-lg);
            max-height: 200px;
            overflow-y: auto;
        }
        /* ==================== ÿ•ÿ∂ÿßŸÅÿ© ŸÇÿ≥ŸÖ ÿßŸÑÿ®ÿ≠ÿ´ ÿπŸÜ ÿßŸÑÿ£ÿ∫ÿßŸÜŸä ==================== */
        .music-search-section {
            margin-top: var(--spacing-xl);
            padding: var(--spacing-xl);
            background: var(--bg-tertiary);
            border-radius: var(--radius-md);
        }
        .music-search-section h4 {
            margin-bottom: var(--spacing-lg);
            color: var(--text-primary);
            font-size: var(--font-size-lg);
            text-align: center;
        }
        .search-box {
            display: flex;
            gap: var(--spacing-sm);
            margin-bottom: var(--spacing-lg);
        }
        .search-box input {
            flex: 1;
            padding: var(--spacing-md);
            border: 2px solid var(--border-color);
            border-radius: var(--radius-md);
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-size: var(--font-size-md);
        }
        .search-box input:focus {
            outline: none;
            border-color: var(--primary-color);
        }
        .search-results {
            max-height: 300px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: var(--spacing-sm);
        }
        .search-result-item {
            display: flex;
            align-items: center;
            padding: var(--spacing-md);
            background: var(--bg-card);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: var(--transition-fast);
            border: 1px solid var(--border-color);
        }
        .search-result-item:hover {
            background: var(--primary-light);
            border-color: var(--primary-color);
            transform: translateY(-1px);
        }
        .result-cover {
            width: 50px;
            height: 50px;
            border-radius: var(--radius-md);
            margin-left: var(--spacing-md);
            object-fit: cover;
        }
        .result-info {
            flex: 1;
            margin-right: var(--spacing-md);
        }
        .result-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: var(--spacing-xs);
        }
        .result-artist {
            font-size: var(--font-size-sm);
            color: var(--text-secondary);
        }
        /* ==================== ŸÜŸáÿßŸäÿ© ÿ•ÿ∂ÿßŸÅÿ© ŸÇÿ≥ŸÖ ÿßŸÑÿ®ÿ≠ÿ´ ÿπŸÜ ÿßŸÑÿ£ÿ∫ÿßŸÜŸä ==================== */
        /* ÿßŸÑÿ£ÿ≤ÿ±ÿßÿ± */
        .btn {
            padding: var(--spacing-sm) var(--spacing-md);
            border: none;
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: var(--transition-fast);
            font-size: var(--font-size-sm);
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: var(--spacing-sm);
            text-decoration: none;
            border: 2px solid transparent;
        }
        .btn:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-light);
        }
        .btn-primary {
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            color: var(--text-white);
        }
        .btn-primary:hover {
            box-shadow: var(--shadow-glow);
        }
        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border-color: var(--border-color);
        }
        .btn-secondary:hover {
            background: var(--bg-card);
            border-color: var(--primary-color);
        }
        .btn-success {
            background: var(--success-color);
            color: white;
        }
        .btn-warning {
            background: var(--warning-color);
            color: white;
        }
        .btn-danger,
        .btn-error {
            background: var(--error-color);
            color: white;
        }
        .btn-info {
            background: var(--info-color);
            color: white;
        }
        .save-btn {
            background: var(--success-color);
            color: white;
            padding: var(--spacing-md) var(--spacing-xl);
            font-weight: 600;
        }
        .like-btn {
            background: var(--error-color);
            color: white;
        }
        .message-btn {
            background: var(--primary-color);
            color: white;
        }
        /* ÿßŸÑÿ™ÿ®ÿØŸäŸÑ */
        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
        }
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--text-muted);
            transition: var(--transition-fast);
            border-radius: 30px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            right: 4px;
            bottom: 4px;
            background-color: white;
            transition: var(--transition-fast);
            border-radius: 50%;
            box-shadow: var(--shadow-light);
        }
        input:checked + .slider {
            background-color: var(--primary-color);
        }
        input:checked + .slider:before {
            transform: translateX(-30px);
        }
        /* Loading Spinner */
        .loading-spinner {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg-modal);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }
        .spinner {
            width: 60px;
            height: 60px;
            border: 4px solid var(--border-color);
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .loading-spinner p {
            margin-top: var(--spacing-lg);
            color: var(--text-secondary);
            font-size: var(--font-size-lg);
        }
        /* Toast Notifications */
        .toast-container {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 10000;
            display: flex;
            flex-direction: column;
            gap: var(--spacing-sm);
        }
        .toast {
            background: var(--bg-card);
            color: var(--text-primary);
            padding: var(--spacing-md) var(--spacing-lg);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-medium);
            border: 1px solid var(--border-color);
            min-width: 300px;
            animation: toastSlideIn 0.4s ease;
            backdrop-filter: blur(10px);
        }
        .toast.success {
            border-right: 4px solid var(--success-color);
        }
        .toast.error {
            border-right: 4px solid var(--error-color);
        }
        .toast.warning {
            border-right: 4px solid var(--warning-color);
        }
        .toast.info {
            border-right: 4px solid var(--info-color);
        }
        @keyframes toastSlideIn {
            from {
                transform: translateX(-100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        /* ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿßŸÑÿ±ÿ™ÿ® */
        .rank-visitor { color: #888; }
        .rank-bronze { color: #cd7f32; }
        .rank-silver { color: #c0c0c0; }
        .rank-gold { color: #ffd700; }
        .rank-trophy { color: #ff6b35; }
        .rank-diamond { color: #b9f2ff; }
        .rank-prince { 
            background: linear-gradient(45deg, #ffd700, #ff6b35);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 700;
        }
        .rank-admin {
            background: linear-gradient(45deg, #ff6b35, #f093fb);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 700;
        }
        .rank-owner {
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 700;
        }
        /* ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿ≤ÿÆÿ±ŸÅÿ© ÿßŸÑÿ£ÿ≥ŸÖÿßÿ° */
        .name-decoration-fire {
            animation: fireEffect 2s infinite;
        }
        @keyframes fireEffect {
            0%, 100% { 
                text-shadow: 0 0 5px #ff6b35, 0 0 10px #ff6b35, 0 0 15px #ff6b35;
                color: #ff6b35;
            }
            50% { 
                text-shadow: 0 0 10px #ffd700, 0 0 20px #ffd700, 0 0 30px #ffd700;
                color: #ffd700;
            }
        }
        .name-decoration-star {
            animation: starEffect 3s infinite;
        }
        @keyframes starEffect {
            0%, 100% { 
                text-shadow: 0 0 5px #ffd700;
                transform: scale(1);
            }
            50% { 
                text-shadow: 0 0 15px #ffd700, 0 0 25px #ffd700;
                transform: scale(1.05);
            }
        }
        .name-decoration-crown {
            color: #ffd700;
            text-shadow: 0 0 10px #ffd700;
            font-weight: 700;
        }
        .name-decoration-diamond {
            animation: diamondEffect 2s infinite;
        }
        @keyframes diamondEffect {
            0%, 100% { 
                text-shadow: 0 0 5px #b9f2ff;
                color: #b9f2ff;
            }
            50% { 
                text-shadow: 0 0 15px #b9f2ff, 0 0 25px #b9f2ff;
                color: #ffffff;
            }
        }
        .name-decoration-rainbow {
            animation: rainbowEffect 3s infinite;
            font-weight: 700;
        }
        @keyframes rainbowEffect {
            0% { color: #ff0000; }
            16% { color: #ff8000; }
            33% { color: #ffff00; }
            50% { color: #00ff00; }
            66% { color: #0080ff; }
            83% { color: #8000ff; }
            100% { color: #ff0000; }
        }
        /* ÿ•ÿÆŸÅÿßÿ° ÿßŸÑÿπŸÜÿßÿµÿ± ÿßŸÑŸÖÿÆÿµÿµÿ© ŸÑŸÑÿ£ÿØŸàÿßÿ± */
        .admin-only {
            display: none;
        }
        .owner-only {
            display: none;
        }
        .moderator-only {
            display: none;
        }
        /* ÿπÿ±ÿ∂ ÿßŸÑÿπŸÜÿßÿµÿ± ÿ≠ÿ≥ÿ® ÿßŸÑÿØŸàÿ± */
        [data-user-role="admin"] .admin-only,
        [data-user-role="admin"] .moderator-only {
            display: block;
        }
        [data-user-role="owner"] .owner-only,
        [data-user-role="owner"] .admin-only,
        [data-user-role="owner"] .moderator-only {
            display: block;
        }
        [data-user-role="moderator"] .moderator-only {
            display: block;
        }
        /* ÿ±ÿ≥ÿßÿ¶ŸÑ ÿßŸÑÿÆÿ∑ÿ£ */
        .error-message {
            background: var(--error-color);
            color: white;
            padding: var(--spacing-md);
            border-radius: var(--radius-md);
            margin-top: var(--spacing-lg);
            text-align: center;
            display: none;
            animation: shake 0.5s ease;
        }
        .error-message.show {
            display: block;
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        /* ÿßŸÑÿßÿ≥ÿ™ÿ¨ÿßÿ®ÿ© ŸÑŸÑÿ¥ÿßÿ¥ÿßÿ™ ÿßŸÑÿµÿ∫Ÿäÿ±ÿ© */
        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            .users-sidebar {
                width: 100%;
                height: 200px;
                order: 2;
            }
            .chat-area {
                order: 1;
                min-height: 60vh;
            }
            .header-right {
                gap: var(--spacing-xs);
            }
            .header-btn {
                width: 36px;
                height: 36px;
            }
            .modal-content {
                width: 95vw;
                height: 90vh;
                margin: 5vh auto;
            }
            .profile-modal {
                width: 95vw;
            }
            .profile-avatars {
                flex-direction: column;
                align-items: center;
                gap: var(--spacing-lg);
            }
            .admin-modal {
                width: 95vw;
                height: 90vh;
            }
            .admin-tabs {
                flex-wrap: wrap;
            }
            .ranks-list {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            }
            .menu-items {
                grid-template-columns: 1fr;
            }
            .actions-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            .profile-stats {
                gap: var(--spacing-lg);
            }
            .stat-item {
                min-width: 80px;
            }
            .header-center {
                display: none;
            }
            .app-logo h1 {
                font-size: var(--font-size-lg);
            }
            .user-profile-mini {
                padding: var(--spacing-xs);
            }
            .user-avatar-mini {
                width: 32px;
                height: 32px;
            }
            .message-content {
                max-width: 85%;
            }
            .input-tools {
                flex-wrap: wrap;
            }
            .tool-btn {
                width: 36px;
                height: 36px;
            }
            .bottom-control-bar {
                flex-wrap: wrap;
                gap: var(--spacing-sm);
            }
            .login-container {
                margin: var(--spacing-md);
                padding: var(--spacing-xl);
            }
            .ban-container {
                margin: var(--spacing-md);
                padding: var(--spacing-xl);
            }
        }
        @media (max-width: 480px) {
            .profile-tabs {
                flex-wrap: wrap;
            }
            .profile-tabs .tab-btn {
                flex: 1;
                min-width: 120px;
            }
            .news-form-actions {
                flex-direction: column;
                align-items: stretch;
            }
            .question-options {
                grid-template-columns: 1fr;
            }
            .quiz-stats {
                flex-direction: column;
                gap: var(--spacing-md);
            }
            .radio-controls {
                flex-direction: column;
                gap: var(--spacing-md);
            }
        }
        /* ÿ™ÿ≠ÿ≥ŸäŸÜÿßÿ™ ÿ•ÿ∂ÿßŸÅŸäÿ© ŸÑŸÑÿ£ÿØÿßÿ° */
        * {
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        img {
            max-width: 100%;
            height: auto;
        }
        video {
            max-width: 100%;
            height: auto;
        }
        /* ÿ™ÿ≠ÿ≥ŸäŸÜÿßÿ™ ÿ•ŸÖŸÉÿßŸÜŸäÿ© ÿßŸÑŸàÿµŸàŸÑ */
        button:focus,
        input:focus,
        select:focus,
        textarea:focus {
            outline: 2px solid var(--primary-color);
            outline-offset: 2px;
        }
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
        /* ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿßŸÑÿ™ŸÖÿ±Ÿäÿ± */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: var(--bg-tertiary);
            border-radius: var(--radius-sm);
        }
        ::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: var(--radius-sm);
        }
        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-dark);
        }
        /* ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿßŸÑÿ™ÿ≠ÿØŸäÿØ */
        ::selection {
            background: var(--primary-light);
            color: var(--text-primary);
        }
        ::-moz-selection {
            background: var(--primary-light);
            color: var(--text-primary);
        }
        /* ÿ£ŸÜŸÖÿßÿ∑ ÿßŸÑŸÖŸäÿ≤ÿßÿ™ ÿßŸÑÿ¨ÿØŸäÿØÿ© */
        /* ÿ£ŸÜŸÖÿßÿ∑ ÿµŸÜÿØŸàŸÇ ÿßŸÑÿØÿ±ÿØÿ¥ÿ© ÿßŸÑÿÆÿßÿµÿ© */
        .private-chat-box {
            position: fixed;
            bottom: 20px;
            left: 20px;
            width: 350px;
            height: 500px;
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-heavy);
            border: 1px solid var(--border-color);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            animation: slideInLeft 0.3s ease;
        }
        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        .chat-box-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--spacing-md);
            background: var(--primary-color);
            color: var(--text-white);
            border-radius: var(--radius-lg) var(--radius-lg) 0 0;
            backdrop-filter: blur(10px);
        }
        .chat-box-title {
            font-weight: 600;
            font-size: var(--font-size-md);
        }
        .chat-box-controls {
            display: flex;
            gap: var(--spacing-sm);
        }
        .chat-box-btn {
            padding: var(--spacing-xs);
            border: none;
            background: transparent;
            color: var(--text-white);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: var(--transition-fast);
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .chat-box-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }
        .chat-box-body {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: var(--bg-secondary);
        }
        .private-chat-users {
            padding: var(--spacing-md);
            border-bottom: 1px solid var(--border-color);
        }
        .private-chat-users select {
            width: 100%;
            padding: var(--spacing-sm);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            background: var(--bg-card);
            color: var(--text-primary);
            font-size: var(--font-size-sm);
        }
        .private-chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: var(--spacing-md);
            max-height: 300px;
        }
        .private-message {
            margin-bottom: var(--spacing-md);
            padding: var(--spacing-sm);
            border-radius: var(--radius-md);
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
        }
        .private-message.own {
            background: var(--primary-light);
            border-color: var(--primary-color);
            margin-right: var(--spacing-lg);
        }
        .private-message-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-xs);
        }
        .private-message-author {
            font-weight: 600;
            color: var(--primary-color);
            font-size: var(--font-size-sm);
        }
        .private-message-time {
            font-size: var(--font-size-xs);
            color: var(--text-muted);
        }
        .private-message-text {
            color: var(--text-primary);
            font-size: var(--font-size-sm);
            line-height: 1.4;
        }
        .private-chat-input {
            display: flex;
            padding: var(--spacing-md);
            border-top: 1px solid var(--border-color);
            gap: var(--spacing-sm);
        }
        .private-chat-input input {
            flex: 1;
            padding: var(--spacing-sm);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            background: var(--bg-card);
            color: var(--text-primary);
            font-size: var(--font-size-sm);
        }
        .private-chat-input input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(233, 30, 99, 0.1);
        }
        .private-chat-send {
            padding: var(--spacing-sm) var(--spacing-md);
            border: none;
            background: var(--primary-color);
            color: var(--text-white);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: var(--transition-fast);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .private-chat-send:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
        }
        /* ÿ£ŸÜŸÖÿßÿ∑ ÿ±ŸÅÿπ ÿßŸÑÿµŸàÿ± */
        .upload-progress {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        .upload-progress-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        .upload-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        /* ÿ£ŸÜŸÖÿßÿ∑ ŸÖÿπÿßŸäŸÜÿ© ŸäŸàÿ™ŸäŸàÿ® */
        .youtube-embed {
            background: #000;
            border-radius: 10px;
            padding: 10px;
            margin: 10px 0;
            text-align: center;
        }
        .youtube-embed iframe {
            border-radius: 8px;
        }
        .youtube-info {
            color: #fff;
            margin-top: 8px;
            font-size: 14px;
        }
        /* ÿ£ŸÜŸÖÿßÿ∑ ÿßŸÑÿ±ÿ≥ÿßÿ¶ŸÑ ÿßŸÑŸÖÿ≠ÿ∞ŸàŸÅÿ© */
        .deleted-message {
            opacity: 0.5;
            font-style: italic;
            color: #999;
            background: rgba(231, 76, 60, 0.1) !important;
        }
        /* ÿ£ŸÜŸÖÿßÿ∑ ŸÖŸàÿØÿßŸÑ ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑÿ∫ÿ±ŸÅ */
        .room-form, .contest-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .form-group label {
            font-weight: bold;
            color: #2c3e50;
        }
        .form-group input,
        .form-group textarea,
        .form-group select {
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }
        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #3498db;
        }
        .form-group textarea {
            min-height: 80px;
            resize: vertical;
        }
        .room-actions, .contest-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }
        /* ÿ£ÿ≤ÿ±ÿßÿ± ÿ±ŸÅÿπ ÿßŸÑŸÖŸÑŸÅÿßÿ™ */
        .file-upload-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        .file-upload-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }
        .file-upload-btn:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }
        .emoji-toggle-btn {
            background: #f39c12;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
        }
        .emoji-toggle-btn:hover {
            background: #e67e22;
            transform: translateY(-2px);
        }
        /* ÿ£ŸÜŸÖÿßÿ∑ ÿßŸÑÿ•ŸäŸÖŸàÿ¨Ÿä ÿßŸÑŸÖÿ™ÿ≠ÿ±ŸÉÿ© */
        .animated-emoji {
            display: inline-block;
            font-size: 20px;
            cursor: pointer;
            transition: transform 0.2s ease;
            padding: 5px;
            border-radius: 50%;
        }
        .animated-emoji:hover {
            transform: scale(1.3);
            background: rgba(52, 152, 219, 0.1);
        }
        .emoji-panel {
            position: absolute;
            bottom: 60px;
            right: 10px;
            background: white;
            border: 2px solid #3498db;
            border-radius: 15px;
            padding: 15px;
            max-width: 300px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            z-index: 1000;
        }
        /* ÿ™ÿ£ÿ´Ÿäÿ±ÿßÿ™ ÿßŸÑÿ•ŸäŸÖŸàÿ¨Ÿä ÿßŸÑŸÖÿ™ÿ≠ÿ±ŸÉÿ© */
        .animated-emoji.laugh {
            animation: bounce 0.6s ease-in-out infinite alternate;
        }
        .animated-emoji.heart-eyes {
            animation: pulse 1s ease-in-out infinite;
        }
        @keyframes bounce {
            0% { transform: translateY(0); }
            100% { transform: translateY(-10px); }
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        /* ==================== ÿ•ÿ∂ÿßŸÅÿ© ÿ£ŸÜŸÖÿßÿ∑ ÿ≥ÿ¨ŸÑ ÿßŸÑÿ±ŸÇÿßÿ®ÿ© (Audit Log) ==================== */
        .audit-log-list {
            max-height: 500px;
            overflow-y: auto;
            padding: var(--spacing-lg);
        }
        .audit-item {
            background: var(--bg-card);
            padding: var(--spacing-md);
            border-radius: var(--radius-md);
            margin-bottom: var(--spacing-sm);
            border-left: 4px solid var(--primary-color);
            font-size: var(--font-size-sm);
            transition: var(--transition-fast);
        }
        .audit-item:hover {
            background: var(--primary-light);
            transform: translateX(5px);
        }
        .timestamp {
            color: var(--text-muted);
            font-weight: 500;
        }
        .admin {
            color: var(--info-color);
            font-weight: 600;
        }
        .action {
            color: var(--text-primary);
        }
        /* ==================== ŸÜŸáÿßŸäÿ© ÿ•ÿ∂ÿßŸÅÿ© ÿ£ŸÜŸÖÿßÿ∑ ÿ≥ÿ¨ŸÑ ÿßŸÑÿ±ŸÇÿßÿ®ÿ© ==================== */

        /* ==================== ÿ™ÿ£ÿ´Ÿäÿ± ÿπŸÜÿØ ÿßŸÑŸÉÿ™ŸÖ ==================== */
        .user-status.muted {
            color: var(--warning-color);
            font-weight: bold;
            animation: pulse 2s infinite;
        }
        /* ==================== ŸÜŸáÿßŸäÿ© ÿ™ÿ£ÿ´Ÿäÿ± ÿßŸÑŸÉÿ™ŸÖ ==================== */

        /* ==================== ÿ™ÿ£ÿ´Ÿäÿ± ÿπŸÜÿØ ÿßŸÑÿ™ŸÑŸÖŸäÿ≠ ŸÅŸä ÿßŸÑŸÖÿ≥ÿßÿ®ŸÇÿ© ==================== */
        .hint-section.show {
            animation: fadeIn 0.5s ease;
        }
        /* ==================== ŸÜŸáÿßŸäÿ© ÿ™ÿ£ÿ´Ÿäÿ± ÿßŸÑÿ™ŸÑŸÖŸäÿ≠ ==================== */

        /* ==================== ÿ™ÿ£ÿ´Ÿäÿ± ÿπŸÜÿØ ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿ£ÿ∫ŸÜŸäÿ© ŸÖŸÜ ÿßŸÑÿ®ÿ≠ÿ´ ==================== */
        .now-playing.active {
            background: var(--primary-light);
            color: var(--primary-color);
            font-weight: bold;
            animation: pulse 1s infinite;
        }
        /* ==================== ŸÜŸáÿßŸäÿ© ÿ™ÿ£ÿ´Ÿäÿ± ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿ£ÿ∫ŸÜŸäÿ© ==================== */
    </style>
</head>
<body>
    <!-- ÿ¥ÿßÿ¥ÿ© ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ -->
    <div id="loginScreen" class="screen active">
        <div class="login-container">
            <div class="login-header">
                <div class="logo">
                    <h1>ü¶Ç ÿ¥ÿßÿ™ Ÿàÿ™ŸäŸÜ ÿßŸÑÿπŸÇÿ±ÿ®</h1>
                    <p>ŸÖŸÜÿµÿ© ÿßŸÑÿ™ŸàÿßÿµŸÑ ÿßŸÑÿßÿ¨ÿ™ŸÖÿßÿπŸä ÿßŸÑÿ£ŸàŸÑŸâ</p>
                </div>
            </div>
            <div class="login-tabs">
                <button class="tab-btn active" onclick="showLoginTab('login')">
                    <i class="fas fa-sign-in-alt"></i>
                    ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ
                </button>
                <button class="tab-btn" onclick="showLoginTab('register')">
                    <i class="fas fa-user-plus"></i>
                    ÿ•ŸÜÿ¥ÿßÿ° ÿ≠ÿ≥ÿßÿ®
                </button>
                <button class="tab-btn" onclick="showLoginTab('guest')">
                    <i class="fas fa-user-secret"></i>
                    ÿØÿÆŸàŸÑ ŸÉÿ≤ÿßÿ¶ÿ±
                </button>
                <!-- ÿ•ÿ∂ÿßŸÅÿ© ÿØÿÆŸàŸÑ ÿπÿ®ÿ± Google/Facebook ÿ≠ÿ≥ÿ® ÿßŸÑŸÖŸàÿßÿµŸÅÿßÿ™ -->
                <div class="social-login">
                    <button class="social-btn google" onclick="loginWithGoogle()">
                        <i class="fab fa-google"></i> Google
                    </button>
                    <button class="social-btn facebook" onclick="loginWithFacebook()">
                        <i class="fab fa-facebook-f"></i> Facebook
                    </button>
                </div>
            </div>
            <!-- ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ -->
            <form id="loginForm" class="auth-form active">
                <div class="input-group">
                    <i class="fas fa-envelope"></i>
                    <input type="email" id="loginEmail" placeholder="ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä" required>
                </div>
                <div class="input-group">
                    <i class="fas fa-lock"></i>
                    <input type="password" id="loginPassword" placeholder="ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±" required>
                </div>
                <button type="submit" class="auth-btn">
                    <i class="fas fa-sign-in-alt"></i>
                    ÿØÿÆŸàŸÑ
                </button>
            </form>
            <!-- ÿ•ŸÜÿ¥ÿßÿ° ÿ≠ÿ≥ÿßÿ® -->
            <form id="registerForm" class="auth-form">
                <div class="input-group">
                    <i class="fas fa-user"></i>
                    <input type="text" id="registerDisplayName" placeholder="ÿßŸÑÿßÿ≥ŸÖ ÿßŸÑŸÖÿπÿ±Ÿàÿ∂" required>
                </div>
                <div class="input-group">
                    <i class="fas fa-envelope"></i>
                    <input type="email" id="registerEmail" placeholder="ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä" required>
                </div>
                <div class="input-group">
                    <i class="fas fa-lock"></i>
                    <input type="password" id="registerPassword" placeholder="ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ±" required>
                </div>
                <button type="submit" class="auth-btn">
                    <i class="fas fa-user-plus"></i>
                    ÿ•ŸÜÿ¥ÿßÿ° ÿ≠ÿ≥ÿßÿ®
                </button>
            </form>
            <!-- ÿØÿÆŸàŸÑ ŸÉÿ≤ÿßÿ¶ÿ± -->
            <form id="guestForm" class="auth-form">
                <div class="input-group">
                    <i class="fas fa-user"></i>
                    <input type="text" id="guestName" placeholder="ÿßŸÑÿßÿ≥ŸÖ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ" required>
                </div>
                <div class="input-group">
                    <i class="fas fa-birthday-cake"></i>
                    <input type="number" id="guestAge" placeholder="ÿßŸÑÿπŸÖÿ±" min="13" max="99" required>
                </div>
                <div class="input-group">
                    <i class="fas fa-venus-mars"></i>
                    <select id="guestGender" required>
                        <option value="">ÿßÿÆÿ™ÿ± ÿßŸÑÿ¨ŸÜÿ≥</option>
                        <option value="ÿ∞ŸÉÿ±">ÿ∞ŸÉÿ±</option>
                        <option value="ÿ£ŸÜÿ´Ÿâ">ÿ£ŸÜÿ´Ÿâ</option>
                        <option value="ÿ¢ÿÆÿ±">ÿ¢ÿÆÿ±</option>
                    </select>
                </div>
                <button type="submit" class="auth-btn">
                    <i class="fas fa-user-secret"></i>
                    ÿØÿÆŸàŸÑ ŸÉÿ≤ÿßÿ¶ÿ±
                </button>
            </form>
            <div id="loginError" class="error-message"></div>
        </div>
    </div>

    <!-- ÿ¥ÿßÿ¥ÿ© ÿßŸÑÿ≠ÿ∏ÿ± -->
    <div id="banScreen" class="screen">
        <div class="ban-container">
            <div class="ban-icon">üö´</div>
            <h2>ÿ™ŸÖ ÿ≠ÿ∏ÿ±ŸÉ ŸÖŸÜ ÿßŸÑÿØÿÆŸàŸÑ</h2>
            <div id="banReason" class="ban-reason">
                <p>ŸÑŸÖ Ÿäÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿØ ÿ≥ÿ®ÿ® ÿßŸÑÿ≠ÿ∏ÿ±</p>
            </div>
            <div class="contact-info">
                <p>ŸÑŸÑÿ™ŸàÿßÿµŸÑ ŸàÿßŸÑÿßÿ≥ÿ™ŸÅÿ≥ÿßÿ±:</p>
                <a href="mailto:njdj9985@gmail.com">njdj9985@gmail.com</a>
            </div>
            <button onclick="checkBanStatus()" class="btn btn-primary">
                <i class="fas fa-sync-alt"></i>
                ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿ≠ÿßŸÑÿ© ÿßŸÑÿ≠ÿ∏ÿ±
            </button>
        </div>
    </div>

    <!-- ÿßŸÑÿ¥ÿßÿ¥ÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ© -->
    <div id="mainScreen" class="screen">
        <!-- ÿßŸÑÿ¥ÿ±Ÿäÿ∑ ÿßŸÑÿπŸÑŸàŸä -->
        <header class="main-header">
            <div class="header-left">
                <button class="hamburger-btn" onclick="openMainMenu()">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="app-logo">
                    <h1>ü¶Ç ÿ¥ÿßÿ™ Ÿàÿ™ŸäŸÜ ÿßŸÑÿπŸÇÿ±ÿ®</h1>
                </div>
            </div>
            <div class="header-center">
                <div class="room-selector">
                    <select id="roomSelect" onchange="changeRoom()">
                        <option value="1">ÿßŸÑÿ∫ÿ±ŸÅÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©</option>
                        <!-- ÿ≥Ÿäÿ™ŸÖ ŸÖŸÑÿ§Ÿáÿß ÿØŸäŸÜÿßŸÖŸäŸÉŸäŸãÿß ÿ®ÿßŸÑÿ¨ÿßŸÅÿßÿ≥ŸÉÿ±Ÿäÿ®ÿ™ -->
                    </select>
                </div>
            </div>
            <div class="header-right">
                <button class="header-btn" onclick="openNotifications()" title="ÿßŸÑÿ•ÿ¥ÿπÿßÿ±ÿßÿ™">
                    <i class="fas fa-bell"></i>
                    <span id="notificationCount" class="notification-badge">0</span>
                </button>
                <button class="header-btn" onclick="openSettings()" title="ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™">
                    <i class="fas fa-cog"></i>
                </button>
                <div class="user-profile-mini" onclick="openProfileModal()">
                    <img id="headerUserAvatar" class="user-avatar-mini" src="https://images.pexels.com/photos/771742/pexels-photo-771742.jpeg?auto=compress&cs=tinysrgb&w=100&h=100&fit=crop" alt="">
                    <div class="user-info-mini">
                        <span id="headerUserName" class="user-name">ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ</span>
                        <span id="headerUserRank" class="user-rank">ÿ≤ÿßÿ¶ÿ±</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- ÿßŸÑŸÖÿ≠ÿ™ŸàŸâ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿä -->
        <main class="main-content">
            <!-- ŸÖŸÜÿ∑ŸÇÿ© ÿßŸÑÿØÿ±ÿØÿ¥ÿ© -->
            <div class="chat-area">
                <div class="chat-header">
                    <h2 id="currentRoomName">ÿßŸÑÿ∫ÿ±ŸÅÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©</h2>
                    <div class="chat-controls">
                        <button class="control-btn" onclick="toggleChatMode()" title="ÿ™ÿ®ÿØŸäŸÑ Ÿàÿ∂ÿπ ÿßŸÑÿØÿ±ÿØÿ¥ÿ©">
                            <i class="fas fa-exchange-alt"></i>
                            <span id="chatModeText">ÿπÿßŸÖ</span>
                        </button>
                        <button class="control-btn" onclick="clearChat()" title="ŸÖÿ≥ÿ≠ ÿßŸÑÿØÿ±ÿØÿ¥ÿ©" id="clearChatBtn">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
                <div id="messagesContainer" class="messages-container">
                    <div class="welcome-message">
                        <div class="welcome-content">
                            <h3>ü¶Ç ŸÖÿ±ÿ≠ÿ®ÿßŸã ÿ®ŸÉ ŸÅŸä ÿ¥ÿßÿ™ Ÿàÿ™ŸäŸÜ ÿßŸÑÿπŸÇÿ±ÿ®</h3>
                            <p>ÿßÿ®ÿØÿ£ ŸÖÿ≠ÿßÿØÿ´ÿ© ÿ¨ÿØŸäÿØÿ© ÿ£Ÿà ÿßŸÜÿ∂ŸÖ ŸÑŸÑŸÖÿ≠ÿßÿØÿ´ÿßÿ™ ÿßŸÑÿ¨ÿßÿ±Ÿäÿ©</p>
                        </div>
                    </div>
                    <!-- ÿ≥Ÿäÿ™ŸÖ ŸÖŸÑÿ§Ÿáÿß ÿ®ÿßŸÑÿ¨ÿßŸÅÿßÿ≥ŸÉÿ±Ÿäÿ®ÿ™ -->
                </div>
                <div class="message-input-container">
                    <div class="input-tools">
                        <button class="tool-btn" onclick="document.getElementById('imageInput').click()" title="ÿ•ÿ±ÿ≥ÿßŸÑ ÿµŸàÿ±ÿ©">
                            <i class="fas fa-image"></i>
                        </button>
                        <button class="tool-btn" onclick="toggleVoiceRecording()" title="ÿ™ÿ≥ÿ¨ŸäŸÑ ÿµŸàÿ™Ÿä" id="voiceBtn">
                            <i class="fas fa-microphone"></i>
                        </button>
                        <button class="tool-btn" onclick="openEmojiPicker()" title="ÿßŸÑÿ±ŸÖŸàÿ≤ ÿßŸÑÿ™ÿπÿ®Ÿäÿ±Ÿäÿ©">
                            <i class="fas fa-smile"></i>
                        </button>
                        <button class="tool-btn" onclick="openGifPicker()" title="ÿµŸàÿ± ŸÖÿ™ÿ≠ÿ±ŸÉÿ©">
                            <i class="fas fa-magic"></i>
                        </button>
                    </div>
                    <div class="message-input-wrapper">
                        <div class="quoted-message" id="quotedMessage" style="display: none;">
                            <div class="quoted-content">
                                <span class="quoted-author"></span>
                                <span class="quoted-text"></span>
                            </div>
                            <button class="cancel-quote" onclick="cancelQuote()">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <input type="text" id="messageInput" placeholder="ÿßŸÉÿ™ÿ® ÿ±ÿ≥ÿßŸÑÿ™ŸÉ ŸáŸÜÿß..." maxlength="1000">
                        <button class="send-btn" onclick="sendMessage()">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                    <input type="file" id="imageInput" accept="image/*" style="display: none;">
                    <input type="file" id="voiceInput" accept="audio/*" style="display: none;">
                </div>
            </div>

            <!-- ÿßŸÑÿ¥ÿ±Ÿäÿ∑ ÿßŸÑÿ¨ÿßŸÜÿ®Ÿä ŸÑŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ -->
            <aside class="users-sidebar">
                <div class="sidebar-header">
                    <h3>ÿßŸÑŸÖÿ™ÿµŸÑŸàŸÜ ÿßŸÑÿ¢ŸÜ</h3>
                    <span id="onlineCount" class="online-count">0</span>
                </div>
                <div id="onlineUsersList" class="users-list">
                    <!-- ÿ≥Ÿäÿ™ŸÖ ŸÖŸÑÿ§Ÿáÿß ÿ®ÿßŸÑÿ¨ÿßŸÅÿßÿ≥ŸÉÿ±Ÿäÿ®ÿ™ -->
                </div>
            </aside>
        </main>

        <!-- ÿ¥ÿ±Ÿäÿ∑ ÿßŸÑÿ™ÿ≠ŸÉŸÖ ÿßŸÑÿ≥ŸÅŸÑŸä -->
        <div class="bottom-control-bar">
            <button class="control-btn" onclick="reloadPage()" title="ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿµŸÅÿ≠ÿ©">
                <i class="fas fa-sync-alt"></i>
            </button>
            <button class="control-btn" onclick="openRadioPlayer()" title="ÿßŸÑÿ±ÿßÿØŸäŸà">
                <i class="fas fa-radio"></i>
            </button>
            <div class="music-controls">
                <button class="control-btn" onclick="toggleMusicPlayer()" title="ŸÖÿ¥ÿ∫ŸÑ ÿßŸÑŸÖŸàÿ≥ŸäŸÇŸâ" id="musicToggle">
                    <i class="fas fa-music"></i>
                </button>
                <div class="volume-control">
                    <i class="fas fa-volume-up"></i>
                    <input type="range" id="volumeSlider" min="0" max="100" value="50">
                </div>
            </div>
            <div class="now-playing" id="nowPlaying">
                <span class="song-title">ŸÑÿß ŸäŸàÿ¨ÿØ ÿ™ÿ¥ÿ∫ŸäŸÑ</span>
                <!-- ÿ≥Ÿäÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´Ÿá ÿ®ÿßŸÑÿ¨ÿßŸÅÿßÿ≥ŸÉÿ±Ÿäÿ®ÿ™ -->
            </div>
        </div>
    </div>

    <!-- ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ© -->
    <div id="mainMenuModal" class="modal">
        <div class="modal-content main-menu">
            <div class="modal-header">
                <h2>ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©</h2>
                <button class="close-btn" onclick="closeMainMenu()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="menu-items">
                <div class="menu-item" onclick="openNewsSection()">
                    <i class="fas fa-newspaper"></i>
                    <span>ÿßŸÑÿ£ÿÆÿ®ÿßÿ±</span>
                    <p>ÿßŸÜÿ¥ÿ± ÿßŸÑÿ£ÿÆÿ®ÿßÿ± ŸàÿßŸÑÿ™ÿ≠ÿØŸäÿ´ÿßÿ™</p>
                </div>
                <div class="menu-item" onclick="openStoriesSection()">
                    <i class="fas fa-images"></i>
                    <span>ÿßŸÑŸÇÿµÿµ ÿßŸÑŸäŸàŸÖŸäÿ©</span>
                    <p>ÿ¥ÿßÿ±ŸÉ ŸÇÿµÿ™ŸÉ ÿßŸÑŸäŸàŸÖŸäÿ©</p>
                </div>
                <div class="menu-item" onclick="openSendNotificationModal()">
                    <i class="fas fa-bell"></i>
                    <span>ÿ•ÿ±ÿ≥ÿßŸÑ ÿ•ÿ¥ÿπÿßÿ±</span>
                    <p>ÿ•ÿ±ÿ≥ÿßŸÑ ÿ•ÿ¥ÿπÿßÿ± ŸÑÿ£Ÿä ÿ¥ÿÆÿµ</p>
                </div>
                <div class="menu-item" onclick="openOnlineUsersModal()">
                    <i class="fas fa-users"></i>
                    <span>ÿßŸÑŸÖÿ™ÿµŸÑŸäŸÜ ÿ≠ÿßŸÑŸäÿßŸã</span>
                    <p>ÿπÿ±ÿ∂ ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖÿ™ÿµŸÑŸäŸÜ</p>
                </div>
                <div class="menu-item" onclick="openPrivateChatBox()">
                    <i class="fas fa-comment-dots"></i>
                    <span>ÿµŸÜÿØŸàŸÇ ÿßŸÑÿØÿ±ÿØÿ¥ÿ©</span>
                    <p>ÿØÿ±ÿØÿ¥ÿ© ÿÆÿßÿµÿ© ŸÖŸÜŸÅÿµŸÑÿ©</p>
                </div>
                <div class="menu-item" onclick="openGamesSection()">
                    <i class="fas fa-gamepad"></i>
                    <span>ÿßŸÑÿ£ŸÑÿπÿßÿ®</span>
                    <p>ÿßŸÑÿπÿ® ŸÖÿπ ÿßŸÑÿ£ÿµÿØŸÇÿßÿ°</p>
                </div>
                <div class="menu-item" onclick="openQuizRoom()">
                    <i class="fas fa-question-circle"></i>
                    <span>ÿ∫ÿ±ŸÅÿ© ÿßŸÑŸÖÿ≥ÿßÿ®ŸÇÿßÿ™</span>
                    <p>ÿßÿÆÿ™ÿ®ÿ± ŸÖÿπŸÑŸàŸÖÿßÿ™ŸÉ Ÿàÿßÿ±ÿ®ÿ≠ ÿßŸÑŸÜŸÇÿßÿ∑</p>
                </div>
                <div class="menu-item" onclick="openRoomsManager()" id="roomsManagerBtn">
                    <i class="fas fa-door-open"></i>
                    <span>ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ∫ÿ±ŸÅ</span>
                    <p>ÿ•ŸÜÿ¥ÿßÿ° Ÿàÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ∫ÿ±ŸÅ</p>
                </div>
                <div class="menu-item" onclick="openCoinsShop()">
                    <i class="fas fa-coins"></i>
                    <span>ŸÖÿ™ÿ¨ÿ± ÿßŸÑŸÜŸÇÿßÿ∑</span>
                    <p>ÿßÿ¥ÿ™ÿ±Ÿä ÿßŸÑŸÖŸÖŸäÿ≤ÿßÿ™ ÿ®ÿßŸÑŸÜŸÇÿßÿ∑</p>
                </div>
                <div class="menu-item" onclick="openAdminPanel()" id="adminPanelBtn">
                    <i class="fas fa-crown"></i>
                    <span>ŸÑŸàÿ≠ÿ© ÿßŸÑÿ•ÿØÿßÿ±ÿ©</span>
                    <p>ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ ŸàÿßŸÑŸÜÿ∏ÿßŸÖ</p>
                </div>
            </div>
        </div>
    </div>

    <!-- ŸÖŸàÿØÿßŸÑ ÿßŸÑŸÖŸÑŸÅ ÿßŸÑÿ¥ÿÆÿµŸä -->
    <div id="profileModal" class="modal">
        <div class="modal-content profile-modal">
            <div class="modal-header">
                <h2>ÿßŸÑŸÖŸÑŸÅ ÿßŸÑÿ¥ÿÆÿµŸä</h2>
                <button class="close-btn" onclick="closeProfileModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="profile-content">
                <div class="profile-cover">
                    <img id="profileCover" src="https://images.pexels.com/photos/1323550/pexels-photo-1323550.jpeg?auto=compress&cs=tinysrgb&w=800&h=300&fit=crop" alt="ÿÆŸÑŸÅŸäÿ© ÿßŸÑÿ®ÿ±ŸàŸÅÿßŸäŸÑ">
                    <input type="file" id="coverInput" accept="image/*" style="display: none;">
                    <button class="change-cover-btn" onclick="document.getElementById('coverInput').click()">
                        <i class="fas fa-camera"></i>
                        ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑÿÆŸÑŸÅŸäÿ©
                    </button>
                </div>
                <div class="profile-info">
                    <div class="profile-avatar-section">
                        <div class="profile-avatars">
                            <div class="avatar-slot">
                                <img id="profileImg1" src="https://images.pexels.com/photos/771742/pexels-photo-771742.jpeg?auto=compress&cs=tinysrgb&w=150&h=150&fit=crop" alt="ÿµŸàÿ±ÿ© 1">
                                <input type="file" id="profileFile1" accept="image/*" style="display: none;">
                                <button onclick="document.getElementById('profileFile1').click()">
                                    <i class="fas fa-camera"></i>
                                </button>
                            </div>
                            <div class="avatar-slot">
                                <img id="profileImg2" src="https://images.pexels.com/photos/1040880/pexels-photo-1040880.jpeg?auto=compress&cs=tinysrgb&w=150&h=150&fit=crop" alt="ÿµŸàÿ±ÿ© 2">
                                <input type="file" id="profileFile2" accept="image/*" style="display: none;">
                                <button onclick="document.getElementById('profileFile2').click()">
                                    <i class="fas fa-camera"></i>
                                </button>
                            </div>
                        </div>
                        <div class="profile-stats">
                            <div class="stat-item">
                                <span class="stat-number" id="profileLikes">0</span>
                                <span class="stat-label">ÿ•ÿπÿ¨ÿßÿ®</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-number" id="profileCoins">2000</span>
                                <span class="stat-label">ŸÜŸÇÿ∑ÿ©</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-number" id="profileRank">ÿ≤ÿßÿ¶ÿ±</span>
                                <span class="stat-label">ÿßŸÑÿ±ÿ™ÿ®ÿ©</span>
                            </div>
                        </div>
                    </div>
                    <div class="profile-details">
                        <div class="profile-tabs">
                            <button class="tab-btn active" onclick="showProfileTab('info')">
                                <i class="fas fa-info-circle"></i>
                                ÿßŸÑŸÖÿπŸÑŸàŸÖÿßÿ™
                            </button>
                            <button class="tab-btn" onclick="showProfileTab('settings')">
                                <i class="fas fa-cog"></i>
                                ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™
                            </button>
                            <button class="tab-btn" onclick="showProfileTab('music')">
                                <i class="fas fa-music"></i>
                                ÿßŸÑŸÖŸàÿ≥ŸäŸÇŸâ
                            </button>
                            <button class="tab-btn" onclick="showProfileTab('decorations')">
                                <i class="fas fa-palette"></i>
                                ÿßŸÑÿ≤ÿÆÿßÿ±ŸÅ
                            </button>
                        </div>

                        <!-- ÿ™ÿ®ŸàŸäÿ® ÿßŸÑŸÖÿπŸÑŸàŸÖÿßÿ™ -->
                        <div id="profileInfoTab" class="profile-tab active">
                            <div class="info-section">
                                <label>ÿßŸÑÿßÿ≥ŸÖ ÿßŸÑŸÖÿπÿ±Ÿàÿ∂:</label>
                                <input type="text" id="displayNameInput" placeholder="ÿßÿ≥ŸÖŸÉ ÿßŸÑŸÖÿπÿ±Ÿàÿ∂">
                            </div>
                            <div class="info-section">
                                <label>ÿßŸÑÿ®ÿ±ŸäÿØ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä:</label>
                                <input type="email" id="emailInput" placeholder="ÿ®ÿ±ŸäÿØŸÉ ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä">
                            </div>
                            <div class="info-section">
                                <label>ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± ÿßŸÑÿ¨ÿØŸäÿØÿ©:</label>
                                <input type="password" id="newPasswordInput" placeholder="ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± ÿßŸÑÿ¨ÿØŸäÿØÿ©">
                            </div>
                            <div class="info-section">
                                <label>ÿßŸÑÿπŸÖÿ±:</label>
                                <input type="number" id="ageInput" min="13" max="100">
                            </div>
                            <div class="info-section">
                                <label>ÿßŸÑÿ¨ŸÜÿ≥:</label>
                                <select id="genderInput">
                                    <option value="">ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØ</option>
                                    <option value="ÿ∞ŸÉÿ±">ÿ∞ŸÉÿ±</option>
                                    <option value="ÿ£ŸÜÿ´Ÿâ">ÿ£ŸÜÿ´Ÿâ</option>
                                </select>
                            </div>
                            <div class="info-section">
                                <label>ÿßŸÑÿ≠ÿßŸÑÿ© ÿßŸÑÿßÿ¨ÿ™ŸÖÿßÿπŸäÿ©:</label>
                                <select id="maritalStatusInput">
                                    <option value="">ÿ∫Ÿäÿ± ŸÖÿ≠ÿØÿØ</option>
                                    <option value="ÿ£ÿπÿ≤ÿ®">ÿ£ÿπÿ≤ÿ®</option>
                                    <option value="ŸÖÿ±ÿ™ÿ®ÿ∑">ŸÖÿ±ÿ™ÿ®ÿ∑</option>
                                    <option value="ŸÖÿ™ÿ≤Ÿàÿ¨">ŸÖÿ™ÿ≤Ÿàÿ¨</option>
                                </select>
                            </div>
                            <div class="info-section">
                                <label>ŸÜÿ®ÿ∞ÿ© ÿπŸÜŸä:</label>
                                <textarea id="aboutMeInput" placeholder="ÿßŸÉÿ™ÿ® ÿ¥Ÿäÿ¶ÿßŸã ÿπŸÜ ŸÜŸÅÿ≥ŸÉ..."></textarea>
                            </div>
                            <button onclick="updateProfile()" class="btn save-btn">
                                <i class="fas fa-save"></i>
                                ÿ≠ŸÅÿ∏ ÿßŸÑÿ™ÿ∫ŸäŸäÿ±ÿßÿ™
                            </button>
                        </div>

                        <!-- ÿ™ÿ®ŸàŸäÿ® ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ -->
                        <div id="profileSettingsTab" class="profile-tab">
                            <div class="settings-section">
                                <h4>ŸÑŸàŸÜ ÿßŸÑÿßÿ≥ŸÖ</h4>
                                <input type="color" id="nameColorPicker" value="#ffffff">
                                <button onclick="updateNameColor()" class="btn">ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑŸÑŸàŸÜ</button>
                            </div>
                            <div class="settings-section">
                                <h4>ŸÑŸàŸÜ ÿßŸÑÿÆÿ∑</h4>
                                <input type="color" id="fontColorPicker" value="#000000">
                                <button onclick="updateFontColor()" class="btn">ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑŸÑŸàŸÜ</button>
                            </div>
                            <div class="settings-section">
                                <h4>ÿÆŸÑŸÅŸäÿ© ÿßŸÑÿ±ÿ≥ÿßÿ¶ŸÑ</h4>
                                <input type="file" id="messageBackgroundInput" accept="image/*">
                                <button onclick="uploadMessageBackground()" class="btn">ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿÆŸÑŸÅŸäÿ©</button>
                            </div>
                        </div>

                        <!-- ÿ™ÿ®ŸàŸäÿ® ÿßŸÑŸÖŸàÿ≥ŸäŸÇŸâ -->
                        <div id="profileMusicTab" class="profile-tab">
                            <div class="music-section">
                                <h4>ŸÖŸàÿ≥ŸäŸÇŸâ ÿßŸÑÿ®ÿ±ŸàŸÅÿßŸäŸÑ</h4>
                                <input type="file" id="profileMusicInput" accept="audio/*">
                                <div id="currentMusic" class="current-music">
                                    <audio id="profileAudio" controls></audio>
                                </div>
                                <button onclick="uploadProfileMusic()" class="btn">ÿ±ŸÅÿπ ŸÖŸàÿ≥ŸäŸÇŸâ</button>
                                <button onclick="removeProfileMusic()" class="btn btn-danger">ÿ•ÿ≤ÿßŸÑÿ© ÿßŸÑŸÖŸàÿ≥ŸäŸÇŸâ</button>
                                <p class="feature-note">ŸÖÿ™ÿßÿ≠ ŸÑŸÑÿ±ÿ™ÿ® ÿßŸÑÿπÿßŸÑŸäÿ© ŸÅŸÇÿ∑</p>
                            </div>
                        </div>

                        <!-- ÿ™ÿ®ŸàŸäÿ® ÿßŸÑÿ≤ÿÆÿßÿ±ŸÅ -->
                        <div id="profileDecorationsTab" class="profile-tab">
                            <div class="decorations-section">
                                <h4>ÿ≤ÿÆÿ±ŸÅÿ© ÿßŸÑÿßÿ≥ŸÖ</h4>
                                <select id="nameDecorationSelect">
                                    <option value="">ÿ®ÿØŸàŸÜ ÿ≤ÿÆÿ±ŸÅÿ©</option>
                                    <option value="fire">ŸÜÿßÿ± üî•</option>
                                    <option value="star">ŸÜÿ¨ŸàŸÖ ‚≠ê</option>
                                    <option value="crown">ÿ™ÿßÿ¨ üëë</option>
                                    <option value="diamond">ŸÖÿßÿ≥ üíé</option>
                                    <option value="rainbow">ŸÇŸàÿ≥ ŸÇÿ≤ÿ≠ üåà</option>
                                </select>
                                <button onclick="updateNameDecoration()" class="btn">ÿ™ÿ∑ÿ®ŸäŸÇ ÿßŸÑÿ≤ÿÆÿ±ŸÅÿ©</button>
                                <p class="feature-note">ÿ®ÿπÿ∂ ÿßŸÑÿ≤ÿÆÿßÿ±ŸÅ ŸÖÿ™ÿßÿ≠ÿ© ŸÑŸÑÿ±ÿ™ÿ® ÿßŸÑÿπÿßŸÑŸäÿ© ŸÅŸÇÿ∑</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ŸÖŸàÿØÿßŸÑ ÿπÿ±ÿ∂ ŸÖŸÑŸÅ ÿ¥ÿÆÿµŸä ÿ¢ÿÆÿ± -->
    <div id="viewProfileModal" class="modal">
        <div class="modal-content profile-modal">
            <div class="modal-header">
                <h2 id="viewProfileName">ÿßŸÑŸÖŸÑŸÅ ÿßŸÑÿ¥ÿÆÿµŸä</h2>
                <button class="close-btn" onclick="closeViewProfileModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="profile-content">
                <div class="profile-cover">
                    <img id="viewProfileCover" src="" alt="ÿÆŸÑŸÅŸäÿ© ÿßŸÑÿ®ÿ±ŸàŸÅÿßŸäŸÑ">
                </div>
                <div class="profile-info">
                    <div class="profile-avatar-section">
                        <div class="profile-avatars">
                            <div class="avatar-slot">
                                <img id="viewProfileImg1" src="" alt="ÿµŸàÿ±ÿ© 1">
                            </div>
                            <div class="avatar-slot">
                                <img id="viewProfileImg2" src="" alt="ÿµŸàÿ±ÿ© 2">
                            </div>
                        </div>
                        <div class="profile-stats">
                            <div class="stat-item">
                                <span class="stat-number" id="viewProfileLikes">0</span>
                                <span class="stat-label">ÿ•ÿπÿ¨ÿßÿ®</span>
                            </div>
                            <div class="stat-item">
                                <span class="stat-number" id="viewProfileCoins">0</span>
                                <span class="stat-label">ŸÜŸÇÿ∑ÿ©</span>
                            </div>
                        </div>
                        <div class="profile-actions">
                            <button onclick="likeProfile()" class="btn like-btn">
                                <i class="fas fa-heart"></i> ÿ•ÿπÿ¨ÿßÿ®
                            </button>
                            <button onclick="startPrivateChat()" class="btn message-btn">
                                <i class="fas fa-envelope"></i> ÿ±ÿ≥ÿßŸÑÿ©
                            </button>
                        </div>
                    </div>
                    <div class="profile-details">
                        <div id="viewProfileInfo" class="profile-info-display">
                            <!-- ÿ≥Ÿäÿ™ŸÖ ŸÖŸÑÿ§Ÿáÿß ÿ®ÿßŸÑÿ¨ÿßŸÅÿßÿ≥ŸÉÿ±Ÿäÿ®ÿ™ -->
                        </div>
                        <div id="viewProfileMusic" class="profile-music-display">
                            <!-- ŸÖŸàÿ≥ŸäŸÇŸâ ÿßŸÑÿ®ÿ±ŸàŸÅÿßŸäŸÑ -->
                            <audio id="viewProfileAudio" controls style="width: 100%; margin-top: 10px;"></audio>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ŸÖŸàÿØÿßŸÑ ÿßŸÑÿ£ÿÆÿ®ÿßÿ± -->
    <div id="newsModal" class="modal">
        <div class="modal-content news-modal">
            <div class="modal-header">
                <h2>üì∞ ŸÇŸÜÿßÿ© ÿßŸÑÿ£ÿÆÿ®ÿßÿ±</h2>
                <button class="close-btn" onclick="closeNewsModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="news-content">
                <div class="news-post-form">
                    <textarea id="newsContentInput" placeholder="ÿßŸÉÿ™ÿ® ÿÆÿ®ÿ±Ÿãÿß..." maxlength="500"></textarea>
                    <div class="news-form-actions">
                        <input type="file" id="newsFileInput" accept="image/*,video/*" style="display: none;">
                        <button onclick="document.getElementById('newsFileInput').click()" class="btn btn-secondary">
                            <i class="fas fa-image"></i>
                            ÿßÿÆÿ™ÿ± ÿµŸàÿ±ÿ© ÿ£Ÿà ŸÅŸäÿØŸäŸà
                        </button>
                        <button onclick="postNews()" class="btn btn-primary">
                            <i class="fas fa-paper-plane"></i>
                            ŸÜÿ¥ÿ±
                        </button>
                    </div>
                </div>
                <div id="newsFeed" class="news-feed">
                    <!-- ÿ≥Ÿäÿ™ŸÖ ŸÖŸÑÿ§Ÿáÿß ÿ®ÿßŸÑÿ¨ÿßŸÅÿßÿ≥ŸÉÿ±Ÿäÿ®ÿ™ -->
                    <!--
                    <div class="news-post">
                        <div class="post-header">
                            <img src="avatar.jpg" class="post-avatar">
                            <div class="post-info">
                                <span class="post-author">ÿßÿ≥ŸÖ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ</span>
                                <span class="post-time">ŸÖŸÜÿ∞ 5 ÿØŸÇÿßÿ¶ŸÇ</span>
                            </div>
                        </div>
                        <div class="post-content">
                            <p>Ÿáÿ∞ÿß ŸÖÿ´ÿßŸÑ ÿπŸÑŸâ ŸÖŸÜÿ¥Ÿàÿ± ÿ•ÿÆÿ®ÿßÿ±Ÿä...</p>
                            <img src="post-image.jpg" class="post-image">
                        </div>
                        <div class="post-reactions">
                            <button class="reaction-btn" data-reaction="like"><i class="fas fa-thumbs-up"></i> <span>12</span></button>
                            <button class="reaction-btn" data-reaction="love"><i class="fas fa-heart"></i> <span>5</span></button>
                            <button class="reaction-btn" data-reaction="laugh"><i class="fas fa-laugh"></i> <span>3</span></button>
                            <button class="reaction-btn" data-reaction="dislike"><i class="fas fa-thumbs-down"></i> <span>1</span></button>
                        </div>
                        <div class="post-comments">
                            <div class="comment">
                                <span class="comment-author">ŸÖÿ≥ÿ™ÿÆÿØŸÖ1:</span>
                                <span class="comment-text">ÿ™ÿπŸÑŸäŸÇ ÿ±ÿßÿ¶ÿπ!</span>
                            </div>
                            <div class="comment">
                                <span class="comment-author">ŸÖÿ≥ÿ™ÿÆÿØŸÖ2:</span>
                                <span class="comment-text">ÿ£ŸàÿßŸÅŸÇ!</span>
                            </div>
                            <div class="add-comment">
                                <input type="text" placeholder="ÿ£ÿ∂ŸÅ ÿ™ÿπŸÑŸäŸÇ...">
                                <button>ÿ•ÿ±ÿ≥ÿßŸÑ</button>
                            </div>
                        </div>
                    </div>
                    -->
                </div>
            </div>
        </div>
    </div>

    <!-- ŸÖŸàÿØÿßŸÑ ÿßŸÑŸÇÿµÿµ -->
    <div id="storiesModal" class="modal">
        <div class="modal-content stories-modal">
            <div class="modal-header">
                <h2>üì∏ ÿßŸÑŸÇÿµÿµ ÿßŸÑŸäŸàŸÖŸäÿ©</h2>
                <button class="close-btn" onclick="closeStoriesModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="stories-content">
                <div class="add-story-section">
                    <button onclick="openAddStoryModal()" class="btn add-story-btn">
                        <i class="fas fa-plus"></i> ÿ•ÿ∂ÿßŸÅÿ© ŸÇÿµÿ©
                    </button>
                </div>
                <div id="storiesContainer" class="stories-container">
                    <!-- ÿ≥Ÿäÿ™ŸÖ ŸÖŸÑÿ§Ÿáÿß ÿ®ÿßŸÑÿ¨ÿßŸÅÿßÿ≥ŸÉÿ±Ÿäÿ®ÿ™ -->
                </div>
            </div>
        </div>
    </div>

    <!-- ŸÖŸàÿØÿßŸÑ ÿ•ÿ∂ÿßŸÅÿ© ŸÇÿµÿ© -->
    <div id="addStoryModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ÿ•ÿ∂ÿßŸÅÿ© ŸÇÿµÿ© ÿ¨ÿØŸäÿØÿ©</h2>
                <button class="close-btn" onclick="closeAddStoryModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="story-form">
                <input type="file" id="storyMediaInput" accept="image/*,video/*" required>
                <textarea id="storyTextInput" placeholder="ŸÜÿµ ÿßŸÑŸÇÿµÿ© (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä)"></textarea>
                <button onclick="addStory()" class="btn btn-primary">
                    <i class="fas fa-plus"></i>
                    ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÇÿµÿ©
                </button>
            </div>
        </div>
    </div>

    <!-- ŸÖŸàÿØÿßŸÑ ÿ∫ÿ±ŸÅÿ© ÿßŸÑŸÖÿ≥ÿßÿ®ŸÇÿßÿ™ -->
    <div id="quizRoomModal" class="modal">
        <div class="modal-content quiz-room-modal">
            <div class="modal-header">
                <h2>üèÜ ÿ∫ÿ±ŸÅÿ© ÿßŸÑŸÖÿ≥ÿßÿ®ŸÇÿßÿ™</h2>
                <button class="close-btn" onclick="closeQuizRoom()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="quiz-content">
                <div class="quiz-stats">
                    <div class="stat-item">
                        <span>ŸÜŸÇÿßÿ∑ŸÉ:</span>
                        <span id="userQuizPoints">0</span>
                    </div>
                    <div class="stat-item">
                        <span>ÿßŸÑÿ™ÿ±ÿ™Ÿäÿ®:</span>
                        <span id="userQuizRank">#-</span>
                    </div>
                </div>
                <div id="quizQuestion" class="quiz-question">
                    <h3 id="questionText">ŸÖÿ±ÿ≠ÿ®ÿßŸã ÿ®ŸÉ ŸÅŸä ÿ∫ÿ±ŸÅÿ© ÿßŸÑŸÖÿ≥ÿßÿ®ŸÇÿßÿ™!</h3>
                    <div id="questionOptions" class="question-options">
                        <!-- ÿ≥Ÿäÿ™ŸÖ ŸÖŸÑÿ§Ÿáÿß ÿ®ÿßŸÑÿ¨ÿßŸÅÿßÿ≥ŸÉÿ±Ÿäÿ®ÿ™ -->
                        <!--
                        <button class="option-btn" onclick="selectAnswer('A')">A. ÿßŸÑÿ•ÿ¨ÿßÿ®ÿ© ÿßŸÑÿ£ŸàŸÑŸâ</button>
                        <button class="option-btn" onclick="selectAnswer('B')">B. ÿßŸÑÿ•ÿ¨ÿßÿ®ÿ© ÿßŸÑÿ´ÿßŸÜŸäÿ©</button>
                        <button class="option-btn" onclick="selectAnswer('C')">C. ÿßŸÑÿ•ÿ¨ÿßÿ®ÿ© ÿßŸÑÿ´ÿßŸÑÿ´ÿ©</button>
                        <button class="option-btn" onclick="selectAnswer('D')">D. ÿßŸÑÿ•ÿ¨ÿßÿ®ÿ© ÿßŸÑÿ±ÿßÿ®ÿπÿ©</button>
                        -->
                    </div>
                    <div class="quiz-timer">
                        <span>ÿßŸÑŸàŸÇÿ™ ÿßŸÑŸÖÿ™ÿ®ŸÇŸä: </span>
                        <span id="quizTimer">15</span> <!-- ÿ™ŸÖ ÿ™ÿπÿØŸäŸÑŸá ŸÖŸÜ 30 ÿ•ŸÑŸâ 15 ÿ≠ÿ≥ÿ® ÿßŸÑŸÖŸàÿßÿµŸÅÿßÿ™ -->
                        <span> ÿ´ÿßŸÜŸäÿ©</span>
                    </div>
                    <div id="hintSection" class="hint-section" style="display: none; margin-top: 10px; color: #ff9800;">
                        <i class="fas fa-lightbulb"></i> <span id="hintText">ÿ™ŸÑŸÖŸäÿ≠: ...</span>
                    </div>
                </div>
                <div id="quizLeaderboard" class="quiz-leaderboard">
                    <h4>ŸÑŸàÿ≠ÿ© ÿßŸÑŸÖÿ™ÿµÿØÿ±ŸäŸÜ</h4>
                    <div id="leaderboardList">
                        <!-- ÿ≥Ÿäÿ™ŸÖ ŸÖŸÑÿ§Ÿáÿß ÿ®ÿßŸÑÿ¨ÿßŸÅÿßÿ≥ŸÉÿ±Ÿäÿ®ÿ™ -->
                        <!--
                        <div class="leaderboard-item">
                            <span class="rank">1.</span>
                            <span class="username">ÿßŸÑŸÑÿßÿπÿ® ÿßŸÑÿ£ŸàŸÑ</span>
                            <span class="score">150</span>
                        </div>
                        -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ŸÖŸàÿØÿßŸÑ ŸÑŸàÿ≠ÿ© ÿßŸÑÿ•ÿØÿßÿ±ÿ© -->
    <div id="adminModal" class="modal">
        <div class="modal-content admin-modal">
            <div class="modal-header">
                <h2>üëë ŸÑŸàÿ≠ÿ© ÿßŸÑÿ•ÿØÿßÿ±ÿ©</h2>
                <button class="close-btn" onclick="closeAdminModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="admin-content">
                <div class="admin-tabs">
                    <button class="tab-btn active" onclick="showAdminTab('users')">
                        <i class="fas fa-users"></i>
                        ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ
                    </button>
                    <button class="tab-btn" onclick="showAdminTab('ranks')">
                        <i class="fas fa-crown"></i>
                        ÿßŸÑÿ±ÿ™ÿ®
                    </button>
                    <button class="tab-btn" onclick="showAdminTab('rooms')">
                        <i class="fas fa-door-open"></i>
                        ÿßŸÑÿ∫ÿ±ŸÅ
                    </button>
                    <button class="tab-btn" onclick="showAdminTab('bans')">
                        <i class="fas fa-ban"></i>
                        ÿßŸÑÿ≠ÿ∏ÿ± ŸàÿßŸÑŸÉÿ™ŸÖ
                    </button>
                    <button class="tab-btn" onclick="showAdminTab('coins')">
                        <i class="fas fa-coins"></i>
                        ÿßŸÑŸÜŸÇÿßÿ∑
                    </button>
                    <button class="tab-btn" onclick="showAdminTab('notifications')">
                        <i class="fas fa-bell"></i>
                        ÿßŸÑÿ•ÿ¥ÿπÿßÿ±ÿßÿ™
                    </button>
                    <button class="tab-btn" onclick="showAdminTab('audit')">
                        <i class="fas fa-clipboard-list"></i>
                        ÿ≥ÿ¨ŸÑ ÿßŸÑÿ±ŸÇÿßÿ®ÿ©
                    </button>
                </div>

                <!-- ÿ™ÿ®ŸàŸäÿ® ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ -->
                <div id="adminUsersTab" class="admin-tab active">
                    <div class="admin-actions">
                        <button onclick="refreshUsersList()" class="btn">
                            <i class="fas fa-sync-alt"></i>
                            ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÇÿßÿ¶ŸÖÿ©
                        </button>
                    </div>
                    <div id="adminUsersList" class="admin-users-list">
                        <!-- ÿ≥Ÿäÿ™ŸÖ ŸÖŸÑÿ§Ÿáÿß ÿ®ÿßŸÑÿ¨ÿßŸÅÿßÿ≥ŸÉÿ±Ÿäÿ®ÿ™ -->
                    </div>
                </div>

                <!-- ÿ™ÿ®ŸàŸäÿ® ÿßŸÑÿ±ÿ™ÿ® -->
                <div id="adminRanksTab" class="admin-tab">
                    <div class="ranks-management">
                        <div class="actions-bar">
                            <button onclick="openCreateRankModal()" class="btn btn-primary">
                                <i class="fas fa-plus"></i> ÿ•ŸÜÿ¥ÿßÿ° ÿ±ÿ™ÿ®ÿ© ÿ¨ÿØŸäÿØÿ©
                            </button>
                        </div>
                        <h3>ÿßŸÑÿ±ÿ™ÿ® ÿßŸÑŸÖÿ™ÿßÿ≠ÿ©</h3>
                        <div id="ranksList" class="ranks-list">
                            <!-- ÿ≥Ÿäÿ™ŸÖ ŸÖŸÑÿ§Ÿáÿß ÿ®ÿßŸÑÿ¨ÿßŸÅÿßÿ≥ŸÉÿ±Ÿäÿ®ÿ™ -->
                        </div>
                    </div>
                </div>

                <!-- ÿ™ÿ®ŸàŸäÿ® ÿßŸÑÿ∫ÿ±ŸÅ -->
                <div id="adminRoomsTab" class="admin-tab">
                    <div class="rooms-management">
                        <button onclick="openCreateRoomModal()" class="btn btn-primary">
                            <i class="fas fa-plus"></i>
                            ÿ•ŸÜÿ¥ÿßÿ° ÿ∫ÿ±ŸÅÿ© ÿ¨ÿØŸäÿØÿ©
                        </button>
                        <div id="adminRoomsList" class="admin-rooms-list">
                            <!-- ÿ≥Ÿäÿ™ŸÖ ŸÖŸÑÿ§Ÿáÿß ÿ®ÿßŸÑÿ¨ÿßŸÅÿßÿ≥ŸÉÿ±Ÿäÿ®ÿ™ -->
                        </div>
                    </div>
                </div>

                <!-- ÿ™ÿ®ŸàŸäÿ® ÿßŸÑÿ≠ÿ∏ÿ± ŸàÿßŸÑŸÉÿ™ŸÖ -->
                <div id="adminBansTab" class="admin-tab">
                    <div class="bans-management">
                        <h3>ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸàŸÜ ÿßŸÑŸÖÿ≠ÿ∏Ÿàÿ±ŸàŸÜ</h3>
                        <div id="bannedUsersList" class="banned-users-list">
                            <!-- ÿ≥Ÿäÿ™ŸÖ ŸÖŸÑÿ§Ÿáÿß ÿ®ÿßŸÑÿ¨ÿßŸÅÿßÿ≥ŸÉÿ±Ÿäÿ®ÿ™ -->
                        </div>
                        <h3 style="margin-top: 20px;">ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸàŸÜ ÿßŸÑŸÖŸÉÿ™ŸàŸÖŸàŸÜ</h3>
                        <div id="mutedUsersList" class="banned-users-list">
                            <!-- ÿ≥Ÿäÿ™ŸÖ ŸÖŸÑÿ§Ÿáÿß ÿ®ÿßŸÑÿ¨ÿßŸÅÿßÿ≥ŸÉÿ±Ÿäÿ®ÿ™ -->
                        </div>
                    </div>
                </div>

                <!-- ÿ™ÿ®ŸàŸäÿ® ÿßŸÑŸÜŸÇÿßÿ∑ -->
                <div id="adminCoinsTab" class="admin-tab">
                    <div class="coins-management">
                        <h3>ÿ•ÿØÿßÿ±ÿ© ÿßŸÑŸÜŸÇÿßÿ∑</h3>
                        <div class="coins-form">
                            <select id="coinsUserSelect">
                                <option value="">ÿßÿÆÿ™ÿ± ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ</option>
                            </select>
                            <input type="number" id="coinsAmount" placeholder="ÿπÿØÿØ ÿßŸÑŸÜŸÇÿßÿ∑">
                            <button onclick="giveCoins()" class="btn btn-primary">
                                <i class="fas fa-coins"></i>
                                ÿ•ÿπÿ∑ÿßÿ° ŸÜŸÇÿßÿ∑
                            </button>
                        </div>
                    </div>
                </div>

                <!-- ÿ™ÿ®ŸàŸäÿ® ÿßŸÑÿ•ÿ¥ÿπÿßÿ±ÿßÿ™ -->
                <div id="adminNotificationsTab" class="admin-tab">
                    <div class="notifications-management">
                        <h3>ÿ•ÿ±ÿ≥ÿßŸÑ ÿ•ÿ¥ÿπÿßÿ±ÿßÿ™</h3>
                        <div class="notification-form">
                            <select id="notificationTarget">
                                <option value="all">ŸÑŸÑÿ¨ŸÖŸäÿπ</option>
                                <option value="specific">ŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ŸÖÿ≠ÿØÿØ</option>
                            </select>
                            <select id="specificUserSelect" style="display: none;">
                                <option value="">ÿßÿÆÿ™ÿ± ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ</option>
                            </select>
                            <textarea id="notificationMessage" placeholder="ŸÜÿµ ÿßŸÑÿ•ÿ¥ÿπÿßÿ±"></textarea>
                            <button onclick="sendNotification()" class="btn btn-primary">
                                <i class="fas fa-paper-plane"></i>
                                ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ•ÿ¥ÿπÿßÿ±
                            </button>
                        </div>
                    </div>
                </div>

                <!-- ÿ™ÿ®ŸàŸäÿ® ÿ≥ÿ¨ŸÑ ÿßŸÑÿ±ŸÇÿßÿ®ÿ© (ÿ¨ÿØŸäÿØ ÿ≠ÿ≥ÿ® ÿßŸÑŸÖŸàÿßÿµŸÅÿßÿ™) -->
                <div id="adminAuditTab" class="admin-tab">
                    <div class="audit-management">
                        <h3>ÿ≥ÿ¨ŸÑ ÿßŸÑÿ±ŸÇÿßÿ®ÿ© (Audit Log)</h3>
                        <div id="auditLogList" class="audit-log-list">
                            <!-- ÿ≥Ÿäÿ™ŸÖ ŸÖŸÑÿ§Ÿáÿß ÿ®ÿßŸÑÿ¨ÿßŸÅÿßÿ≥ŸÉÿ±Ÿäÿ®ÿ™ -->
                            <!--
                            <div class="audit-item">
                                <span class="timestamp">[2024-06-15 14:30]</span>
                                <span class="admin">[ÿßŸÑŸÖÿ¥ÿ±ŸÅ: ÿ£ÿ≠ŸÖÿØ]</span>
                                <span class="action">ÿ≠ÿ∏ÿ± ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ [ŸÖÿ≠ŸÖÿØ] ÿ®ÿ≥ÿ®ÿ® [ÿ•ÿ≥ÿßÿ°ÿ© ÿßÿ≥ÿ™ÿÆÿØÿßŸÖ]</span>
                            </div>
                            -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ŸÖŸàÿØÿßŸÑ ÿ•ÿ¨ÿ±ÿßÿ°ÿßÿ™ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ -->
    <div id="userActionsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ÿ•ÿ¨ÿ±ÿßÿ°ÿßÿ™ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ</h2>
                <button class="close-btn" onclick="closeUserActionsModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="user-actions">
                <div class="user-info">
                    <img id="actionUserAvatar" src="" alt="">
                    <span id="actionUserName"></span>
                </div>
                <div class="actions-grid">
                    <button onclick="viewUserProfile()" class="action-btn">
                        <i class="fas fa-user"></i>
                        <span>ÿπÿ±ÿ∂ ÿßŸÑŸÖŸÑŸÅ ÿßŸÑÿ¥ÿÆÿµŸä</span>
                    </button>
                    <button onclick="startPrivateChat()" class="action-btn">
                        <i class="fas fa-envelope"></i>
                        <span>ÿ±ÿ≥ÿßŸÑÿ© ÿÆÿßÿµÿ©</span>
                    </button>
                    <button onclick="openBanUserModal()" class="action-btn ban-btn">
                        <i class="fas fa-ban"></i>
                        <span>ÿ≠ÿ∏ÿ±</span>
                    </button>
                    <button onclick="openMuteUserModal()" class="action-btn mute-btn">
                        <i class="fas fa-volume-mute"></i>
                        <span>ŸÉÿ™ŸÖ</span>
                    </button>
                    <button onclick="openAssignRankModal()" class="action-btn rank-btn">
                        <i class="fas fa-crown"></i>
                        <span>ÿ™ÿπŸäŸäŸÜ ÿ±ÿ™ÿ®ÿ©</span>
                    </button>
                    <button onclick="openGiveCoinsModal()" class="action-btn coins-btn">
                        <i class="fas fa-coins"></i>
                        <span>ÿ•ÿπÿ∑ÿßÿ° ŸÜŸÇÿßÿ∑</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ŸÖŸàÿØÿßŸÑ ÿ≠ÿ∏ÿ± ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ -->
    <div id="banUserModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ÿ≠ÿ∏ÿ± ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ</h2>
                <button class="close-btn" onclick="closeModal('banUserModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="ban-form">
                <div class="form-group">
                    <label>ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿßŸÑŸÖÿ≠ÿØÿØ:</label>
                    <span id="banTargetUser" data-user-id=""></span>
                </div>
                <div class="form-group">
                    <label>ÿ≥ÿ®ÿ® ÿßŸÑÿ≠ÿ∏ÿ±:</label>
                    <textarea id="banReason" placeholder="ÿßŸÉÿ™ÿ® ÿ≥ÿ®ÿ® ÿßŸÑÿ≠ÿ∏ÿ±..." required></textarea>
                </div>
                <div class="form-group">
                    <label>ŸÖÿØÿ© ÿßŸÑÿ≠ÿ∏ÿ±:</label>
                    <select id="banDuration">
                        <option value="1">ÿ≥ÿßÿπÿ© Ÿàÿßÿ≠ÿØÿ©</option>
                        <option value="24">24 ÿ≥ÿßÿπÿ©</option>
                        <option value="168">ÿ£ÿ≥ÿ®Ÿàÿπ Ÿàÿßÿ≠ÿØ</option>
                        <option value="720">ÿ¥Ÿáÿ± Ÿàÿßÿ≠ÿØ</option>
                        <option value="permanent">ÿØÿßÿ¶ŸÖ</option>
                    </select>
                </div>
                <button onclick="banUser()" class="btn btn-danger">
                    <i class="fas fa-ban"></i>
                    ÿ≠ÿ∏ÿ± ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ
                </button>
            </div>
        </div>
    </div>

    <!-- ŸÖŸàÿØÿßŸÑ ŸÉÿ™ŸÖ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ (ÿ¨ÿØŸäÿØ ÿ≠ÿ≥ÿ® ÿßŸÑŸÖŸàÿßÿµŸÅÿßÿ™) -->
    <div id="muteUserModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ŸÉÿ™ŸÖ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ</h2>
                <button class="close-btn" onclick="closeModal('muteUserModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="mute-form">
                <div class="form-group">
                    <label>ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿßŸÑŸÖÿ≠ÿØÿØ:</label>
                    <span id="muteTargetUser" data-user-id=""></span>
                </div>
                <div class="form-group">
                    <label>ÿ≥ÿ®ÿ® ÿßŸÑŸÉÿ™ŸÖ:</label>
                    <textarea id="muteReason" placeholder="ÿßŸÉÿ™ÿ® ÿ≥ÿ®ÿ® ÿßŸÑŸÉÿ™ŸÖ..." required></textarea>
                </div>
                <div class="form-group">
                    <label>ŸÖÿØÿ© ÿßŸÑŸÉÿ™ŸÖ:</label>
                    <select id="muteDuration">
                        <option value="5">5 ÿØŸÇÿßÿ¶ŸÇ</option>
                        <option value="10">10 ÿØŸÇÿßÿ¶ŸÇ</option>
                        <option value="30">30 ÿØŸÇŸäŸÇÿ©</option>
                        <option value="60">ÿ≥ÿßÿπÿ© Ÿàÿßÿ≠ÿØÿ©</option>
                        <option value="permanent">ÿØÿßÿ¶ŸÖ</option>
                    </select>
                </div>
                <button onclick="muteUser()" class="btn btn-warning">
                    <i class="fas fa-volume-mute"></i>
                    ŸÉÿ™ŸÖ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ
                </button>
            </div>
        </div>
    </div>

    <!-- ŸÖŸàÿØÿßŸÑ ÿ™ÿπŸäŸäŸÜ ÿßŸÑÿ±ÿ™ÿ®ÿ© -->
    <div id="assignRankModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ÿ™ÿπŸäŸäŸÜ ÿ±ÿ™ÿ®ÿ©</h2>
                <button class="close-btn" onclick="closeAssignRankModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="rank-form">
                <div class="form-group">
                    <label>ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ:</label>
                    <span id="rankTargetUser"></span>
                </div>
                <div class="form-group">
                    <label>ÿßŸÑÿ±ÿ™ÿ®ÿ© ÿßŸÑÿ¨ÿØŸäÿØÿ©:</label>
                    <select id="newRankSelect">
                        <option value="visitor">ÿ≤ÿßÿ¶ÿ±</option>
                        <option value="bronze">ÿπÿ∂Ÿà ÿ®ÿ±ŸàŸÜÿ≤Ÿä</option>
                        <option value="silver">ÿπÿ∂Ÿà ŸÅÿ∂Ÿä</option>
                        <option value="gold">ÿπÿ∂Ÿà ÿ∞Ÿáÿ®Ÿä</option>
                        <option value="trophy">ŸÉÿ£ÿ≥</option>
                        <option value="diamond">ÿπÿ∂Ÿà ÿßŸÑŸÖÿßÿ≥</option>
                        <option value="prince">ÿ®ÿ±ŸÜÿ≥</option>
                        <option value="moderator">ŸÖÿ¥ÿ±ŸÅ</option>
                        <option value="admin">ÿ•ÿØÿßÿ±Ÿä</option>
                        <option value="owner">ŸÖÿßŸÑŸÉ</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>ÿ≥ÿ®ÿ® ÿßŸÑÿ™ÿ∫ŸäŸäÿ±:</label>
                    <textarea id="rankChangeReason" placeholder="ÿ≥ÿ®ÿ® ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑÿ±ÿ™ÿ®ÿ© (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä)"></textarea>
                </div>
                <button onclick="confirmAssignRank()" class="btn btn-primary">
                    <i class="fas fa-crown"></i>
                    ÿ™ÿπŸäŸäŸÜ ÿßŸÑÿ±ÿ™ÿ®ÿ©
                </button>
            </div>
        </div>
    </div>

    <!-- ŸÖŸàÿØÿßŸÑ ÿ•ŸÜÿ¥ÿßÿ° ÿ±ÿ™ÿ®ÿ© ÿ¨ÿØŸäÿØÿ© (ÿ¨ÿØŸäÿØ ÿ≠ÿ≥ÿ® ÿßŸÑŸÖŸàÿßÿµŸÅÿßÿ™) -->
    <div id="createRankModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ÿ•ŸÜÿ¥ÿßÿ° ÿ±ÿ™ÿ®ÿ© ÿ¨ÿØŸäÿØÿ©</h2>
                <button class="close-btn" onclick="closeModal('createRankModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="create-rank-form">
                <div class="form-group">
                    <label>ÿßÿ≥ŸÖ ÿßŸÑÿ±ÿ™ÿ®ÿ©:</label>
                    <input type="text" id="rankName" placeholder="ŸÖÿ´ÿßŸÑ: ÿπÿ∂Ÿà VIP" required>
                </div>
                <div class="form-group">
                    <label>ŸàÿµŸÅ ÿßŸÑÿ±ÿ™ÿ®ÿ©:</label>
                    <textarea id="rankDescription" placeholder="ŸÖÿß ŸáŸä ÿµŸÑÿßÿ≠Ÿäÿßÿ™ ŸàŸÖŸÖŸäÿ≤ÿßÿ™ Ÿáÿ∞Ÿá ÿßŸÑÿ±ÿ™ÿ®ÿ©ÿü"></textarea>
                </div>
                <div class="form-group">
                    <label>ŸÑŸàŸÜ ÿßŸÑÿ±ÿ™ÿ®ÿ©:</label>
                    <input type="color" id="rankColor" value="#ffffff">
                </div>
                <div class="permissions-section">
                    <h4>ÿßŸÑÿµŸÑÿßÿ≠Ÿäÿßÿ™:</h4>
                    <div class="permission-item">
                        <input type="checkbox" id="perm_create_room">
                        <label for="perm_create_room">ÿ•ŸÜÿ¥ÿßÿ° ÿ∫ÿ±ŸÅ</label>
                    </div>
                    <div class="permission-item">
                        <input type="checkbox" id="perm_delete_room">
                        <label for="perm_delete_room">ÿ≠ÿ∞ŸÅ ÿ∫ÿ±ŸÅ</label>
                    </div>
                    <div class="permission-item">
                        <input type="checkbox" id="perm_ban_user">
                        <label for="perm_ban_user">ÿ≠ÿ∏ÿ± ŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ</label>
                    </div>
                    <div class="permission-item">
                        <input type="checkbox" id="perm_mute_user">
                        <label for="perm_mute_user">ŸÉÿ™ŸÖ ŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ</label>
                    </div>
                    <div class="permission-item">
                        <input type="checkbox" id="perm_assign_rank">
                        <label for="perm_assign_rank">ÿ™ÿπŸäŸäŸÜ ÿ±ÿ™ÿ®</label>
                    </div>
                    <div class="permission-item">
                        <input type="checkbox" id="perm_send_global_notification">
                        <label for="perm_send_global_notification">ÿ•ÿ±ÿ≥ÿßŸÑ ÿ•ÿ¥ÿπÿßÿ±ÿßÿ™ ÿπÿßŸÖÿ©</label>
                    </div>
                    <div class="permission-item">
                        <input type="checkbox" id="perm_upload_music">
                        <label for="perm_upload_music">ÿ±ŸÅÿπ ŸÖŸàÿ≥ŸäŸÇŸâ</label>
                    </div>
                    <div class="permission-item">
                        <input type="checkbox" id="perm_play_music">
                        <label for="perm_play_music">ÿ™ÿ¥ÿ∫ŸäŸÑ ŸÖŸàÿ≥ŸäŸÇŸâ ŸÅŸä ÿßŸÑÿ∫ÿ±ŸÅ</label>
                    </div>
                </div>
                <button onclick="createRank()" class="btn btn-primary">
                    <i class="fas fa-plus"></i>
                    ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑÿ±ÿ™ÿ®ÿ©
                </button>
            </div>
        </div>
    </div>

    <!-- ŸÖŸàÿØÿßŸÑ ÿßŸÑÿ•ÿ¥ÿπÿßÿ±ÿßÿ™ -->
    <div id="notificationsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ÿßŸÑÿ•ÿ¥ÿπÿßÿ±ÿßÿ™</h2>
                <button class="close-btn" onclick="closeNotificationsModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="notificationsList" class="notifications-list">
                <!-- ÿ≥Ÿäÿ™ŸÖ ŸÖŸÑÿ§Ÿáÿß ÿ®ÿßŸÑÿ¨ÿßŸÅÿßÿ≥ŸÉÿ±Ÿäÿ®ÿ™ -->
                <!--
                <div class="notification-item">
                    <div class="notification-icon">
                        <i class="fas fa-envelope"></i>
                    </div>
                    <div class="notification-content">
                        <div class="notification-title">ÿ±ÿ≥ÿßŸÑÿ© ÿÆÿßÿµÿ© ŸÖŸÜ <strong>ÿ£ÿ≠ŸÖÿØ</strong></div>
                        <div class="notification-message">ŸÖÿ±ÿ≠ÿ®ÿßŸãÿå ŸÉŸäŸÅ ÿ≠ÿßŸÑŸÉÿü</div>
                        <div class="notification-time">ŸÖŸÜÿ∞ 2 ÿØŸÇŸäŸÇÿ©</div>
                    </div>
                </div>
                -->
            </div>
        </div>
    </div>

    <!-- ŸÖŸàÿØÿßŸÑ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™ -->
    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™</h2>
                <button class="close-btn" onclick="closeSettingsModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="settings-content">
                <div class="settings-section">
                    <h3>ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑÿµŸàÿ™</h3>
                    <div class="setting-item">
                        <label>ÿ£ÿµŸàÿßÿ™ ÿßŸÑÿ•ÿ¥ÿπÿßÿ±ÿßÿ™</label>
                        <label class="switch">
                            <input type="checkbox" id="soundNotifications" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>
                <div class="settings-section">
                    <h3>ÿ•ÿπÿØÿßÿØÿßÿ™ ÿßŸÑÿØÿ±ÿØÿ¥ÿ©</h3>
                    <div class="setting-item">
                        <label>ÿ≠ŸÅÿ∏ ÿ™ÿßÿ±ŸäÿÆ ÿßŸÑÿØÿ±ÿØÿ¥ÿ©</label>
                        <label class="switch">
                            <input type="checkbox" id="saveChatHistory" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="setting-item">
                        <label>ŸÅŸÑÿ™ÿ±ÿ© ÿßŸÑŸÉŸÑŸÖÿßÿ™ ÿ∫Ÿäÿ± ÿßŸÑŸÑÿßÿ¶ŸÇÿ©</label>
                        <label class="switch">
                            <input type="checkbox" id="filterBadWords" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>
                <div class="settings-section">
                    <h3>ÿ•ÿ¨ÿ±ÿßÿ°ÿßÿ™</h3>
                    <button onclick="exitChat()" class="btn btn-warning">
                        <i class="fas fa-sign-out-alt"></i>
                        ÿßŸÑÿÆÿ±Ÿàÿ¨ ŸÖŸÜ ÿßŸÑÿØÿ±ÿØÿ¥ÿ©
                    </button>
                    <button onclick="exitRoom()" class="btn btn-secondary">
                        <i class="fas fa-door-open"></i>
                        ÿßŸÑÿÆÿ±Ÿàÿ¨ ŸÖŸÜ ÿßŸÑÿ∫ÿ±ŸÅÿ©
                    </button>
                    <button onclick="openHelpModal()" class="btn btn-info">
                        <i class="fas fa-question-circle"></i>
                        ÿßŸÑŸÖÿ≥ÿßÿπÿØÿ©
                    </button>
                    <button onclick="showRanks()" class="btn btn-primary">
                        <i class="fas fa-crown"></i>
                        ÿπÿ±ÿ∂ ÿßŸÑÿ±ÿ™ÿ®
                    </button>
                    <button onclick="cleanRooms()" class="btn btn-danger">
                        <i class="fas fa-broom"></i>
                        ÿ™ŸÜÿ∏ŸäŸÅ ÿßŸÑÿ∫ÿ±ŸÅ
                    </button>
                </div>
                <button onclick="saveSettings()" class="btn save-btn">
                    <i class="fas fa-save"></i>
                    ÿ≠ŸÅÿ∏ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™
                </button>
            </div>
        </div>
    </div>

    <!-- ŸÖŸàÿØÿßŸÑ ŸÖÿ¥ÿ∫ŸÑ ÿßŸÑÿ±ÿßÿØŸäŸà -->
    <div id="radioPlayerModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üìª ŸÖÿ¥ÿ∫ŸÑ ÿßŸÑÿ±ÿßÿØŸäŸà</h2>
                <button class="close-btn" onclick="closeRadioPlayer()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="radio-content">
                <div class="radio-stations">
                    <div class="station" onclick="playRadioStation('arabic')">
                        <i class="fas fa-music"></i>
                        <span>ŸÖÿ≠ÿ∑ÿ© ÿßŸÑÿ£ÿ∫ÿßŸÜŸä ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</span>
                    </div>
                    <div class="station" onclick="playRadioStation('english')">
                        <i class="fas fa-music"></i>
                        <span>ŸÖÿ≠ÿ∑ÿ© ÿßŸÑÿ£ÿ∫ÿßŸÜŸä ÿßŸÑÿ£ÿ¨ŸÜÿ®Ÿäÿ©</span>
                    </div>
                    <div class="station" onclick="playRadioStation('classical')">
                        <i class="fas fa-music"></i>
                        <span>ŸÖÿ≠ÿ∑ÿ© ÿßŸÑŸÖŸàÿ≥ŸäŸÇŸâ ÿßŸÑŸÉŸÑÿßÿ≥ŸäŸÉŸäÿ©</span>
                    </div>
                </div>
                <div class="radio-controls">
                    <button id="radioPlayBtn" onclick="toggleRadio()">
                        <i class="fas fa-play"></i>
                    </button>
                    <input type="range" id="radioVolume" min="0" max="100" value="50">
                </div>
                <div class="custom-music">
                    <h4>ÿ£ÿ∫ÿßŸÜŸäŸÉ ÿßŸÑÿÆÿßÿµÿ©</h4>
                    <input type="file" id="customMusicInput" accept="audio/*" multiple>
                    <button onclick="uploadCustomMusic()" class="btn">
                        <i class="fas fa-upload"></i>
                        ÿ±ŸÅÿπ ÿ£ÿ∫ÿßŸÜŸä
                    </button>
                    <div id="customMusicList" class="custom-music-list">
                        <!-- ÿ≥Ÿäÿ™ŸÖ ŸÖŸÑÿ§Ÿáÿß ÿ®ÿßŸÑÿ¨ÿßŸÅÿßÿ≥ŸÉÿ±Ÿäÿ®ÿ™ -->
                    </div>
                </div>
                <!-- ŸÇÿ≥ŸÖ ÿßŸÑÿ®ÿ≠ÿ´ ÿπŸÜ ÿßŸÑÿ£ÿ∫ÿßŸÜŸä (ÿ¨ÿØŸäÿØ ÿ≠ÿ≥ÿ® ÿßŸÑŸÖŸàÿßÿµŸÅÿßÿ™) -->
                <div class="music-search-section">
                    <h4>üîç ÿßŸÑÿ®ÿ≠ÿ´ ÿπŸÜ ÿ£ÿ∫ŸÜŸäÿ©</h4>
                    <div class="search-box">
                        <input type="text" id="musicSearchInput" placeholder="ÿßÿ®ÿ≠ÿ´ ÿπŸÜ ÿ£ÿ∫ŸÜŸäÿ©...">
                        <button onclick="searchMusic()" class="btn">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                    <div id="searchResults" class="search-results">
                        <!-- ÿ≥Ÿäÿ™ŸÖ ŸÖŸÑÿ§Ÿáÿß ÿ®ÿßŸÑÿ¨ÿßŸÅÿßÿ≥ŸÉÿ±Ÿäÿ®ÿ™ -->
                        <!--
                        <div class="search-result-item" onclick="playSearchedSong('ÿ±ÿßÿ®ÿ∑ ÿßŸÑÿ£ÿ∫ŸÜŸäÿ©', 'ÿßÿ≥ŸÖ ÿßŸÑÿ£ÿ∫ŸÜŸäÿ©')">
                            <img src="song-cover.jpg" class="result-cover">
                            <div class="result-info">
                                <div class="result-title">ÿßÿ≥ŸÖ ÿßŸÑÿ£ÿ∫ŸÜŸäÿ©</div>
                                <div class="result-artist">ÿßÿ≥ŸÖ ÿßŸÑŸÅŸÜÿßŸÜ</div>
                            </div>
                        </div>
                        -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ŸÖŸàÿØÿßŸÑ ÿ•ŸÜÿ¥ÿßÿ° ÿ∫ÿ±ŸÅÿ© -->
    <div id="createRoomModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ÿ•ŸÜÿ¥ÿßÿ° ÿ∫ÿ±ŸÅÿ© ÿ¨ÿØŸäÿØÿ©</h2>
                <button class="close-btn" onclick="closeCreateRoomModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="room-form">
                <div class="form-group">
                    <label>ÿßÿ≥ŸÖ ÿßŸÑÿ∫ÿ±ŸÅÿ©:</label>
                    <input type="text" id="roomName" placeholder="ÿßÿ≥ŸÖ ÿßŸÑÿ∫ÿ±ŸÅÿ©" required>
                </div>
                <div class="form-group">
                    <label>ŸàÿµŸÅ ÿßŸÑÿ∫ÿ±ŸÅÿ©:</label>
                    <textarea id="roomDescription" placeholder="ŸàÿµŸÅ ÿßŸÑÿ∫ÿ±ŸÅÿ© (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä)"></textarea>
                </div>
                <div class="form-group">
                    <label>ŸÜŸàÿπ ÿßŸÑÿ∫ÿ±ŸÅÿ©:</label>
                    <select id="roomType">
                        <option value="public">ÿπÿßŸÖ</option>
                        <option value="private">ÿÆÿßÿµ</option>
                        <option value="quiz">ŸÖÿ≥ÿßÿ®ŸÇÿ©</option>
                        <option value="music">ŸÖŸàÿ≥ŸäŸÇŸâ</option>
                        <option value="game">ÿ£ŸÑÿπÿßÿ®</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>ÿÆŸÑŸÅŸäÿ© ÿßŸÑÿ∫ÿ±ŸÅÿ©:</label>
                    <input type="file" id="roomBackgroundInput" accept="image/*">
                </div>
                <div class="form-group">
                    <label>ÿµŸÑÿßÿ≠Ÿäÿßÿ™ ÿßŸÑÿØÿÆŸàŸÑ:</label>
                    <select id="roomAccessRank">
                        <option value="visitor">ÿßŸÑÿ¨ŸÖŸäÿπ</option>
                        <option value="bronze">ÿ®ÿ±ŸàŸÜÿ≤Ÿä ŸÅŸÖÿß ŸÅŸàŸÇ</option>
                        <option value="silver">ŸÅÿ∂Ÿä ŸÅŸÖÿß ŸÅŸàŸÇ</option>
                        <option value="gold">ÿ∞Ÿáÿ®Ÿä ŸÅŸÖÿß ŸÅŸàŸÇ</option>
                        <option value="diamond">ÿßŸÑŸÖÿßÿ≥ ŸÅŸÖÿß ŸÅŸàŸÇ</option>
                        <option value="moderator">ÿßŸÑŸÖÿ¥ÿ±ŸÅŸàŸÜ ŸÅŸÖÿß ŸÅŸàŸÇ</option>
                    </select>
                </div>
                <button onclick="createRoom()" class="btn btn-primary">
                    <i class="fas fa-plus"></i>
                    ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑÿ∫ÿ±ŸÅÿ©
                </button>
            </div>
        </div>
    </div>

    <!-- ŸÖŸàÿØÿßŸÑ ÿ•ŸáÿØÿßÿ° ÿßŸÑŸÜŸÇÿßÿ∑ -->
    <div id="giveCoinsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ÿ•ŸáÿØÿßÿ° ŸÜŸÇÿßÿ∑</h2>
                <button class="close-btn" onclick="closeModal('giveCoinsModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="coins-form">
                <div class="form-group">
                    <label>ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿßŸÑŸÖÿ≠ÿØÿØ:</label>
                    <span id="coinsTargetUser" data-user-id=""></span>
                </div>
                <div class="form-group">
                    <label>ÿπÿØÿØ ÿßŸÑŸÜŸÇÿßÿ∑:</label>
                    <input type="number" id="coinsAmount" placeholder="ÿπÿØÿØ ÿßŸÑŸÜŸÇÿßÿ∑" min="1" max="10000" required>
                </div>
                <div class="form-group">
                    <label>ÿ≥ÿ®ÿ® ÿßŸÑÿ•ŸáÿØÿßÿ°:</label>
                    <textarea id="coinsReason" placeholder="ÿ≥ÿ®ÿ® ÿ•ŸáÿØÿßÿ° ÿßŸÑŸÜŸÇÿßÿ∑ (ÿßÿÆÿ™Ÿäÿßÿ±Ÿä)"></textarea>
                </div>
                <button onclick="giveCoins()" class="btn btn-primary">
                    <i class="fas fa-coins"></i>
                    ÿ•ŸáÿØÿßÿ° ÿßŸÑŸÜŸÇÿßÿ∑
                </button>
            </div>
        </div>
    </div>

    <!-- ŸÖŸàÿØÿßŸÑ ÿ•ÿ±ÿ≥ÿßŸÑ ÿ•ÿ¥ÿπÿßÿ± (ÿ™ŸÖ ÿ™Ÿàÿ≠ŸäÿØ ÿßŸÑŸÜÿ≥ÿÆÿ™ŸäŸÜ) -->
    <div id="sendNotificationModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üîî ÿ•ÿ±ÿ≥ÿßŸÑ ÿ•ÿ¥ÿπÿßÿ±</h2>
                <button class="close-btn" onclick="closeSendNotificationModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="notification-form">
                    <div class="form-group">
                        <label for="notificationRecipient">ÿßÿÆÿ™ÿ± ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ:</label>
                        <select id="notificationRecipient" class="form-control">
                            <option value="">ÿßÿÆÿ™ÿ± ŸÖÿ≥ÿ™ÿÆÿØŸÖ...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="notificationType">ŸÜŸàÿπ ÿßŸÑÿ•ÿ¥ÿπÿßÿ±:</label>
                        <select id="notificationType" class="form-control">
                            <option value="info">ŸÖÿπŸÑŸàŸÖÿßÿ™</option>
                            <option value="success">ŸÜÿ¨ÿßÿ≠</option>
                            <option value="warning">ÿ™ÿ≠ÿ∞Ÿäÿ±</option>
                            <option value="error">ÿÆÿ∑ÿ£</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="notificationMessage">ÿ±ÿ≥ÿßŸÑÿ© ÿßŸÑÿ•ÿ¥ÿπÿßÿ±:</label>
                        <textarea id="notificationMessage" class="form-control" placeholder="ÿßŸÉÿ™ÿ® ÿ±ÿ≥ÿßŸÑÿ© ÿßŸÑÿ•ÿ¥ÿπÿßÿ± ŸáŸÜÿß..." rows="4"></textarea>
                    </div>
                    <div class="modal-actions">
                        <button onclick="sendNotificationToUser()" class="btn btn-primary">
                            <i class="fas fa-paper-plane"></i>
                            ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ•ÿ¥ÿπÿßÿ±
                        </button>
                        <button onclick="closeSendNotificationModal()" class="btn btn-secondary">
                            ÿ•ŸÑÿ∫ÿßÿ°
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ŸÖŸàÿØÿßŸÑ ÿßŸÑŸÖÿ™ÿµŸÑŸäŸÜ ÿ≠ÿßŸÑŸäÿßŸã -->
    <div id="onlineUsersModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üë• ÿßŸÑŸÖÿ™ÿµŸÑŸäŸÜ ÿ≠ÿßŸÑŸäÿßŸã</h2>
                <button class="close-btn" onclick="closeOnlineUsersModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div id="onlineUsersList" class="online-users-list">
                    <p style="text-align: center; color: var(--text-secondary); padding: 20px;">
                        ÿ¨ÿßÿ±Ÿä ÿ™ÿ≠ŸÖŸäŸÑ ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖÿ™ÿµŸÑŸäŸÜ...
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- ÿµŸÜÿØŸàŸÇ ÿßŸÑÿØÿ±ÿØÿ¥ÿ© ÿßŸÑÿÆÿßÿµÿ© -->
    <div id="privateChatBox" class="private-chat-box" style="display: none;">
        <div class="chat-box-header">
            <h3 class="chat-box-title">üí¨ ÿØÿ±ÿØÿ¥ÿ© ÿÆÿßÿµÿ©</h3>
            <div class="chat-box-controls">
                <button class="chat-box-btn" onclick="minimizePrivateChatBox()" title="ÿ™ÿµÿ∫Ÿäÿ±">
                    <i class="fas fa-minus"></i>
                </button>
                <button class="chat-box-btn" onclick="closePrivateChatBox()" title="ÿ•ÿ∫ŸÑÿßŸÇ">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
        <div class="chat-box-body">
            <div class="private-chat-users">
                <select id="privateChatUserSelect" onchange="selectPrivateChatUser()">
                    <option value="">ÿßÿÆÿ™ÿ± ŸÖÿ≥ÿ™ÿÆÿØŸÖ ŸÑŸÑÿØÿ±ÿØÿ¥ÿ©...</option>
                </select>
            </div>
            <div id="privateChatMessages" class="private-chat-messages">
                <p style="text-align: center; color: var(--text-secondary); padding: 20px;">
                    ÿßÿÆÿ™ÿ± ŸÖÿ≥ÿ™ÿÆÿØŸÖ ŸÑÿ®ÿØÿ° ÿßŸÑŸÖÿ≠ÿßÿØÿ´ÿ©
                </p>
            </div>
            <div class="private-chat-input">
                <input type="text" id="privateChatInput" placeholder="ÿßŸÉÿ™ÿ® ÿ±ÿ≥ÿßŸÑÿ©..." onkeypress="if(event.key==='Enter') sendPrivateChatMessage()">
                <button class="private-chat-send" onclick="sendPrivateChatMessage()">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Loading Spinner -->
    <div id="loadingSpinner" class="loading-spinner" style="display: none;">
        <div class="spinner"></div>
        <p>ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ...</p>
    </div>

    <!-- Toast Notifications -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- Audio Elements -->
    <audio id="notificationSound" preload="auto">
        <source src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmEcBjiR1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmEcBjiR1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmEcBjiR1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmEcBjiR1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmEcBjiR1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmEcBjiR1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmEcBjiR1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmEcBjiR1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmEcBjiR1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmEcBjiR1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmEcBjiR1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmEcBjiR1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmEcBjiR1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmEcBjiR1/LNeSsFJHfH8N2QQAoUXrTp66hVFApGn+DyvmEcBjiR1/LNeSsFJHfH8N2QQAoUXrTp6......" type="audio/wav">
    </audio>

    <!-- Socket.IO -->
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>

    <!-- ==================== JavaScript ŸÉÿßŸÖŸÑ ŸàŸÖÿπÿØŸÑ ==================== -->
    <script>
        // ŸÖÿ™ÿ∫Ÿäÿ±ÿßÿ™ ÿπÿßŸÖÿ©
        let socket;
        let currentUser = null;
        let currentRoom = 1;
        let isRecording = false;
        let mediaRecorder;
        let audioChunks = [];
        let chatMode = 'public'; // public or private
        let selectedUserId = null;
        let quotedMessage = null;

        // ÿßŸÑÿ±ÿ™ÿ® ÿßŸÑŸÖÿ™ÿßÿ≠ÿ© ŸÖÿπ ÿ•ÿ∂ÿßŸÅÿ© ŸÖÿßŸÑŸÉ (owner)
        const RANKS = {
            visitor: { name: 'ÿ≤ÿßÿ¶ÿ±', emoji: 'üëã', level: 0, color: '#888', permissions: [] },
            bronze: { name: 'ÿπÿ∂Ÿà ÿ®ÿ±ŸàŸÜÿ≤Ÿä', emoji: 'ü•â', level: 1, color: '#cd7f32', permissions: [] },
            silver: { name: 'ÿπÿ∂Ÿà ŸÅÿ∂Ÿä', emoji: 'ü•à', level: 2, color: '#c0c0c0', permissions: [] },
            gold: { name: 'ÿπÿ∂Ÿà ÿ∞Ÿáÿ®Ÿä', emoji: 'ü•á', level: 3, color: '#ffd700', permissions: ['play_music'] },
            trophy: { name: 'ŸÉÿ£ÿ≥', emoji: 'üèÜ', level: 4, color: '#ff6b35', permissions: ['play_music'] },
            diamond: { name: 'ÿπÿ∂Ÿà ÿßŸÑŸÖÿßÿ≥', emoji: 'üíé', level: 5, color: '#b9f2ff', permissions: ['play_music', 'upload_music'] },
            prince: { name: 'ÿ®ÿ±ŸÜÿ≥', emoji: 'üëë', level: 6, color: 'linear-gradient(45deg, #ffd700, #ff6b35)', permissions: ['play_music', 'upload_music'] },
            moderator: { name: 'ŸÖÿ¥ÿ±ŸÅ', emoji: 'üõ°Ô∏è', level: 7, color: 'linear-gradient(45deg, #ff6b35, #f093fb)', permissions: ['play_music', 'upload_music', 'ban_user', 'mute_user', 'assign_rank'] },
            admin: { name: 'ÿ•ÿØÿßÿ±Ÿä', emoji: '‚ö°', level: 8, color: 'linear-gradient(45deg, #000000, #333333)', permissions: ['play_music', 'upload_music', 'ban_user', 'mute_user', 'assign_rank', 'create_room', 'delete_room', 'send_global_notification'] },
            owner: { name: 'ŸÖÿßŸÑŸÉ', emoji: 'üëë', level: 9, color: 'gold', permissions: ['all'] } // ÿµŸÑÿßÿ≠Ÿäÿßÿ™ ŸÉÿßŸÖŸÑÿ©
        };

        // ÿ£ÿ≥ÿ¶ŸÑÿ© ÿßŸÑŸÖÿ≥ÿßÿ®ŸÇÿßÿ™
        const QUIZ_QUESTIONS = [
            {
                question: "ŸÖÿß ŸáŸä ÿπÿßÿµŸÖÿ© ŸÅÿ±ŸÜÿ≥ÿßÿü",
                options: ["ŸÑŸÜÿØŸÜ", "ÿ®ÿ±ŸÑŸäŸÜ", "ÿ®ÿßÿ±Ÿäÿ≥", "ÿ±ŸàŸÖÿß"],
                correct: 2,
                hint: "ŸÖÿØŸäŸÜÿ© ÿßŸÑÿ£ŸÜŸàÿßÿ±"
            },
            {
                question: "ŸÉŸÖ ÿπÿØÿØ ŸÇÿßÿ±ÿßÿ™ ÿßŸÑÿπÿßŸÑŸÖÿü",
                options: ["5", "6", "7", "8"],
                correct: 2,
                hint: "ÿ™ÿ¥ŸÖŸÑ ÿßŸÑŸÇÿßÿ±ÿ© ÿßŸÑŸÇÿ∑ÿ®Ÿäÿ© ÿßŸÑÿ¨ŸÜŸàÿ®Ÿäÿ©"
            },
            {
                question: "ŸÖÿß ŸáŸà ÿ£ŸÉÿ®ÿ± ŸÖÿ≠Ÿäÿ∑ ŸÅŸä ÿßŸÑÿπÿßŸÑŸÖÿü",
                options: ["ÿßŸÑÿ£ÿ∑ŸÑÿ≥Ÿä", "ÿßŸÑŸáŸÜÿØŸä", "ÿßŸÑŸÖÿ™ÿ¨ŸÖÿØ ÿßŸÑÿ¥ŸÖÿßŸÑŸä", "ÿßŸÑŸáÿßÿØÿ¶"],
                correct: 3,
                hint: "Ÿäÿ∫ÿ∑Ÿä ÿ´ŸÑÿ´ ÿ≥ÿ∑ÿ≠ ÿßŸÑÿ£ÿ±ÿ∂"
            },
            {
                question: "ŸÅŸä ÿ£Ÿä ÿπÿßŸÖ ÿ™ŸÖ ÿßÿÆÿ™ÿ±ÿßÿπ ÿßŸÑÿ•ŸÜÿ™ÿ±ŸÜÿ™ÿü",
                options: ["1969", "1975", "1983", "1991"],
                correct: 0,
                hint: "ŸÅŸä ÿ£ŸàÿßÿÆÿ± ÿßŸÑÿ≥ÿ™ŸäŸÜÿßÿ™"
            },
            {
                question: "ŸÖÿß ŸáŸà ÿ£ÿ∑ŸàŸÑ ŸÜŸáÿ± ŸÅŸä ÿßŸÑÿπÿßŸÑŸÖÿü",
                options: ["ÿßŸÑŸÜŸäŸÑ", "ÿßŸÑÿ£ŸÖÿßÿ≤ŸàŸÜ", "ÿßŸÑŸäÿßŸÜÿ∫ÿ™ÿ≥Ÿä", "ÿßŸÑŸÖÿ≥Ÿäÿ≥Ÿäÿ®Ÿä"],
                correct: 0,
                hint: "Ÿäÿ¨ÿ±Ÿä ŸÅŸä ŸÇÿßÿ±ÿ© ÿ•ŸÅÿ±ŸäŸÇŸäÿß"
            }
        ];

        // ÿ™ŸáŸäÿ¶ÿ© ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            setupEventListeners();
            checkAuthStatus();
        });

        // ÿ™ŸáŸäÿ¶ÿ© ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ
        function initializeApp() {
            // ÿ•ÿÆŸÅÿßÿ° ÿ¨ŸÖŸäÿπ ÿßŸÑÿ¥ÿßÿ¥ÿßÿ™
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            // ÿπÿ±ÿ∂ ÿ¥ÿßÿ¥ÿ© ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ
            document.getElementById('loginScreen').classList.add('active');
            // ÿ™ŸáŸäÿ¶ÿ© ÿßŸÑÿ£ÿµŸàÿßÿ™
            initializeAudio();
        }

        // ÿ•ÿπÿØÿßÿØ ŸÖÿ≥ÿ™ŸÖÿπŸä ÿßŸÑÿ£ÿ≠ÿØÿßÿ´
        function setupEventListeners() {
            // ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            document.getElementById('registerForm').addEventListener('submit', handleRegister);
            document.getElementById('guestForm').addEventListener('submit', handleGuestLogin);
            // ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ±ÿ≥ÿßÿ¶ŸÑ
            document.getElementById('messageInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });
            // ÿ±ŸÅÿπ ÿßŸÑÿµŸàÿ±
            document.getElementById('imageInput').addEventListener('change', handleImageUpload);
            // ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑÿ∫ÿ±ŸÅÿ©
            document.getElementById('roomSelect').addEventListener('change', changeRoom);
            // ÿ•ÿ∫ŸÑÿßŸÇ ÿßŸÑŸÖŸàÿØÿßŸÑÿßÿ™ ÿπŸÜÿØ ÿßŸÑŸÜŸÇÿ± ÿÆÿßÿ±ÿ¨Ÿáÿß
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('modal')) {
                    closeAllModals();
                }
            });
        }

        // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿ≠ÿßŸÑÿ© ÿßŸÑŸÖÿµÿßÿØŸÇÿ©
        function checkAuthStatus() {
            const token = localStorage.getItem('chatToken');
            if (token) {
                // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿµÿ≠ÿ© ÿßŸÑÿ™ŸàŸÉŸÜ
                fetch('/api/user/profile', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                })
                .then(response => {
                    if (response.ok) {
                        return response.json();
                    }
                    throw new Error('Invalid token');
                })
                .then(user => {
                    currentUser = user;
                    showMainScreen();
                    initializeSocket();
                })
                .catch(() => {
                    localStorage.removeItem('chatToken');
                    showLoginScreen();
                });
            } else {
                showLoginScreen();
            }
        }

        // ÿπÿ±ÿ∂ ÿ¥ÿßÿ¥ÿ© ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ
        function showLoginScreen() {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById('loginScreen').classList.add('active');
        }

        // ÿπÿ±ÿ∂ ÿßŸÑÿ¥ÿßÿ¥ÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©
        function showMainScreen() {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById('mainScreen').classList.add('active');
            // ÿ™ÿ≠ÿØŸäÿ´ ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ŸÅŸä ÿßŸÑŸàÿßÿ¨Ÿáÿ©
            updateUserInterface();
            // ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ∫ÿ±ŸÅ
            loadRooms();
            // ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ±ÿ≥ÿßÿ¶ŸÑ
            loadMessages();
        }

        // ÿ™ÿ≠ÿØŸäÿ´ Ÿàÿßÿ¨Ÿáÿ© ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ
        function updateUserInterface() {
            if (!currentUser) return;
            // ÿ™ÿ≠ÿØŸäÿ´ ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ŸÅŸä ÿßŸÑÿ¥ÿ±Ÿäÿ∑ ÿßŸÑÿπŸÑŸàŸä
            document.getElementById('headerUserName').textContent = currentUser.display_name || currentUser.email;
            document.getElementById('headerUserRank').textContent = RANKS[currentUser.rank]?.name || 'ÿ≤ÿßÿ¶ÿ±';
            // ÿ™ÿ≠ÿØŸäÿ´ ÿµŸàÿ±ÿ© ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ
            const avatarImg = document.getElementById('headerUserAvatar');
            if (currentUser.profile_image1) {
                avatarImg.src = currentUser.profile_image1;
            }
            // ÿ•ÿ∏Ÿáÿßÿ± ÿ£ÿ≤ÿ±ÿßÿ± ÿßŸÑÿ•ÿØÿßÿ±ÿ© ÿ≠ÿ≥ÿ® ÿßŸÑÿØŸàÿ±
            const adminBtn = document.getElementById('adminPanelBtn');
            const roomsBtn = document.getElementById('roomsManagerBtn');
            const clearBtn = document.getElementById('clearChatBtn');
            
            // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑÿµŸÑÿßÿ≠Ÿäÿßÿ™ ‚Äî ŸÅŸÇÿ∑ ÿßŸÑŸÖÿßŸÑŸÉ ŸàÿßŸÑŸÖÿ¥ÿ±ŸÅŸàŸÜ
            if (hasPermission('create_room') || hasPermission('delete_room') || currentUser.role === 'owner') {
                if (adminBtn) adminBtn.style.display = 'block';
                if (roomsBtn) roomsBtn.style.display = 'block';
                if (clearBtn) clearBtn.style.display = 'block';
            }
            
            // ÿ™ÿπŸäŸäŸÜ ÿØŸàÿ± ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ŸÅŸä ÿßŸÑÿ¨ÿ≥ŸÖ
            document.body.setAttribute('data-user-role', currentUser.role);
            document.body.setAttribute('data-user-rank', currentUser.rank);
        }

        // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑÿµŸÑÿßÿ≠Ÿäÿ©
        function hasPermission(permission) {
            if (!currentUser) return false;
            const userRank = RANKS[currentUser.rank];
            if (!userRank) return false;
            if (userRank.permissions.includes('all')) return true;
            return userRank.permissions.includes(permission);
        }

        // ÿ™ŸáŸäÿ¶ÿ© Socket.IO
        function initializeSocket() {
            const token = localStorage.getItem('chatToken');
            socket = io({
                auth: {
                    token: token
                }
            });

            // ÿßŸÑÿßÿ™ÿµÿßŸÑ
            socket.on('connect', () => {
                console.log('ŸÖÿ™ÿµŸÑ ÿ®ÿßŸÑÿÆÿßÿØŸÖ');
                socket.emit('join', {
                    userId: currentUser.id,
                    displayName: currentUser.display_name,
                    rank: currentUser.rank,
                    email: currentUser.email,
                    roomId: currentRoom,
                    token: token
                });
            });

            // ÿ±ÿ≥ÿßŸÑÿ© ÿ¨ÿØŸäÿØÿ©
            socket.on('newMessage', (message) => {
                // ŸÅŸÑÿ™ÿ±ÿ© ÿßŸÑŸÉŸÑŸÖÿßÿ™ ÿ∫Ÿäÿ± ÿßŸÑŸÑÿßÿ¶ŸÇÿ©
                if (isInappropriate(message.message)) {
                    if (hasPermission('ban_user')) {
                        showNotification(`ÿ™ŸÖ ÿ≠ÿ∞ŸÅ ÿ±ÿ≥ÿßŸÑÿ© ÿ∫Ÿäÿ± ŸÑÿßÿ¶ŸÇÿ© ŸÖŸÜ ${message.display_name}`, 'warning');
                    }
                    return; // ŸÑÿß ÿ™ÿ∏Ÿáÿ± ÿßŸÑÿ±ÿ≥ÿßŸÑÿ©
                }
                displayMessage(message);
                playNotificationSound();
            });

            // ÿ±ÿ≥ÿßŸÑÿ© ÿÆÿßÿµÿ© ÿ¨ÿØŸäÿØÿ©
            socket.on('newPrivateMessage', (message) => {
                if (chatMode === 'private' && 
                    (message.user_id === selectedUserId || message.receiver_id === currentUser.id)) {
                    displayPrivateMessage(message);
                }
                playNotificationSound();
                updateNotificationCount();
                // ÿ•ÿ∏Ÿáÿßÿ± ÿ•ÿ¥ÿπÿßÿ± ÿ™ŸÑŸÇÿßÿ¶Ÿä ÿπŸÜÿØ ÿßÿ≥ÿ™ŸÑÿßŸÖ ÿ±ÿ≥ÿßŸÑÿ© ÿÆÿßÿµÿ©
                showPrivateMessageNotification(message);
            });

            // ÿ™ÿ≠ÿØŸäÿ´ ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ
            socket.on('roomUsersList', (users) => {
                updateUsersList(users);
            });

            // ÿ≠ÿ∞ŸÅ ÿ±ÿ≥ÿßŸÑÿ©
            socket.on('messageDeleted', (messageId) => {
                const messageElement = document.querySelector(`[data-message-id="${messageId}"]`);
                if (messageElement) {
                    messageElement.remove();
                }
            });

            // ÿ•ÿ¥ÿπÿßÿ± ÿ¨ÿØŸäÿØ
            socket.on('newNotification', (notification) => {
                showNotification(notification.message, notification.type || 'info');
                updateNotificationCount();
                notificationsList.push(notification);
            });

            // ÿ™ÿ≠ÿØŸäÿ´ ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖÿ™ÿµŸÑŸäŸÜ
            socket.on('onlineUsersUpdated', (users) => {
                onlineUsersList = users;
                // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿπÿØÿØ ŸÅŸä ÿßŸÑÿ¥ÿ±Ÿäÿ∑ ÿßŸÑÿ¨ÿßŸÜÿ®Ÿä
                const sidebarCount = document.getElementById('onlineCount');
                if (sidebarCount) {
                    sidebarCount.textContent = users.length;
                }
                // ÿ™ÿ≠ÿØŸäÿ´ ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖÿ™ÿµŸÑŸäŸÜ ŸÅŸä ÿßŸÑŸÖŸàÿØÿßŸÑ ÿ•ÿ∞ÿß ŸÉÿßŸÜ ŸÖŸÅÿ™Ÿàÿ≠ÿßŸã
                const modal = document.getElementById('onlineUsersModal');
                if (modal && modal.classList.contains('modal') && modal.style.display !== 'none') {
                    displayOnlineUsers();
                }
            });

            // ŸÇÿ∑ÿπ ÿßŸÑÿßÿ™ÿµÿßŸÑ
            socket.on('disconnect', () => {
                console.log('ÿßŸÜŸÇÿ∑ÿπ ÿßŸÑÿßÿ™ÿµÿßŸÑ ÿ®ÿßŸÑÿÆÿßÿØŸÖ');
                showNotification('ÿßŸÜŸÇÿ∑ÿπ ÿßŸÑÿßÿ™ÿµÿßŸÑ ÿ®ÿßŸÑÿÆÿßÿØŸÖ', 'error');
            });

            // ŸÖÿπÿßŸÑÿ¨ÿ© ÿ£ÿÆÿ∑ÿßÿ° ÿßŸÑÿ£ŸÖÿßŸÜ
            socket.on('error', (errorMessage) => {
                console.error('ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ£ŸÖÿßŸÜ:', errorMessage);
                showNotification('ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ£ŸÖÿßŸÜ: ' + errorMessage, 'error');
                // ÿ•ÿπÿßÿØÿ© ÿ™Ÿàÿ¨ŸäŸá ŸÑÿµŸÅÿ≠ÿ© ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ
                localStorage.removeItem('chatToken');
                showLoginScreen();
            });
        }

        // ŸÅŸÑÿ™ÿ±ÿ© ÿßŸÑŸÉŸÑŸÖÿßÿ™ ÿ∫Ÿäÿ± ÿßŸÑŸÑÿßÿ¶ŸÇÿ©
        function isInappropriate(text) {
            const badWords = ['ŸÉŸÑŸÖÿ©1', 'ŸÉŸÑŸÖÿ©2', 'ŸÉŸÑŸÖÿ©3']; // ŸäŸÖŸÉŸÜŸÉ ÿ™ÿπÿØŸäŸÑŸáÿß
            if (!text) return false;
            return badWords.some(word => text.toLowerCase().includes(word.toLowerCase()));
        }

        // ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ
        async function handleLogin(e) {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            if (!email || !password) {
                showError('Ÿäÿ±ÿ¨Ÿâ ŸÖŸÑÿ° ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≠ŸÇŸàŸÑ');
                return;
            }
            try {
                showLoading(true);
                const response = await fetch('/api/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ email, password })
                });
                const data = await response.json();
                if (response.ok) {
                    localStorage.setItem('chatToken', data.token);
                    currentUser = data.user;
                    showMainScreen();
                    initializeSocket();
                    showNotification('ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ ÿ®ŸÜÿ¨ÿßÿ≠', 'success');
                } else {
                    if (data.error.includes('ŸÖÿ≠ÿ∏Ÿàÿ±')) {
                        showBanScreen(data.banReason || 'ŸÑŸÖ Ÿäÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿØ ÿ≥ÿ®ÿ® ÿßŸÑÿ≠ÿ∏ÿ±');
                    } else {
                        showError(data.error);
                    }
                }
            } catch (error) {
                showError('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿßÿ™ÿµÿßŸÑ');
            } finally {
                showLoading(false);
            }
        }

        // ÿ•ŸÜÿ¥ÿßÿ° ÿ≠ÿ≥ÿßÿ® ÿ¨ÿØŸäÿØ
        async function handleRegister(e) {
            e.preventDefault();
            const displayName = document.getElementById('registerDisplayName').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            if (!email || !password) {
                showError('Ÿäÿ±ÿ¨Ÿâ ŸÖŸÑÿ° ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≠ŸÇŸàŸÑ ÿßŸÑŸÖÿ∑ŸÑŸàÿ®ÿ©');
                return;
            }
            if (password.length < 6) {
                showError('ŸÉŸÑŸÖÿ© ÿßŸÑŸÖÿ±Ÿàÿ± Ÿäÿ¨ÿ® ÿ£ŸÜ ÿ™ŸÉŸàŸÜ 6 ÿ£ÿ≠ÿ±ŸÅ ÿπŸÑŸâ ÿßŸÑÿ£ŸÇŸÑ');
                return;
            }
            try {
                showLoading(true);
                const response = await fetch('/api/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ email, password, display_name: displayName })
                });
                const data = await response.json();
                if (response.ok) {
                    localStorage.setItem('chatToken', data.token);
                    currentUser = data.user;
                    showMainScreen();
                    initializeSocket();
                    showNotification('ÿ™ŸÖ ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑÿ≠ÿ≥ÿßÿ® ÿ®ŸÜÿ¨ÿßÿ≠', 'success');
                } else {
                    showError(data.error);
                }
            } catch (error) {
                showError('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿßÿ™ÿµÿßŸÑ');
            } finally {
                showLoading(false);
            }
        }

        // ÿØÿÆŸàŸÑ ŸÉÿ≤ÿßÿ¶ÿ±
        async function handleGuestLogin(e) {
            e.preventDefault();
            const name = document.getElementById('guestName').value;
            const age = document.getElementById('guestAge').value;
            const gender = document.getElementById('guestGender').value;
            if (!name || !age || !gender) {
                showError('Ÿäÿ±ÿ¨Ÿâ ŸÖŸÑÿ° ÿ¨ŸÖŸäÿπ ÿßŸÑÿ≠ŸÇŸàŸÑ');
                return;
            }
            if (age < 13 || age > 99) {
                showError('ÿßŸÑÿπŸÖÿ± Ÿäÿ¨ÿ® ÿ£ŸÜ ŸäŸÉŸàŸÜ ÿ®ŸäŸÜ 13 Ÿà 99 ÿ≥ŸÜÿ©');
                return;
            }
            // ÿ•ŸÜÿ¥ÿßÿ° ŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿ≤ÿßÿ¶ÿ± ŸÖÿ§ŸÇÿ™
            currentUser = {
                id: Date.now(),
                display_name: name,
                email: `guest_${Date.now()}@temp.com`,
                role: 'user',
                rank: 'visitor',
                age: parseInt(age),
                gender: gender,
                isGuest: true
            };
            showMainScreen();
            initializeSocket();
            showNotification('ŸÖÿ±ÿ≠ÿ®ÿßŸã ÿ®ŸÉ ŸÉÿ≤ÿßÿ¶ÿ±', 'success');
        }

        // ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ ÿπÿ®ÿ± Google
        function loginWithGoogle() {
            showNotification('ÿ¨ÿßÿ±Ÿç ÿßŸÑÿ™ÿ≥ÿ¨ŸäŸÑ ÿπÿ®ÿ± Google...', 'info');
            // ŸÖÿ≠ÿßŸÉÿßÿ© ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ
            setTimeout(() => {
                currentUser = {
                    id: Date.now(),
                    display_name: 'ŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿ¨Ÿàÿ¨ŸÑ',
                    email: `google_${Date.now()}@gmail.com`,
                    role: 'user',
                    rank: 'silver',
                    isSocialLogin: true,
                    provider: 'google'
                };
                showMainScreen();
                initializeSocket();
                showNotification('ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ ÿπÿ®ÿ± Google ÿ®ŸÜÿ¨ÿßÿ≠', 'success');
            }, 1500);
        }

        // ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ ÿπÿ®ÿ± Facebook
        function loginWithFacebook() {
            showNotification('ÿ¨ÿßÿ±Ÿç ÿßŸÑÿ™ÿ≥ÿ¨ŸäŸÑ ÿπÿ®ÿ± Facebook...', 'info');
            // ŸÖÿ≠ÿßŸÉÿßÿ© ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ
            setTimeout(() => {
                currentUser = {
                    id: Date.now(),
                    display_name: 'ŸÖÿ≥ÿ™ÿÆÿØŸÖ ŸÅŸäÿ≥ÿ®ŸàŸÉ',
                    email: `facebook_${Date.now()}@facebook.com`,
                    role: 'user',
                    rank: 'bronze',
                    isSocialLogin: true,
                    provider: 'facebook'
                };
                showMainScreen();
                initializeSocket();
                showNotification('ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ ÿπÿ®ÿ± Facebook ÿ®ŸÜÿ¨ÿßÿ≠', 'success');
            }, 1500);
        }

        // ÿπÿ±ÿ∂ ÿ¥ÿßÿ¥ÿ© ÿßŸÑÿ≠ÿ∏ÿ±
        function showBanScreen(reason) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById('banScreen').classList.add('active');
            document.getElementById('banReason').innerHTML = `<p>${reason}</p>`;
        }

        // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿ≠ÿßŸÑÿ© ÿßŸÑÿ≠ÿ∏ÿ±
        async function checkBanStatus() {
            const token = localStorage.getItem('chatToken');
            if (!token) {
                showLoginScreen();
                return;
            }
            try {
                const response = await fetch('/api/user/profile', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                if (response.ok) {
                    const user = await response.json();
                    currentUser = user;
                    showMainScreen();
                    initializeSocket();
                    showNotification('ÿ™ŸÖ ÿ±ŸÅÿπ ÿßŸÑÿ≠ÿ∏ÿ±', 'success');
                } else {
                    showNotification('ŸÑÿß Ÿäÿ≤ÿßŸÑ ÿßŸÑÿ≠ÿ∏ÿ± ÿ≥ÿßÿ±Ÿä ÿßŸÑŸÖŸÅÿπŸàŸÑ', 'error');
                }
            } catch (error) {
                showError('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿ≠ÿßŸÑÿ© ÿßŸÑÿ≠ÿ∏ÿ±');
            }
        }

        // ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ∫ÿ±ŸÅ
        async function loadRooms() {
            try {
                const token = localStorage.getItem('chatToken');
                const response = await fetch('/api/rooms', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                if (response.ok) {
                    const rooms = await response.json();
                    updateRoomsSelect(rooms);
                }
            } catch (error) {
                console.error('ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ∫ÿ±ŸÅ:', error);
            }
        }

        // ÿ™ÿ≠ÿØŸäÿ´ ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿ∫ÿ±ŸÅ
        function updateRoomsSelect(rooms) {
            const select = document.getElementById('roomSelect');
            select.innerHTML = '';
            rooms.forEach(room => {
                const option = document.createElement('option');
                option.value = room.id;
                option.textContent = room.name;
                if (room.id === currentRoom) {
                    option.selected = true;
                }
                select.appendChild(option);
            });
        }

        // ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑÿ∫ÿ±ŸÅÿ©
        function changeRoom() {
            const newRoomId = parseInt(document.getElementById('roomSelect').value);
            if (newRoomId !== currentRoom) {
                currentRoom = newRoomId;
                // ÿ•ÿ¥ÿπÿßÿ± ÿßŸÑÿÆÿßÿØŸÖ ÿ®ÿ™ÿ∫ŸäŸäÿ± ÿßŸÑÿ∫ÿ±ŸÅÿ©
                if (socket) {
                    socket.emit('changeRoom', newRoomId);
                }
                // ÿ™ÿ≠ÿØŸäÿ´ ÿßÿ≥ŸÖ ÿßŸÑÿ∫ÿ±ŸÅÿ©
                const roomName = document.getElementById('roomSelect').selectedOptions[0].textContent;
                document.getElementById('currentRoomName').textContent = roomName;
                // ŸÖÿ≥ÿ≠ ÿßŸÑÿ±ÿ≥ÿßÿ¶ŸÑ Ÿàÿ™ÿ≠ŸÖŸäŸÑ ÿ±ÿ≥ÿßÿ¶ŸÑ ÿßŸÑÿ∫ÿ±ŸÅÿ© ÿßŸÑÿ¨ÿØŸäÿØÿ©
                document.getElementById('messagesContainer').innerHTML = '';
                loadMessages();
            }
        }

        // ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ±ÿ≥ÿßÿ¶ŸÑ
        async function loadMessages() {
            try {
                const token = localStorage.getItem('chatToken');
                if (!token && !currentUser?.isGuest) return;
                const headers = {};
                if (token) {
                    headers['Authorization'] = `Bearer ${token}`;
                }
                const response = await fetch(`/api/messages/${currentRoom}`, { headers });
                if (response.ok) {
                    const messages = await response.json();
                    const container = document.getElementById('messagesContainer');
                    container.innerHTML = '';
                    messages.forEach(message => {
                        displayMessage(message);
                    });
                    scrollToBottom();
                }
            } catch (error) {
                console.error('ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ±ÿ≥ÿßÿ¶ŸÑ:', error);
            }
        }

        // ÿπÿ±ÿ∂ ÿ±ÿ≥ÿßŸÑÿ©
        function displayMessage(message) {
            const container = document.getElementById('messagesContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${message.user_id === currentUser?.id ? 'own' : ''}`;
            messageDiv.setAttribute('data-message-id', message.id);
            
            // ÿ•ÿ∂ÿßŸÅÿ© ÿÆŸäÿßÿ±ÿßÿ™ ÿßŸÑÿ±ÿ≥ÿßŸÑÿ© (ÿ´ŸÑÿßÿ´ ŸÜŸÇÿßÿ∑)
            const optionsBtn = document.createElement('button');
            optionsBtn.className = 'message-options-btn';
            optionsBtn.innerHTML = '<i class="fas fa-ellipsis-v"></i>';
            optionsBtn.onclick = (e) => {
                e.stopPropagation();
                showMessageOptions(message, messageDiv);
            };
            
            const rank = RANKS[message.rank] || RANKS.visitor;
            const time = new Date(message.timestamp).toLocaleTimeString('ar-SA', {
                hour: '2-digit',
                minute: '2-digit'
            });
            let messageContent = '';
            // ŸÖÿ≠ÿ™ŸàŸâ ÿßŸÑÿ±ÿ≥ÿßŸÑÿ©
            if (message.message) {
                messageContent = `<div class="message-text">${escapeHtml(message.message)}</div>`;
            } else if (message.voice_url) {
                messageContent = `<audio class="message-audio" controls>
                    <source src="${message.voice_url}" type="audio/webm">
                    ŸÖÿ™ÿµŸÅÿ≠ŸÉ ŸÑÿß ŸäÿØÿπŸÖ ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿµŸàÿ™
                </audio>`;
            } else if (message.image_url) {
                messageContent = `<img class="message-image" src="${message.image_url}" alt="ÿµŸàÿ±ÿ©" onclick="openImageModal('${message.image_url}')">`;
            }
            messageDiv.innerHTML = `
                <img class="message-avatar" src="${message.profile_image1 || 'https://images.pexels.com/photos/771742/pexels-photo-771742.jpeg?auto=compress&cs=tinysrgb&w=100&h=100&fit=crop'}" 
                     alt="ÿµŸàÿ±ÿ© ${message.display_name}" onclick="openUserProfile(${message.user_id})">
                <div class="message-content" style="${message.message_background ? `background-image: url(${message.message_background})` : ''}">
                    <div class="message-header">
                        <span class="message-author rank-${message.rank}" onclick="openUserProfile(${message.user_id})">${escapeHtml(message.display_name)}</span>
                        <span class="message-rank">${rank.emoji} ${rank.name}</span>
                        <span class="message-time">${time}</span>
                    </div>
                    ${messageContent}
                </div>
            `;
            messageDiv.appendChild(optionsBtn);
            container.appendChild(messageDiv);
            scrollToBottom();
        }

        // ÿπÿ±ÿ∂ ÿÆŸäÿßÿ±ÿßÿ™ ÿßŸÑÿ±ÿ≥ÿßŸÑÿ©
        function showMessageOptions(message, messageElement) {
            const optionsDiv = document.createElement('div');
            optionsDiv.className = 'message-options';
            optionsDiv.innerHTML = `
                <button onclick="quoteMessage(${message.id}, '${escapeHtml(message.display_name)}', '${escapeHtml(message.message)}')">
                    <i class="fas fa-quote-right"></i> ÿßŸÇÿ™ÿ®ÿßÿ≥
                </button>
                <button onclick="reportMessage(${message.id})">
                    <i class="fas fa-flag"></i> ÿ®ŸÑÿßÿ∫
                </button>
                <button onclick="notifyAboutMessage(${message.id}, '${escapeHtml(message.display_name)}')">
                    <i class="fas fa-bell"></i> ÿ•ÿ¥ÿπÿßÿ±
                </button>
                ${message.user_id === currentUser?.id || hasPermission('delete_message') ? `
                <button onclick="deleteMessage(${message.id}, this)">
                    <i class="fas fa-trash"></i> ÿ≠ÿ∞ŸÅ
                </button>` : ''}
            `;
            // ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿÆŸäÿßÿ±ÿßÿ™ ÿ®ÿ¨ÿßŸÜÿ® ÿßŸÑÿ±ÿ≥ÿßŸÑÿ©
            messageElement.appendChild(optionsDiv);
            // ÿ•ÿ∫ŸÑÿßŸÇ ÿßŸÑÿÆŸäÿßÿ±ÿßÿ™ ÿπŸÜÿØ ÿßŸÑŸÜŸÇÿ± ÿÆÿßÿ±ÿ¨Ÿáÿß
            document.addEventListener('click', function closeOptions(e) {
                if (!messageElement.contains(e.target) && !optionsDiv.contains(e.target)) {
                    optionsDiv.remove();
                    document.removeEventListener('click', closeOptions);
                }
            });
        }

        // ÿ•ÿ±ÿ≥ÿßŸÑ ÿ±ÿ≥ÿßŸÑÿ©
        function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            if (!message) return;
            if (message.length > 1000) {
                showError('ÿßŸÑÿ±ÿ≥ÿßŸÑÿ© ÿ∑ŸàŸäŸÑÿ© ÿ¨ÿØÿßŸã (ÿßŸÑÿ≠ÿØ ÿßŸÑÿ£ŸÇÿµŸâ 1000 ÿ≠ÿ±ŸÅ)');
                return;
            }
            if (socket) {
                const messageData = {
                    message: message,
                    roomId: currentRoom
                };
                // ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿßŸÇÿ™ÿ®ÿßÿ≥ ÿ•ÿ∞ÿß ŸÉÿßŸÜ ŸÖŸàÿ¨ŸàÿØÿßŸã
                if (quotedMessage) {
                    messageData.quoted_message_id = quotedMessage.id;
                    messageData.quoted_author = quotedMessage.author;
                    messageData.quoted_content = quotedMessage.content;
                }
                socket.emit('sendMessage', messageData);
                input.value = '';
                cancelQuote();
            }
        }

        // ÿ±ŸÅÿπ ÿµŸàÿ±ÿ©
        function handleImageUpload(e) {
            const file = e.target.files[0];
            if (!file) return;
            if (!file.type.startsWith('image/')) {
                showError('Ÿäÿ±ÿ¨Ÿâ ÿßÿÆÿ™Ÿäÿßÿ± ÿµŸàÿ±ÿ© ÿµÿ≠Ÿäÿ≠ÿ©');
                return;
            }
            if (file.size > 5 * 1024 * 1024) {
                showError('ÿ≠ÿ¨ŸÖ ÿßŸÑÿµŸàÿ±ÿ© ŸÉÿ®Ÿäÿ± ÿ¨ÿØÿßŸã (ÿßŸÑÿ≠ÿØ ÿßŸÑÿ£ŸÇÿµŸâ 5 ŸÖŸäÿ¨ÿßÿ®ÿßŸäÿ™)');
                return;
            }
            const formData = new FormData();
            formData.append('image', file);
            showLoading(true);
            fetch('/api/upload-image', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('chatToken')}`
                },
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.image_url && socket) {
                    socket.emit('sendMessage', {
                        image_url: data.image_url,
                        roomId: currentRoom
                    });
                } else {
                    showError('ŸÅÿ¥ŸÑ ŸÅŸä ÿ±ŸÅÿπ ÿßŸÑÿµŸàÿ±ÿ©');
                }
            })
            .catch(error => {
                showError('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿ±ŸÅÿπ ÿßŸÑÿµŸàÿ±ÿ©');
            })
            .finally(() => {
                showLoading(false);
                e.target.value = '';
            });
        }

        // ÿ™ÿ≥ÿ¨ŸäŸÑ ÿµŸàÿ™Ÿä
        function toggleVoiceRecording() {
            if (isRecording) {
                stopRecording();
            } else {
                startRecording();
            }
        }

        // ÿ®ÿØÿ° ÿßŸÑÿ™ÿ≥ÿ¨ŸäŸÑ
        async function startRecording() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                mediaRecorder = new MediaRecorder(stream);
                audioChunks = [];
                mediaRecorder.ondataavailable = (event) => {
                    audioChunks.push(event.data);
                };
                mediaRecorder.onstop = () => {
                    const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
                    uploadVoiceMessage(audioBlob);
                    stream.getTracks().forEach(track => track.stop());
                };
                mediaRecorder.start();
                isRecording = true;
                const voiceBtn = document.getElementById('voiceBtn');
                voiceBtn.classList.add('recording');
                voiceBtn.innerHTML = '<i class="fas fa-stop"></i>';
                showNotification('ÿ®ÿØÿ£ ÿßŸÑÿ™ÿ≥ÿ¨ŸäŸÑ...', 'info');
            } catch (error) {
                showError('ŸÑÿß ŸäŸÖŸÉŸÜ ÿßŸÑŸàÿµŸàŸÑ ŸÑŸÑŸÖŸäŸÉÿ±ŸàŸÅŸàŸÜ');
            }
        }

        // ÿ•ŸäŸÇÿßŸÅ ÿßŸÑÿ™ÿ≥ÿ¨ŸäŸÑ
        function stopRecording() {
            if (mediaRecorder && isRecording) {
                mediaRecorder.stop();
                isRecording = false;
                const voiceBtn = document.getElementById('voiceBtn');
                voiceBtn.classList.remove('recording');
                voiceBtn.innerHTML = '<i class="fas fa-microphone"></i>';
                showNotification('ÿ™ŸÖ ÿ•ŸäŸÇÿßŸÅ ÿßŸÑÿ™ÿ≥ÿ¨ŸäŸÑ', 'success');
            }
        }

        // ÿ±ŸÅÿπ ÿ±ÿ≥ÿßŸÑÿ© ÿµŸàÿ™Ÿäÿ©
        function uploadVoiceMessage(audioBlob) {
            const formData = new FormData();
            formData.append('voice', audioBlob, 'voice.webm');
            showLoading(true);
            fetch('/api/upload-voice', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${localStorage.getItem('chatToken')}`
                },
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.voice_url && socket) {
                    socket.emit('sendMessage', {
                        voice_url: data.voice_url,
                        roomId: currentRoom
                    });
                } else {
                    showError('ŸÅÿ¥ŸÑ ŸÅŸä ÿ±ŸÅÿπ ÿßŸÑÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿµŸàÿ™Ÿä');
                }
            })
            .catch(error => {
                showError('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿ±ŸÅÿπ ÿßŸÑÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿµŸàÿ™Ÿä');
            })
            .finally(() => {
                showLoading(false);
            });
        }

        // ÿ™ÿ≠ÿØŸäÿ´ ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ
        function updateUsersList(users) {
            const container = document.getElementById('onlineUsersList');
            const countElement = document.getElementById('onlineCount');
            container.innerHTML = '';
            countElement.textContent = users.length;
            // ÿ™ÿ±ÿ™Ÿäÿ® ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ ÿ≠ÿ≥ÿ® ÿßŸÑÿ±ÿ™ÿ®ÿ©
            users.sort((a, b) => {
                const rankA = RANKS[a.rank] || RANKS.visitor;
                const rankB = RANKS[b.rank] || RANKS.visitor;
                return rankB.level - rankA.level;
            });
            users.forEach(user => {
                if (user.userId === currentUser?.id) return; // ŸÑÿß ŸÜÿπÿ±ÿ∂ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿßŸÑÿ≠ÿßŸÑŸä
                const userDiv = document.createElement('div');
                userDiv.className = 'user-item';
                userDiv.onclick = () => openUserActions(user);
                const rank = RANKS[user.rank] || RANKS.visitor;
                userDiv.innerHTML = `
                    <img class="user-avatar" src="https://images.pexels.com/photos/771742/pexels-photo-771742.jpeg?auto=compress&cs=tinysrgb&w=100&h=100&fit=crop" alt="${user.displayName}">
                    <div class="user-details">
                        <div class="user-display-name rank-${user.rank}">${escapeHtml(user.displayName)}</div>
                        <div class="user-status">${rank.emoji} ${rank.name}</div>
                    </div>
                `;
                container.appendChild(userDiv);
            });
        }

        // ŸÅÿ™ÿ≠ ÿ•ÿ¨ÿ±ÿßÿ°ÿßÿ™ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ
        function openUserActions(user) {
            selectedUserId = user.userId;
            document.getElementById('actionUserName').textContent = user.displayName;
            document.getElementById('actionUserAvatar').src = 'https://images.pexels.com/photos/771742/pexels-photo-771742.jpeg?auto=compress&cs=tinysrgb&w=100&h=100&fit=crop';
            openModal('userActionsModal');
        }

        // ÿ®ÿØÿ° ÿØÿ±ÿØÿ¥ÿ© ÿÆÿßÿµÿ©
        function startPrivateChat() {
            if (!selectedUserId) return;
            chatMode = 'private';
            document.getElementById('chatModeText').textContent = 'ÿÆÿßÿµ';
            // ÿ™ÿ≠ÿØŸäÿ´ Ÿàÿßÿ¨Ÿáÿ© ÿßŸÑÿØÿ±ÿØÿ¥ÿ© ÿßŸÑÿÆÿßÿµÿ©
            loadPrivateMessages();
            closeAllModals();
            showNotification('ÿ™ŸÖ ÿßŸÑÿ™ÿ®ÿØŸäŸÑ ŸÑŸÑÿØÿ±ÿØÿ¥ÿ© ÿßŸÑÿÆÿßÿµÿ©', 'info');
        }

        // ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ±ÿ≥ÿßÿ¶ŸÑ ÿßŸÑÿÆÿßÿµÿ©
        async function loadPrivateMessages() {
            if (!selectedUserId) return;
            try {
                const token = localStorage.getItem('chatToken');
                const response = await fetch(`/api/private-messages/${selectedUserId}`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                if (response.ok) {
                    const messages = await response.json();
                    const container = document.getElementById('messagesContainer');
                    container.innerHTML = '';
                    messages.forEach(message => {
                        displayPrivateMessage(message);
                    });
                    scrollToBottom();
                }
            } catch (error) {
                console.error('ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ±ÿ≥ÿßÿ¶ŸÑ ÿßŸÑÿÆÿßÿµÿ©:', error);
            }
        }

        // ÿπÿ±ÿ∂ ÿ±ÿ≥ÿßŸÑÿ© ÿÆÿßÿµÿ©
        function displayPrivateMessage(message) {
            const container = document.getElementById('messagesContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${message.user_id === currentUser?.id ? 'own' : ''}`;
            messageDiv.setAttribute('data-message-id', message.id);
            const rank = RANKS[message.rank] || RANKS.visitor;
            const time = new Date(message.timestamp).toLocaleTimeString('ar-SA', {
                hour: '2-digit',
                minute: '2-digit'
            });
            let messageContent = '';
            if (message.message) {
                messageContent = `<div class="message-text">${escapeHtml(message.message)}</div>`;
            } else if (message.voice_url) {
                messageContent = `<audio class="message-audio" controls>
                    <source src="${message.voice_url}" type="audio/webm">
                </audio>`;
            } else if (message.image_url) {
                messageContent = `<img class="message-image" src="${message.image_url}" alt="ÿµŸàÿ±ÿ©" onclick="openImageModal('${message.image_url}')">`;
            }
            messageDiv.innerHTML = `
                <img class="message-avatar" src="https://images.pexels.com/photos/771742/pexels-photo-771742.jpeg?auto=compress&cs=tinysrgb&w=100&h=100&fit=crop" alt="${message.display_name}">
                <div class="message-content">
                    <div class="message-header">
                        <span class="message-author rank-${message.rank}">${escapeHtml(message.display_name)}</span>
                        <span class="message-rank">${rank.emoji} ${rank.name}</span>
                        <span class="message-time">${time}</span>
                    </div>
                    ${messageContent}
                </div>
            `;
            container.appendChild(messageDiv);
            scrollToBottom();
        }

        // ÿ™ÿ®ÿØŸäŸÑ Ÿàÿ∂ÿπ ÿßŸÑÿØÿ±ÿØÿ¥ÿ©
        function toggleChatMode() {
            if (chatMode === 'public') {
                // ÿßŸÑÿ™ÿ®ÿØŸäŸÑ ŸÑŸÑÿÆÿßÿµ Ÿäÿ™ÿ∑ŸÑÿ® ÿßÿÆÿ™Ÿäÿßÿ± ŸÖÿ≥ÿ™ÿÆÿØŸÖ
                showNotification('ÿßÿÆÿ™ÿ± ŸÖÿ≥ÿ™ÿÆÿØŸÖÿßŸã ŸÑÿ®ÿØÿ° ÿØÿ±ÿØÿ¥ÿ© ÿÆÿßÿµÿ©', 'info');
            } else {
                // ÿßŸÑÿπŸàÿØÿ© ŸÑŸÑÿπÿßŸÖ
                chatMode = 'public';
                selectedUserId = null;
                document.getElementById('chatModeText').textContent = 'ÿπÿßŸÖ';
                loadMessages();
                showNotification('ÿ™ŸÖ ÿßŸÑÿ™ÿ®ÿØŸäŸÑ ŸÑŸÑÿØÿ±ÿØÿ¥ÿ© ÿßŸÑÿπÿßŸÖÿ©', 'info');
            }
        }

        // ŸÅÿ™ÿ≠ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©
        function openMainMenu() {
            openModal('mainMenuModal');
        }

        // ÿ•ÿ∫ŸÑÿßŸÇ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿäÿ©
        function closeMainMenu() {
            closeModal('mainMenuModal');
        }

        // ŸÅÿ™ÿ≠ ŸÇÿ≥ŸÖ ÿßŸÑÿ£ÿÆÿ®ÿßÿ±
        function openNewsSection() {
            openModal('newsModal');
            loadNews();
            closeMainMenu();
        }

        // ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ£ÿÆÿ®ÿßÿ±
        async function loadNews() {
            try {
                const response = await fetch('/api/news');
                if (response.ok) {
                    const news = await response.json();
                    displayNews(news);
                }
            } catch (error) {
                console.error('ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ£ÿÆÿ®ÿßÿ±:', error);
            }
        }

        // ÿπÿ±ÿ∂ ÿßŸÑÿ£ÿÆÿ®ÿßÿ±
        function displayNews(news) {
            const container = document.getElementById('newsFeed');
            container.innerHTML = '';
            if (news.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--text-secondary);">ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ£ÿÆÿ®ÿßÿ± ÿ≠ÿßŸÑŸäÿßŸã</p>';
                return;
            }
            news.forEach(item => {
                const newsDiv = document.createElement('div');
                newsDiv.className = 'news-item';
                const time = new Date(item.timestamp).toLocaleString('ar-SA');
                newsDiv.innerHTML = `
                    <div class="news-header-info">
                        <img class="news-author-avatar" src="https://images.pexels.com/photos/771742/pexels-photo-771742.jpeg?auto=compress&cs=tinysrgb&w=100&h=100&fit=crop" alt="${item.display_name}">
                        <div class="news-author-info">
                            <h4>${escapeHtml(item.display_name)}</h4>
                            <span class="news-time">${time}</span>
                        </div>
                    </div>
                    <div class="news-content">${escapeHtml(item.content)}</div>
                    ${item.media ? `<div class="news-media"><img src="${item.media}" alt="ÿµŸàÿ±ÿ© ÿßŸÑÿÆÿ®ÿ±"></div>` : ''}
                `;
                container.appendChild(newsDiv);
            });
        }

        // ŸÜÿ¥ÿ± ÿÆÿ®ÿ±
        async function postNews() {
            const content = document.getElementById('newsContentInput').value.trim();
            const fileInput = document.getElementById('newsFileInput');
            if (!content && !fileInput.files[0]) {
                showError('Ÿäÿ±ÿ¨Ÿâ ŸÉÿ™ÿßÿ®ÿ© ŸÖÿ≠ÿ™ŸàŸâ ÿ£Ÿà ÿßÿÆÿ™Ÿäÿßÿ± ŸÖŸÑŸÅ');
                return;
            }
            const formData = new FormData();
            if (content) formData.append('content', content);
            if (fileInput.files[0]) formData.append('newsFile', fileInput.files[0]);
            try {
                showLoading(true);
                const response = await fetch('/api/news', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('chatToken')}`
                    },
                    body: formData
                });
                if (response.ok) {
                    document.getElementById('newsContentInput').value = '';
                    fileInput.value = '';
                    loadNews();
                    showNotification('ÿ™ŸÖ ŸÜÿ¥ÿ± ÿßŸÑÿÆÿ®ÿ± ÿ®ŸÜÿ¨ÿßÿ≠', 'success');
                } else {
                    const data = await response.json();
                    showError(data.error || 'ŸÅÿ¥ŸÑ ŸÅŸä ŸÜÿ¥ÿ± ÿßŸÑÿÆÿ®ÿ±');
                }
            } catch (error) {
                showError('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ŸÜÿ¥ÿ± ÿßŸÑÿÆÿ®ÿ±');
            } finally {
                showLoading(false);
            }
        }

        // ÿ•ÿ∫ŸÑÿßŸÇ ŸÖŸàÿØÿßŸÑ ÿßŸÑÿ£ÿÆÿ®ÿßÿ±
        function closeNewsModal() {
            closeModal('newsModal');
        }

        // ŸÅÿ™ÿ≠ ŸÇÿ≥ŸÖ ÿßŸÑŸÇÿµÿµ
        function openStoriesSection() {
            openModal('storiesModal');
            loadStories();
            closeMainMenu();
        }

        // ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÇÿµÿµ
        async function loadStories() {
            try {
                const response = await fetch('/api/stories');
                if (response.ok) {
                    const stories = await response.json();
                    displayStories(stories);
                }
            } catch (error) {
                console.error('ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÇÿµÿµ:', error);
            }
        }

        // ÿπÿ±ÿ∂ ÿßŸÑŸÇÿµÿµ
        function displayStories(stories) {
            const container = document.getElementById('storiesContainer');
            container.innerHTML = '';
            if (stories.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--text-secondary);">ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÇÿµÿµ ÿ≠ÿßŸÑŸäÿßŸã</p>';
                return;
            }
            stories.forEach(story => {
                const storyDiv = document.createElement('div');
                storyDiv.className = 'story-item';
                storyDiv.onclick = () => viewStory(story);
                storyDiv.innerHTML = `<img src="${story.image}" alt="ŸÇÿµÿ© ${story.display_name}">`;
                container.appendChild(storyDiv);
            });
        }

        // ŸÅÿ™ÿ≠ ŸÖŸàÿØÿßŸÑ ÿ•ÿ∂ÿßŸÅÿ© ŸÇÿµÿ©
        function openAddStoryModal() {
            openModal('addStoryModal');
        }

        // ÿ•ÿ∫ŸÑÿßŸÇ ŸÖŸàÿØÿßŸÑ ÿ•ÿ∂ÿßŸÅÿ© ŸÇÿµÿ©
        function closeAddStoryModal() {
            closeModal('addStoryModal');
        }

        // ÿ•ÿ∂ÿßŸÅÿ© ŸÇÿµÿ©
        async function addStory() {
            const fileInput = document.getElementById('storyMediaInput');
            const text = document.getElementById('storyTextInput').value.trim();
            if (!fileInput.files[0]) {
                showError('Ÿäÿ±ÿ¨Ÿâ ÿßÿÆÿ™Ÿäÿßÿ± ÿµŸàÿ±ÿ© ÿ£Ÿà ŸÅŸäÿØŸäŸà');
                return;
            }
            const formData = new FormData();
            formData.append('storyImage', fileInput.files[0]);
            if (text) formData.append('text', text);
            try {
                showLoading(true);
                const response = await fetch('/api/stories', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('chatToken')}`
                    },
                    body: formData
                });
                if (response.ok) {
                    closeAddStoryModal();
                    loadStories();
                    showNotification('ÿ™ŸÖ ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÇÿµÿ© ÿ®ŸÜÿ¨ÿßÿ≠', 'success');
                } else {
                    const data = await response.json();
                    showError(data.error || 'ŸÅÿ¥ŸÑ ŸÅŸä ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÇÿµÿ©');
                }
            } catch (error) {
                showError('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑŸÇÿµÿ©');
            } finally {
                showLoading(false);
            }
        }

        // ÿ•ÿ∫ŸÑÿßŸÇ ŸÖŸàÿØÿßŸÑ ÿßŸÑŸÇÿµÿµ
        function closeStoriesModal() {
            closeModal('storiesModal');
        }

        // ŸÅÿ™ÿ≠ ŸÇÿ≥ŸÖ ÿßŸÑÿ£ŸÑÿπÿßÿ®
        function openGamesSection() {
            showNotification('ÿßŸÑÿ£ŸÑÿπÿßÿ® ŸÇŸäÿØ ÿßŸÑÿ™ÿ∑ŸàŸäÿ±', 'info');
            closeMainMenu();
        }

        // ŸÅÿ™ÿ≠ ÿ∫ÿ±ŸÅÿ© ÿßŸÑŸÖÿ≥ÿßÿ®ŸÇÿßÿ™
        function openQuizRoom() {
            openModal('quizRoomModal');
            startQuiz();
            closeMainMenu();
        }

        // ÿ®ÿØÿ° ÿßŸÑŸÖÿ≥ÿßÿ®ŸÇÿ©
        function startQuiz() {
            const randomQuestion = QUIZ_QUESTIONS[Math.floor(Math.random() * QUIZ_QUESTIONS.length)];
            displayQuizQuestion(randomQuestion);
            startQuizTimerWithHints(randomQuestion.correct);
        }

        // ÿπÿ±ÿ∂ ÿ≥ÿ§ÿßŸÑ ÿßŸÑŸÖÿ≥ÿßÿ®ŸÇÿ©
        function displayQuizQuestion(question) {
            document.getElementById('questionText').textContent = question.question;
            const optionsContainer = document.getElementById('questionOptions');
            optionsContainer.innerHTML = '';
            question.options.forEach((option, index) => {
                const button = document.createElement('button');
                button.className = 'option-btn';
                button.textContent = `${String.fromCharCode(65 + index)}. ${option}`;
                button.onclick = () => selectQuizAnswer(index, question.correct);
                optionsContainer.appendChild(button);
            });
        }

        // ÿßÿÆÿ™Ÿäÿßÿ± ÿ•ÿ¨ÿßÿ®ÿ©
        function selectQuizAnswer(selected, correct) {
            const buttons = document.querySelectorAll('.option-btn');
            buttons.forEach((btn, index) => {
                btn.disabled = true;
                if (index === correct) {
                    btn.style.background = 'var(--success-color)';
                } else if (index === selected && selected !== correct) {
                    btn.style.background = 'var(--error-color)';
                }
            });
            
            if (selected === correct) {
                const pointsEarned = 10;
                showNotification('ÿ•ÿ¨ÿßÿ®ÿ© ÿµÿ≠Ÿäÿ≠ÿ©! +10 ŸÜŸÇÿßÿ∑', 'success');
                updateUserCoins(pointsEarned);
                updateUserQuizRank(pointsEarned); // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ™ÿ±ÿ™Ÿäÿ®
            } else {
                showNotification('ÿ•ÿ¨ÿßÿ®ÿ© ÿÆÿßÿ∑ÿ¶ÿ©', 'error');
            }
            
            // ÿ•ŸäŸÇÿßŸÅ ÿßŸÑŸÖÿ§ŸÇÿ™ ÿßŸÑÿ≠ÿßŸÑŸä
            if (contestTimer) {
                clearInterval(contestTimer);
            }
            
            setTimeout(() => {
                startQuiz(); // ÿ≥ÿ§ÿßŸÑ ÿ¨ÿØŸäÿØ
            }, 3000);
        }

        // ÿ®ÿØÿ° ŸÖÿ§ŸÇÿ™ ÿßŸÑŸÖÿ≥ÿßÿ®ŸÇÿ© ŸÖÿπ ÿßŸÑÿ™ŸÑŸÖŸäÿ≠ÿßÿ™
        function startQuizTimerWithHints(correctAnswerIndex) {
            let timeLeft = 15; // 15 ÿ´ÿßŸÜŸäÿ© ÿ£ŸàŸÑÿßŸã
            let hintShown = false;
            const timerElement = document.getElementById('quizTimer');
            const hintSection = document.getElementById('hintSection');
            const hintText = document.getElementById('hintText');
            const question = QUIZ_QUESTIONS.find(q => q.correct === correctAnswerIndex);
            
            // ÿ•ÿÆŸÅÿßÿ° ÿßŸÑÿ™ŸÑŸÖŸäÿ≠ ŸÅŸä ÿßŸÑÿ®ÿØÿßŸäÿ©
            hintSection.style.display = 'none';
            
            contestTimer = setInterval(() => {
                timeLeft--;
                timerElement.textContent = timeLeft;
                
                // ÿπÿ±ÿ∂ ÿßŸÑÿ™ŸÑŸÖŸäÿ≠ ÿ®ÿπÿØ 15 ÿ´ÿßŸÜŸäÿ©
                if (timeLeft <= 0 && !hintShown) {
                    hintShown = true;
                    timeLeft = 10; // ÿ•ÿπÿßÿØÿ© ÿßŸÑÿπÿØ ÿ•ŸÑŸâ 10 ÿ´ŸàÿßŸÜŸä ÿ•ÿ∂ÿßŸÅŸäÿ©
                    hintSection.style.display = 'block';
                    hintSection.style.animation = 'fadeIn 0.5s ease';
                    hintText.textContent = `ÿ™ŸÑŸÖŸäÿ≠: ${question.hint}`;
                    timerElement.textContent = timeLeft;
                }
                
                // ÿßŸÜÿ™Ÿáÿßÿ° ÿßŸÑŸàŸÇÿ™
                if (timeLeft <= 0) {
                    clearInterval(contestTimer);
                    if (!hintShown) {
                        // ŸÑŸÖ Ÿäÿ¨ÿßŸàÿ® ÿ£ÿ≠ÿØ ÿÆŸÑÿßŸÑ ÿßŸÑŸÄ 15 ÿ´ÿßŸÜŸäÿ© ÿßŸÑÿ£ŸàŸÑŸâ
                        hintShown = true;
                        hintSection.style.display = 'block';
                        hintSection.style.animation = 'fadeIn 0.5s ease';
                        hintText.textContent = `ÿ™ŸÑŸÖŸäÿ≠: ${question.hint}`;
                        setTimeout(() => {
                            revealAnswerAndNext(correctAnswerIndex);
                        }, 2000);
                    } else {
                        // ŸÑŸÖ Ÿäÿ¨ÿßŸàÿ® ÿ£ÿ≠ÿØ ÿ≠ÿ™Ÿâ ÿ®ÿπÿØ ÿßŸÑÿ™ŸÑŸÖŸäÿ≠
                        revealAnswerAndNext(correctAnswerIndex);
                    }
                }
            }, 1000);
        }

        // ÿπÿ±ÿ∂ ÿßŸÑÿ•ÿ¨ÿßÿ®ÿ© ŸàÿßŸÑÿßŸÜÿ™ŸÇÿßŸÑ ŸÑŸÑÿ≥ÿ§ÿßŸÑ ÿßŸÑÿ™ÿßŸÑŸä
        function revealAnswerAndNext(correctAnswerIndex) {
            const buttons = document.querySelectorAll('.option-btn');
            buttons.forEach((btn, index) => {
                btn.disabled = true;
                if (index === correctAnswerIndex) {
                    btn.style.background = 'var(--success-color)';
                }
            });
            showNotification(`ÿßŸÑÿ•ÿ¨ÿßÿ®ÿ© ÿßŸÑÿµÿ≠Ÿäÿ≠ÿ©: ${QUIZ_QUESTIONS.find(q => q.options[correctAnswerIndex])?.options[correctAnswerIndex]}`, 'info');
            setTimeout(() => {
                startQuiz(); // ÿ≥ÿ§ÿßŸÑ ÿ¨ÿØŸäÿØ
            }, 3000);
        }

        // ÿ™ÿ≠ÿØŸäÿ´ ÿ™ÿ±ÿ™Ÿäÿ® ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ŸÅŸä ÿßŸÑŸÖÿ≥ÿßÿ®ŸÇÿ©
        function updateUserQuizRank(points) {
            // ŸÖÿ≠ÿßŸÉÿßÿ© ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ™ÿ±ÿ™Ÿäÿ®
            let currentPoints = parseInt(document.getElementById('userQuizPoints').textContent) || 0;
            currentPoints += points;
            document.getElementById('userQuizPoints').textContent = currentPoints;
            // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ™ÿ±ÿ™Ÿäÿ® (ŸÖÿ≠ÿßŸÉÿßÿ©)
            document.getElementById('userQuizRank').textContent = `#${Math.floor(Math.random() * 10) + 1}`;
            // ÿ™ÿ≠ÿØŸäÿ´ ŸÑŸàÿ≠ÿ© ÿßŸÑŸÖÿ™ÿµÿØÿ±ŸäŸÜ
            updateLeaderboard(currentPoints);
        }

        // ÿ™ÿ≠ÿØŸäÿ´ ŸÑŸàÿ≠ÿ© ÿßŸÑŸÖÿ™ÿµÿØÿ±ŸäŸÜ
        function updateLeaderboard(userPoints) {
            const leaderboardList = document.getElementById('leaderboardList');
            leaderboardList.innerHTML = ''; // ŸÖÿ≥ÿ≠ ÿßŸÑŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿ≠ÿßŸÑŸäÿ©

            // ÿ•ŸÜÿ¥ÿßÿ° ŸÇÿßÿ¶ŸÖÿ© ŸàŸáŸÖŸäÿ©
            const mockLeaders = [
                { name: currentUser?.display_name || 'ÿ£ŸÜÿ™', score: userPoints },
                { name: 'ÿ£ÿ≠ŸÖÿØ', score: userPoints + 5 },
                { name: 'ÿ≥ÿßÿ±ÿ©', score: userPoints + 3 },
                { name: 'ŸÖÿ≠ŸÖÿØ', score: userPoints - 2 },
                { name: 'ŸÑŸäŸÑŸâ', score: userPoints - 5 }
            ];

            // ÿ™ÿ±ÿ™Ÿäÿ® ÿ≠ÿ≥ÿ® ÿßŸÑŸÜŸÇÿßÿ∑
            mockLeaders.sort((a, b) => b.score - a.score);

            mockLeaders.forEach((leader, index) => {
                const item = document.createElement('div');
                item.className = 'leaderboard-item';
                item.innerHTML = `
                    <span class="rank">${index + 1}.</span>
                    <span class="username">${leader.name}</span>
                    <span class="score">${leader.score}</span>
                `;
                if (leader.name === (currentUser?.display_name || 'ÿ£ŸÜÿ™')) {
                    item.style.color = 'gold';
                    item.style.fontWeight = 'bold';
                }
                leaderboardList.appendChild(item);
            });
        }

        // ÿ•ÿ∫ŸÑÿßŸÇ ÿ∫ÿ±ŸÅÿ© ÿßŸÑŸÖÿ≥ÿßÿ®ŸÇÿßÿ™
        function closeQuizRoom() {
            if (contestTimer) {
                clearInterval(contestTimer);
            }
            closeModal('quizRoomModal');
        }

        // ŸÅÿ™ÿ≠ ÿ•ÿØÿßÿ±ÿ© ÿßŸÑÿ∫ÿ±ŸÅ
        function openRoomsManager() {
            if (!hasPermission('create_room')) {
                showError('ÿ∫Ÿäÿ± ŸÖÿ≥ŸÖŸàÿ≠ - ŸÑŸÑÿ•ÿØÿßÿ±ŸäŸäŸÜ ŸÅŸÇÿ∑');
                return;
            }
            openModal('adminModal');
            showAdminTab('rooms');
            closeMainMenu();
        }

        // ŸÅÿ™ÿ≠ ŸÖÿ™ÿ¨ÿ± ÿßŸÑŸÜŸÇÿßÿ∑
        function openCoinsShop() {
            showNotification('ŸÖÿ™ÿ¨ÿ± ÿßŸÑŸÜŸÇÿßÿ∑ ŸÇŸäÿØ ÿßŸÑÿ™ÿ∑ŸàŸäÿ±', 'info');
            closeMainMenu();
        }

        // ŸÅÿ™ÿ≠ ŸÑŸàÿ≠ÿ© ÿßŸÑÿ•ÿØÿßÿ±ÿ©
        function openAdminPanel() {
            if (!hasPermission('create_room') && currentUser?.role !== 'owner') {
                showError('ÿ∫Ÿäÿ± ŸÖÿ≥ŸÖŸàÿ≠ - ŸÑŸÑÿ•ÿØÿßÿ±ŸäŸäŸÜ ŸÅŸÇÿ∑');
                return;
            }
            openModal('adminModal');
            loadAdminData();
            closeMainMenu();
        }

        // ÿ™ÿ≠ŸÖŸäŸÑ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ•ÿØÿßÿ±ÿ©
        async function loadAdminData() {
            await loadAllUsers();
            loadRanks();
            loadAuditLog(); // ÿ™ÿ≠ŸÖŸäŸÑ ÿ≥ÿ¨ŸÑ ÿßŸÑÿ±ŸÇÿßÿ®ÿ©
        }

        // ÿ™ÿ≠ŸÖŸäŸÑ ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ
        async function loadAllUsers() {
            try {
                const response = await fetch('/api/all-users', {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('chatToken')}`
                    }
                });
                if (response.ok) {
                    const users = await response.json();
                    displayAdminUsers(users);
                }
            } catch (error) {
                console.error('ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ:', error);
            }
        }

        // ÿπÿ±ÿ∂ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ ŸÅŸä ŸÑŸàÿ≠ÿ© ÿßŸÑÿ•ÿØÿßÿ±ÿ©
        function displayAdminUsers(users) {
            const container = document.getElementById('adminUsersList');
            container.innerHTML = '';
            users.forEach(user => {
                const userDiv = document.createElement('div');
                userDiv.className = 'admin-user-item';
                const rank = RANKS[user.rank] || RANKS.visitor;
                const joinDate = new Date(user.created_at).toLocaleDateString('ar-SA');
                userDiv.innerHTML = `
                    <div class="admin-user-info">
                        <img class="admin-user-avatar" src="${user.profile_image1 || 'https://images.pexels.com/photos/771742/pexels-photo-771742.jpeg?auto=compress&cs=tinysrgb&w=100&h=100&fit=crop'}" alt="${user.display_name}">
                        <div class="admin-user-details">
                            <h4>${escapeHtml(user.display_name)}</h4>
                            <div class="admin-user-rank">${rank.emoji} ${rank.name} ‚Ä¢ ÿßŸÜÿ∂ŸÖ ŸÅŸä ${joinDate}</div>
                        </div>
                    </div>
                    <div class="admin-user-actions">
                        <button class="admin-action-btn btn-info" onclick="openAssignRankModal(${user.id}, '${user.display_name}')">
                            <i class="fas fa-crown"></i> ÿ±ÿ™ÿ®ÿ©
                        </button>
                        <button class="admin-action-btn btn-warning" onclick="openBanUserModal(${user.id}, '${user.display_name}')">
                            <i class="fas fa-ban"></i> ÿ≠ÿ∏ÿ±
                        </button>
                        <button class="admin-action-btn btn-success" onclick="openGiveCoinsModal(${user.id}, '${user.display_name}')">
                            <i class="fas fa-coins"></i> ŸÜŸÇÿßÿ∑
                        </button>
                    </div>
                `;
                container.appendChild(userDiv);
            });
        }

        // ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ±ÿ™ÿ®
        function loadRanks() {
            const container = document.getElementById('ranksList');
            container.innerHTML = '';
            Object.entries(RANKS).forEach(([key, rank]) => {
                const rankDiv = document.createElement('div');
                rankDiv.className = 'rank-item';
                rankDiv.innerHTML = `
                    <div class="rank-emoji">${rank.emoji}</div>
                    <div class="rank-name">${rank.name}</div>
                    <div class="rank-level">ÿßŸÑŸÖÿ≥ÿ™ŸàŸâ ${rank.level}</div>
                    <div class="rank-permissions">${rank.permissions.join(', ') || 'ŸÑÿß ÿµŸÑÿßÿ≠Ÿäÿßÿ™'}</div>
                `;
                container.appendChild(rankDiv);
            });
        }

        // ŸÅÿ™ÿ≠ ŸÖŸàÿØÿßŸÑ ÿ™ÿπŸäŸäŸÜ ÿßŸÑÿ±ÿ™ÿ®ÿ©
        function openAssignRankModal(userId, userName) {
            document.getElementById('rankTargetUser').textContent = userName;
            document.getElementById('rankTargetUser').setAttribute('data-user-id', userId);
            // ŸÖŸÑÿ° ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿ±ÿ™ÿ®
            const select = document.getElementById('newRankSelect');
            select.innerHTML = '';
            Object.entries(RANKS).forEach(([key, rank]) => {
                const option = document.createElement('option');
                option.value = key;
                option.textContent = `${rank.emoji} ${rank.name}`;
                select.appendChild(option);
            });
            openModal('assignRankModal');
        }

        // ÿ™ÿ£ŸÉŸäÿØ ÿ™ÿπŸäŸäŸÜ ÿßŸÑÿ±ÿ™ÿ®ÿ©
        async function confirmAssignRank() {
            const userId = document.getElementById('rankTargetUser').getAttribute('data-user-id');
            const newRank = document.getElementById('newRankSelect').value;
            const reason = document.getElementById('rankChangeReason').value.trim();
            if (!newRank) {
                showError('Ÿäÿ±ÿ¨Ÿâ ÿßÿÆÿ™Ÿäÿßÿ± ÿ±ÿ™ÿ®ÿ©');
                return;
            }
            try {
                showLoading(true);
                const response = await fetch('/api/assign-rank', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('chatToken')}`
                    },
                    body: JSON.stringify({
                        userId: parseInt(userId),
                        newRank,
                        reason
                    })
                });
                const data = await response.json();
                if (response.ok) {
                    // ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ° ŸÅŸä ÿ≥ÿ¨ŸÑ ÿßŸÑÿ±ŸÇÿßÿ®ÿ©
                    logAuditAction('assign_rank', userId, reason, newRank);
                    closeAssignRankModal();
                    loadAllUsers();
                    showNotification(data.message, 'success');
                } else {
                    showError(data.error);
                }
            } catch (error) {
                showError('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿπŸäŸäŸÜ ÿßŸÑÿ±ÿ™ÿ®ÿ©');
            } finally {
                showLoading(false);
            }
        }

        // ÿ•ÿ∫ŸÑÿßŸÇ ŸÖŸàÿØÿßŸÑ ÿ™ÿπŸäŸäŸÜ ÿßŸÑÿ±ÿ™ÿ®ÿ©
        function closeAssignRankModal() {
            closeModal('assignRankModal');
            document.getElementById('rankChangeReason').value = '';
        }

        // ŸÅÿ™ÿ≠ ŸÖŸàÿØÿßŸÑ ÿ≠ÿ∏ÿ± ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ
        function openBanUserModal(userId, userName) {
            document.getElementById('banTargetUser').textContent = userName;
            document.getElementById('banTargetUser').setAttribute('data-user-id', userId);
            openModal('banUserModal');
        }

        // ÿ™ÿ£ŸÉŸäÿØ ÿ≠ÿ∏ÿ± ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ
        async function confirmBanUser() {
            const userId = document.getElementById('banTargetUser').getAttribute('data-user-id');
            const reason = document.getElementById('banReason').value.trim();
            const duration = document.getElementById('banDuration').value;
            if (!reason) {
                showError('Ÿäÿ±ÿ¨Ÿâ ŸÉÿ™ÿßÿ®ÿ© ÿ≥ÿ®ÿ® ÿßŸÑÿ≠ÿ∏ÿ±');
                return;
            }
            try {
                showLoading(true);
                const response = await fetch('/api/ban', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('chatToken')}`
                    },
                    body: JSON.stringify({
                        userId: parseInt(userId),
                        reason,
                        duration
                    })
                });
                const data = await response.json();
                if (response.ok) {
                    // ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ° ŸÅŸä ÿ≥ÿ¨ŸÑ ÿßŸÑÿ±ŸÇÿßÿ®ÿ©
                    logAuditAction('ban', userId, reason, duration);
                    closeBanUserModal();
                    loadAllUsers();
                    showNotification(data.message, 'success');
                } else {
                    showError(data.error);
                }
            } catch (error) {
                showError('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿ≠ÿ∏ÿ± ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ');
            } finally {
                showLoading(false);
            }
        }

        // ÿ•ÿ∫ŸÑÿßŸÇ ŸÖŸàÿØÿßŸÑ ÿ≠ÿ∏ÿ± ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ
        function closeBanUserModal() {
            closeModal('banUserModal');
            document.getElementById('banReason').value = '';
        }

        // ŸÅÿ™ÿ≠ ŸÖŸàÿØÿßŸÑ ŸÉÿ™ŸÖ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ
        function openMuteUserModal() {
            const userId = document.getElementById('actionUserAvatar').parentElement.querySelector('#actionUserName').getAttribute('data-user-id');
            const userName = document.getElementById('actionUserName').textContent;
            document.getElementById('muteTargetUser').textContent = userName;
            document.getElementById('muteTargetUser').setAttribute('data-user-id', userId);
            openModal('muteUserModal');
        }

        // ŸÉÿ™ŸÖ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ
        async function muteUser() {
            const userId = document.getElementById('muteTargetUser').getAttribute('data-user-id');
            const reason = document.getElementById('muteReason').value.trim();
            const duration = document.getElementById('muteDuration').value;
            
            if (!reason) {
                showError('Ÿäÿ±ÿ¨Ÿâ ŸÉÿ™ÿßÿ®ÿ© ÿ≥ÿ®ÿ® ÿßŸÑŸÉÿ™ŸÖ');
                return;
            }
            
            try {
                showLoading(true);
                const response = await fetch('/api/mute', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('chatToken')}`
                    },
                    body: JSON.stringify({
                        userId: parseInt(userId),
                        reason,
                        duration
                    })
                });
                const data = await response.json();
                if (response.ok) {
                    // ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ° ŸÅŸä ÿ≥ÿ¨ŸÑ ÿßŸÑÿ±ŸÇÿßÿ®ÿ©
                    logAuditAction('mute', userId, reason, duration);
                    closeModal('muteUserModal');
                    showNotification(`ÿ™ŸÖ ŸÉÿ™ŸÖ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿ®ÿ≥ÿ®ÿ®: ${reason}`, 'warning');
                } else {
                    showError(data.error);
                }
            } catch (error) {
                showError('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ŸÉÿ™ŸÖ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ');
            } finally {
                showLoading(false);
            }
        }

        // ŸÅÿ™ÿ≠ ŸÖŸàÿØÿßŸÑ ÿ•ŸáÿØÿßÿ° ÿßŸÑŸÜŸÇÿßÿ∑
        function openGiveCoinsModal(userId, userName) {
            document.getElementById('coinsTargetUser').textContent = userName;
            document.getElementById('coinsTargetUser').setAttribute('data-user-id', userId);
            openModal('giveCoinsModal');
        }

        // ÿ•ŸáÿØÿßÿ° ÿßŸÑŸÜŸÇÿßÿ∑
        async function giveCoins() {
            const userId = document.getElementById('coinsTargetUser').getAttribute('data-user-id');
            const amount = document.getElementById('coinsAmount').value;
            const reason = document.getElementById('coinsReason').value;
            if (!amount || amount < 1 || amount > 10000) {
                showError('Ÿäÿ±ÿ¨Ÿâ ÿ•ÿØÿÆÿßŸÑ ÿπÿØÿØ ÿµÿ≠Ÿäÿ≠ ŸÖŸÜ ÿßŸÑŸÜŸÇÿßÿ∑ (1-10000)');
                return;
            }
            try {
                showLoading(true);
                const response = await fetch('/api/give-coins', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('chatToken')}`
                    },
                    body: JSON.stringify({
                        userId: parseInt(userId),
                        amount: parseInt(amount),
                        reason: reason
                    })
                });
                const data = await response.json();
                if (response.ok) {
                    // ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ° ŸÅŸä ÿ≥ÿ¨ŸÑ ÿßŸÑÿ±ŸÇÿßÿ®ÿ©
                    logAuditAction('give_coins', userId, reason, amount);
                    closeGiveCoinsModal();
                    loadAllUsers();
                    showNotification(`ÿ™ŸÖ ÿ•ŸáÿØÿßÿ° ${amount} ŸÜŸÇÿ∑ÿ© ÿ®ŸÜÿ¨ÿßÿ≠`, 'success');
                } else {
                    showError(data.error);
                }
            } catch (error) {
                showError('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿ•ŸáÿØÿßÿ° ÿßŸÑŸÜŸÇÿßÿ∑');
            } finally {
                showLoading(false);
            }
        }

        // ÿ•ÿ∫ŸÑÿßŸÇ ŸÖŸàÿØÿßŸÑ ÿ•ŸáÿØÿßÿ° ÿßŸÑŸÜŸÇÿßÿ∑
        function closeGiveCoinsModal() {
            closeModal('giveCoinsModal');
            document.getElementById('coinsAmount').value = '';
            document.getElementById('coinsReason').value = '';
        }

        // ÿ•ÿ∫ŸÑÿßŸÇ ŸÑŸàÿ≠ÿ© ÿßŸÑÿ•ÿØÿßÿ±ÿ©
        function closeAdminModal() {
            closeModal('adminModal');
        }

        // ÿπÿ±ÿ∂ ÿ™ÿ®ŸàŸäÿ® ÿßŸÑÿ•ÿØÿßÿ±ÿ©
        function showAdminTab(tabName) {
            // ÿ•ÿÆŸÅÿßÿ° ÿ¨ŸÖŸäÿπ ÿßŸÑÿ™ÿ®ŸàŸäÿ®ÿßÿ™
            document.querySelectorAll('.admin-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            // ÿ•ÿ≤ÿßŸÑÿ© ÿßŸÑŸÅÿ¶ÿ© ÿßŸÑŸÜÿ¥ÿ∑ÿ© ŸÖŸÜ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ£ÿ≤ÿ±ÿßÿ±
            document.querySelectorAll('.admin-tabs .tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            // ÿπÿ±ÿ∂ ÿßŸÑÿ™ÿ®ŸàŸäÿ® ÿßŸÑŸÖÿ≠ÿØÿØ
            document.getElementById(`admin${tabName.charAt(0).toUpperCase() + tabName.slice(1)}Tab`).classList.add('active');
            // ÿ™ŸÅÿπŸäŸÑ ÿßŸÑÿ≤ÿ± ÿßŸÑŸÖÿ≠ÿØÿØ
            event.target.classList.add('active');
        }

        // ŸÅÿ™ÿ≠ ÿßŸÑŸÖŸÑŸÅ ÿßŸÑÿ¥ÿÆÿµŸä
        function openProfileModal() {
            if (!currentUser) return;
            // ŸÖŸÑÿ° ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ≠ÿßŸÑŸäÿ©
            document.getElementById('displayNameInput').value = currentUser.display_name || '';
            document.getElementById('emailInput').value = currentUser.email || '';
            document.getElementById('ageInput').value = currentUser.age || '';
            document.getElementById('genderInput').value = currentUser.gender || '';
            document.getElementById('maritalStatusInput').value = currentUser.marital_status || '';
            document.getElementById('aboutMeInput').value = currentUser.about_me || '';
            // ÿπÿ±ÿ∂ ÿßŸÑÿµŸàÿ± ÿßŸÑÿ≠ÿßŸÑŸäÿ©
            if (currentUser.profile_image1) {
                document.getElementById('profileImg1').src = currentUser.profile_image1;
            }
            if (currentUser.profile_image2) {
                document.getElementById('profileImg2').src = currentUser.profile_image2;
            }
            // ÿπÿ±ÿ∂ ÿßŸÑÿ•ÿ≠ÿµÿßÿ¶Ÿäÿßÿ™
            document.getElementById('profileCoins').textContent = currentUser.coins || 2000;
            document.getElementById('profileRank').textContent = RANKS[currentUser.rank]?.name || 'ÿ≤ÿßÿ¶ÿ±';
            // ÿ™ÿ¥ÿ∫ŸäŸÑ ŸÖŸàÿ≥ŸäŸÇŸâ ÿßŸÑÿ®ÿ±ŸàŸÅÿßŸäŸÑ ÿ•ÿ∞ÿß ŸÉÿßŸÜÿ™ ŸÖŸàÿ¨ŸàÿØÿ©
            if (currentUser.profile_music) {
                autoPlayProfileMusic(currentUser.profile_music);
            }
            openModal('profileModal');
        }

        // ÿ•ÿ∫ŸÑÿßŸÇ ÿßŸÑŸÖŸÑŸÅ ÿßŸÑÿ¥ÿÆÿµŸä
        function closeProfileModal() {
            closeModal('profileModal');
        }

        // ÿπÿ±ÿ∂ ÿ™ÿ®ŸàŸäÿ® ÿßŸÑŸÖŸÑŸÅ ÿßŸÑÿ¥ÿÆÿµŸä
        function showProfileTab(tabName) {
            // ÿ•ÿÆŸÅÿßÿ° ÿ¨ŸÖŸäÿπ ÿßŸÑÿ™ÿ®ŸàŸäÿ®ÿßÿ™
            document.querySelectorAll('.profile-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            // ÿ•ÿ≤ÿßŸÑÿ© ÿßŸÑŸÅÿ¶ÿ© ÿßŸÑŸÜÿ¥ÿ∑ÿ© ŸÖŸÜ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ£ÿ≤ÿ±ÿßÿ±
            document.querySelectorAll('.profile-tabs .tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            // ÿπÿ±ÿ∂ ÿßŸÑÿ™ÿ®ŸàŸäÿ® ÿßŸÑŸÖÿ≠ÿØÿØ
            document.getElementById(`profile${tabName.charAt(0).toUpperCase() + tabName.slice(1)}Tab`).classList.add('active');
            // ÿ™ŸÅÿπŸäŸÑ ÿßŸÑÿ≤ÿ± ÿßŸÑŸÖÿ≠ÿØÿØ
            event.target.classList.add('active');
        }

        // ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÖŸÑŸÅ ÿßŸÑÿ¥ÿÆÿµŸä
        async function updateProfile() {
            const formData = new FormData();
            const displayName = document.getElementById('displayNameInput').value.trim();
            const email = document.getElementById('emailInput').value.trim();
            const newPassword = document.getElementById('newPasswordInput').value;
            const age = document.getElementById('ageInput').value;
            const gender = document.getElementById('genderInput').value;
            const maritalStatus = document.getElementById('maritalStatusInput').value;
            const aboutMe = document.getElementById('aboutMeInput').value.trim();
            if (displayName) formData.append('display_name', displayName);
            if (email) formData.append('email', email);
            if (newPassword) formData.append('password', newPassword);
            if (age) formData.append('age', age);
            if (gender) formData.append('gender', gender);
            if (maritalStatus) formData.append('marital_status', maritalStatus);
            if (aboutMe) formData.append('about_me', aboutMe);
            // ÿ•ÿ∂ÿßŸÅÿ© ÿßŸÑÿµŸàÿ± ÿ•ÿ∞ÿß ÿ™ŸÖ ÿßÿÆÿ™Ÿäÿßÿ±Ÿáÿß
            const profileFile1 = document.getElementById('profileFile1').files[0];
            const profileFile2 = document.getElementById('profileFile2').files[0];
            if (profileFile1) formData.append('profileImage1', profileFile1);
            if (profileFile2) formData.append('profileImage2', profileFile2);
            try {
                showLoading(true);
                const response = await fetch('/api/user/profile', {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('chatToken')}`
                    },
                    body: formData
                });
                if (response.ok) {
                    const updatedUser = await response.json();
                    currentUser = { ...currentUser, ...updatedUser };
                    updateUserInterface();
                    showNotification('ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÖŸÑŸÅ ÿßŸÑÿ¥ÿÆÿµŸä ÿ®ŸÜÿ¨ÿßÿ≠', 'success');
                } else {
                    const data = await response.json();
                    showError(data.error || 'ŸÅÿ¥ŸÑ ŸÅŸä ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÖŸÑŸÅ ÿßŸÑÿ¥ÿÆÿµŸä');
                }
            } catch (error) {
                showError('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑŸÖŸÑŸÅ ÿßŸÑÿ¥ÿÆÿµŸä');
            } finally {
                showLoading(false);
            }
        }

        // ŸÅÿ™ÿ≠ ŸÖŸÑŸÅ ÿ¥ÿÆÿµŸä ŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿ¢ÿÆÿ±
        function openUserProfile(userId) {
            // Ÿáÿ∞Ÿá ÿßŸÑŸàÿ∏ŸäŸÅÿ© ÿ≥ÿ™ŸÉŸàŸÜ ŸÖÿ™ÿßÿ≠ÿ© ŸÑÿßÿ≠ŸÇÿßŸã
            showNotification('ÿπÿ±ÿ∂ ÿßŸÑŸÖŸÑŸÅ ÿßŸÑÿ¥ÿÆÿµŸä ŸÇŸäÿØ ÿßŸÑÿ™ÿ∑ŸàŸäÿ±', 'info');
        }

        // ŸÅÿ™ÿ≠ ÿßŸÑÿ•ÿ¥ÿπÿßÿ±ÿßÿ™
        function openNotifications() {
            openModal('notificationsModal');
            loadNotifications();
        }

        // ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ•ÿ¥ÿπÿßÿ±ÿßÿ™
        function loadNotifications() {
            const container = document.getElementById('notificationsList');
            container.innerHTML = '<p style="text-align: center; color: var(--text-secondary);">ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ•ÿ¥ÿπÿßÿ±ÿßÿ™ ÿ¨ÿØŸäÿØÿ©</p>';
            // ŸäŸÖŸÉŸÜŸÉ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ•ÿ¥ÿπÿßÿ±ÿßÿ™ ÿßŸÑÿ≠ŸÇŸäŸÇŸäÿ© ŸÖŸÜ ÿßŸÑÿÆÿßÿØŸÖ ŸáŸÜÿß
        }

        // ÿ•ÿ∫ŸÑÿßŸÇ ÿßŸÑÿ•ÿ¥ÿπÿßÿ±ÿßÿ™
        function closeNotificationsModal() {
            closeModal('notificationsModal');
        }

        // ÿ™ÿ≠ÿØŸäÿ´ ÿπÿØÿØ ÿßŸÑÿ•ÿ¥ÿπÿßÿ±ÿßÿ™
        function updateNotificationCount() {
            const badge = document.getElementById('notificationCount');
            let count = parseInt(badge.textContent) || 0;
            count++;
            badge.textContent = count;
            badge.style.display = count > 0 ? 'block' : 'none';
        }

        // ŸÅÿ™ÿ≠ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™
        function openSettings() {
            openModal('settingsModal');
        }

        // ÿ•ÿ∫ŸÑÿßŸÇ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™
        function closeSettingsModal() {
            closeModal('settingsModal');
        }

        // ÿ≠ŸÅÿ∏ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™
        function saveSettings() {
            const soundNotifications = document.getElementById('soundNotifications').checked;
            const saveChatHistory = document.getElementById('saveChatHistory').checked;
            const filterBadWords = document.getElementById('filterBadWords').checked;
            localStorage.setItem('soundNotifications', soundNotifications);
            localStorage.setItem('saveChatHistory', saveChatHistory);
            localStorage.setItem('filterBadWords', filterBadWords);
            showNotification('ÿ™ŸÖ ÿ≠ŸÅÿ∏ ÿßŸÑÿ•ÿπÿØÿßÿØÿßÿ™', 'success');
            closeSettingsModal();
        }

        // ÿßŸÑÿÆÿ±Ÿàÿ¨ ŸÖŸÜ ÿßŸÑÿØÿ±ÿØÿ¥ÿ©
        function exitChat() {
            if (confirm('ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿßŸÑÿÆÿ±Ÿàÿ¨ÿü')) {
                logout();
            }
        }

        // ÿßŸÑÿÆÿ±Ÿàÿ¨ ŸÖŸÜ ÿßŸÑÿ∫ÿ±ŸÅÿ©
        function exitRoom() {
            currentRoom = 1;
            document.getElementById('roomSelect').value = 1;
            changeRoom();
            closeSettingsModal();
            showNotification('ÿ™ŸÖ ÿßŸÑÿÆÿ±Ÿàÿ¨ ŸÖŸÜ ÿßŸÑÿ∫ÿ±ŸÅÿ©', 'info');
        }

        // ŸÅÿ™ÿ≠ ÿßŸÑŸÖÿ≥ÿßÿπÿØÿ©
        function openHelpModal() {
            showNotification('ÿßŸÑŸÖÿ≥ÿßÿπÿØÿ© ŸÇŸäÿØ ÿßŸÑÿ™ÿ∑ŸàŸäÿ±', 'info');
        }

        // ÿπÿ±ÿ∂ ÿßŸÑÿ±ÿ™ÿ®
        function showRanks() {
            let ranksText = 'ÿßŸÑÿ±ÿ™ÿ® ÿßŸÑŸÖÿ™ÿßÿ≠ÿ©:
';
            Object.values(RANKS).forEach(rank => {
                ranksText += `${rank.emoji} ${rank.name} (ÿßŸÑŸÖÿ≥ÿ™ŸàŸâ ${rank.level}) - ÿßŸÑÿµŸÑÿßÿ≠Ÿäÿßÿ™: ${rank.permissions.join(', ') || 'ŸÑÿß ÿ¥Ÿäÿ°'}
`;
            });
            alert(ranksText);
        }

        // ÿ™ŸÜÿ∏ŸäŸÅ ÿßŸÑÿ∫ÿ±ŸÅ
        async function cleanRooms() {
            if (!hasPermission('delete_room') && currentUser?.role !== 'owner') {
                showError('ÿ∫Ÿäÿ± ŸÖÿ≥ŸÖŸàÿ≠ - ŸÑŸÑÿ•ÿØÿßÿ±ŸäŸäŸÜ ŸÅŸÇÿ∑');
                return;
            }
            if (confirm('ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ™ŸÜÿ∏ŸäŸÅ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ±ÿ≥ÿßÿ¶ŸÑÿü')) {
                try {
                    const response = await fetch('/api/clean-rooms', {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${localStorage.getItem('chatToken')}`
                        }
                    });
                    if (response.ok) {
                        document.getElementById('messagesContainer').innerHTML = '';
                        showNotification('ÿ™ŸÖ ÿ™ŸÜÿ∏ŸäŸÅ ÿßŸÑÿ∫ÿ±ŸÅÿ© ÿ®ŸÜÿ¨ÿßÿ≠', 'success');
                    } else {
                        showError('ŸÅÿ¥ŸÑ ŸÅŸä ÿ™ŸÜÿ∏ŸäŸÅ ÿßŸÑÿ∫ÿ±ŸÅÿ©');
                    }
                } catch (error) {
                    showError('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ŸÜÿ∏ŸäŸÅ ÿßŸÑÿ∫ÿ±ŸÅÿ©');
                }
            }
        }

        // ŸÅÿ™ÿ≠ ŸÖÿ¥ÿ∫ŸÑ ÿßŸÑÿ±ÿßÿØŸäŸà
        function openRadioPlayer() {
            openModal('radioPlayerModal');
        }

        // ÿ•ÿ∫ŸÑÿßŸÇ ŸÖÿ¥ÿ∫ŸÑ ÿßŸÑÿ±ÿßÿØŸäŸà
        function closeRadioPlayer() {
            closeModal('radioPlayerModal');
        }

        // ÿ™ÿ¥ÿ∫ŸäŸÑ ŸÖÿ≠ÿ∑ÿ© ÿ±ÿßÿØŸäŸà
        function playRadioStation(station) {
            showNotification(`ÿ™ŸÖ ÿ™ÿ¥ÿ∫ŸäŸÑ ŸÖÿ≠ÿ∑ÿ© ${station}`, 'success');
            // ŸáŸÜÿß ŸäŸÖŸÉŸÜ ÿ•ÿ∂ÿßŸÅÿ© ŸÉŸàÿØ ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿ±ÿßÿØŸäŸà ÿßŸÑŸÅÿπŸÑŸä
        }

        // ÿ™ÿ®ÿØŸäŸÑ ÿßŸÑÿ±ÿßÿØŸäŸà
        function toggleRadio() {
            const btn = document.getElementById('radioPlayBtn');
            const icon = btn.querySelector('i');
            if (icon.classList.contains('fa-play')) {
                icon.classList.remove('fa-play');
                icon.classList.add('fa-pause');
                showNotification('ÿ™ŸÖ ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿ±ÿßÿØŸäŸà', 'success');
            } else {
                icon.classList.remove('fa-pause');
                icon.classList.add('fa-play');
                showNotification('ÿ™ŸÖ ÿ•ŸäŸÇÿßŸÅ ÿßŸÑÿ±ÿßÿØŸäŸà', 'info');
            }
        }

        // ÿ±ŸÅÿπ ŸÖŸàÿ≥ŸäŸÇŸâ ŸÖÿÆÿµÿµÿ©
        function uploadCustomMusic() {
            const fileInput = document.getElementById('customMusicInput');
            if (fileInput.files.length === 0) {
                showError('Ÿäÿ±ÿ¨Ÿâ ÿßÿÆÿ™Ÿäÿßÿ± ŸÖŸÑŸÅÿßÿ™ ÿµŸàÿ™Ÿäÿ©');
                return;
            }
            if (!hasPermission('upload_music')) {
                showNotification('Ÿáÿ∞Ÿá ÿßŸÑŸÖŸäÿ≤ÿ© ŸÖÿ™ÿßÿ≠ÿ© ŸÑŸÑÿ±ÿ™ÿ® ÿßŸÑÿπÿßŸÑŸäÿ© ŸÅŸÇÿ∑', 'error');
                return;
            }
            showNotification('ÿ™ŸÖ ÿ±ŸÅÿπ ÿßŸÑÿ£ÿ∫ÿßŸÜŸä ÿ®ŸÜÿ¨ÿßÿ≠', 'success');
            fileInput.value = '';
        }

        // ÿ™ÿ®ÿØŸäŸÑ ŸÖÿ¥ÿ∫ŸÑ ÿßŸÑŸÖŸàÿ≥ŸäŸÇŸâ
        function toggleMusicPlayer() {
            const btn = document.getElementById('musicToggle');
            const nowPlaying = document.getElementById('nowPlaying');
            if (nowPlaying.style.display === 'none') {
                nowPlaying.style.display = 'block';
                nowPlaying.querySelector('.song-title').textContent = 'ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑŸÖŸàÿ≥ŸäŸÇŸâ...';
                showNotification('ÿ™ŸÖ ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑŸÖŸàÿ≥ŸäŸÇŸâ', 'success');
            } else {
                nowPlaying.style.display = 'none';
                showNotification('ÿ™ŸÖ ÿ•ŸäŸÇÿßŸÅ ÿßŸÑŸÖŸàÿ≥ŸäŸÇŸâ', 'info');
            }
        }

        // ÿßŸÑÿ®ÿ≠ÿ´ ÿπŸÜ ÿ£ÿ∫ŸÜŸäÿ©
        function searchMusic() {
            const query = document.getElementById('musicSearchInput').value.trim();
            if (!query) {
                showNotification('Ÿäÿ±ÿ¨Ÿâ ŸÉÿ™ÿßÿ®ÿ© ÿßÿ≥ŸÖ ÿßŸÑÿ£ÿ∫ŸÜŸäÿ© ŸÑŸÑÿ®ÿ≠ÿ´', 'warning');
                return;
            }
            const resultsContainer = document.getElementById('searchResults');
            resultsContainer.innerHTML = '<p style="text-align: center; padding: 10px;">ÿ¨ÿßÿ±Ÿç ÿßŸÑÿ®ÿ≠ÿ´...</p>';

            // ŸÖÿ≠ÿßŸÉÿßÿ© ŸÜÿ™ÿßÿ¶ÿ¨ ÿßŸÑÿ®ÿ≠ÿ´
            setTimeout(() => {
                const mockResults = [
                    { title: 'ÿ£ÿ∫ŸÜŸäÿ© ÿ¨ŸÖŸäŸÑÿ©', artist: 'ŸÅŸÜÿßŸÜ ŸÖÿ¥ŸáŸàÿ±', cover: 'https://via.placeholder.com/50', url: '#song1' },
                    { title: 'ÿ£ÿ∫ŸÜŸäÿ© ÿ±ŸàŸÖÿßŸÜÿ≥Ÿäÿ©', artist: 'ŸÖÿ∑ÿ±ÿ®ÿ© ÿπÿ±ÿ®Ÿäÿ©', cover: 'https://via.placeholder.com/50', url: '#song2' },
                    { title: 'ÿ£ÿ∫ŸÜŸäÿ© ÿ≠ŸÖÿßÿ≥Ÿäÿ©', artist: 'ŸÅÿ±ŸÇÿ© ÿπÿßŸÑŸÖŸäÿ©', cover: 'https://via.placeholder.com/50', url: '#song3' }
                ];

                resultsContainer.innerHTML = '';
                mockResults.forEach(song => {
                    const item = document.createElement('div');
                    item.className = 'search-result-item';
                    item.innerHTML = `
                        <img src="${song.cover}" class="result-cover">
                        <div class="result-info">
                            <div class="result-title">${escapeHtml(song.title)}</div>
                            <div class="result-artist">${escapeHtml(song.artist)}</div>
                        </div>
                    `;
                    item.onclick = () => playSearchedSong(song.url, song.title);
                    resultsContainer.appendChild(item);
                });
            }, 1000);
        }

        // ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿ£ÿ∫ŸÜŸäÿ© ÿßŸÑÿ™Ÿä ÿ™ŸÖ ÿßŸÑÿ®ÿ≠ÿ´ ÿπŸÜŸáÿß
        function playSearchedSong(songUrl, songTitle) {
            // ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßŸÑÿµŸÑÿßÿ≠Ÿäÿ©
            if (!hasPermission('play_music')) {
                showNotification('Ÿáÿ∞Ÿá ÿßŸÑŸÖŸäÿ≤ÿ© ŸÖÿ™ÿßÿ≠ÿ© ŸÑŸÑÿ±ÿ™ÿ® ÿßŸÑÿπÿßŸÑŸäÿ© ŸÅŸÇÿ∑', 'error');
                return;
            }
            // ŸÖÿ≠ÿßŸÉÿßÿ© ÿßŸÑÿ™ÿ¥ÿ∫ŸäŸÑ
            const nowPlaying = document.getElementById('nowPlaying');
            nowPlaying.style.display = 'block';
            nowPlaying.classList.add('active');
            nowPlaying.querySelector('.song-title').textContent = `üé∂ ${songTitle}`;
            showNotification(`ÿ™ŸÖ ÿ™ÿ¥ÿ∫ŸäŸÑ: ${songTitle}`, 'success');
            // ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿ™ÿ¥ÿ∫ŸäŸÑ ŸÅŸä ÿ≥ÿ¨ŸÑ ÿßŸÑÿ±ŸÇÿßÿ®ÿ©
            logAuditAction('play_music', currentUser?.id, 'ÿ™ÿ¥ÿ∫ŸäŸÑ ÿ£ÿ∫ŸÜŸäÿ© ŸÖŸÜ ÿßŸÑÿ®ÿ≠ÿ´', songTitle);
        }

        // ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨
        function logout() {
            localStorage.removeItem('chatToken');
            currentUser = null;
            if (socket) {
                socket.disconnect();
                socket = null;
            }
            showLoginScreen();
            showNotification('ÿ™ŸÖ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿÆÿ±Ÿàÿ¨', 'info');
        }

        // ÿ•ÿπÿßÿØÿ© ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿµŸÅÿ≠ÿ©
        function reloadPage() {
            location.reload();
        }

        // ÿ™ÿ≠ÿØŸäÿ´ ŸÜŸÇÿßÿ∑ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ
        function updateUserCoins(amount) {
            if (currentUser) {
                currentUser.coins = (currentUser.coins || 2000) + amount;
                document.getElementById('profileCoins').textContent = currentUser.coins;
            }
        }

        // ŸÅÿ™ÿ≠ ŸÖŸÜÿ™ŸÇŸä ÿßŸÑÿ±ŸÖŸàÿ≤ ÿßŸÑÿ™ÿπÿ®Ÿäÿ±Ÿäÿ©
        function openEmojiPicker() {
            const emojis = ['üòÄ', 'üòÇ', 'üòç', 'ü•∞', 'üòé', 'ü§î', 'üò¢', 'üò°', 'üëç', 'üëé', '‚ù§Ô∏è', 'üî•', 'üíØ', 'üéâ', 'ü¶Ç'];
            const input = document.getElementById('messageInput');
            let emojiHtml = '<div style="background: white; border: 1px solid #ccc; border-radius: 8px; padding: 10px; position: absolute; z-index: 1000; display: flex; flex-wrap: wrap; gap: 5px; max-width: 200px;">';
            emojis.forEach(emoji => {
                emojiHtml += `<span style="cursor: pointer; padding: 5px; border-radius: 4px; hover: background: #f0f0f0;" onclick="addEmoji('${emoji}')">${emoji}</span>`;
            });
            emojiHtml += '</div>';
            // ÿ•ÿ∂ÿßŸÅÿ© ŸÖŸÜÿ™ŸÇŸä ÿßŸÑÿ±ŸÖŸàÿ≤ ÿ®ÿ¨ÿßŸÜÿ® ÿ≠ŸÇŸÑ ÿßŸÑÿ•ÿØÿÆÿßŸÑ
            const picker = document.createElement('div');
            picker.innerHTML = emojiHtml;
            picker.style.position = 'relative';
            input.parentNode.appendChild(picker);
            // ÿ•ÿ≤ÿßŸÑÿ© ÿßŸÑŸÖŸÜÿ™ŸÇŸä ÿ®ÿπÿØ 5 ÿ´ŸàÿßŸÜ
            setTimeout(() => {
                picker.remove();
            }, 5000);
        }

        // ÿ•ÿ∂ÿßŸÅÿ© ÿ±ŸÖÿ≤ ÿ™ÿπÿ®Ÿäÿ±Ÿä
        function addEmoji(emoji) {
            const input = document.getElementById('messageInput');
            input.value += emoji;
            input.focus();
            // ÿ•ÿ≤ÿßŸÑÿ© ŸÖŸÜÿ™ŸÇŸä ÿßŸÑÿ±ŸÖŸàÿ≤
            const picker = input.parentNode.querySelector('div');
            if (picker) picker.remove();
        }

        // ŸÅÿ™ÿ≠ ŸÖŸÜÿ™ŸÇŸä ÿßŸÑÿµŸàÿ± ÿßŸÑŸÖÿ™ÿ≠ÿ±ŸÉÿ©
        function openGifPicker() {
            showNotification('ŸÖŸÜÿ™ŸÇŸä ÿßŸÑÿµŸàÿ± ÿßŸÑŸÖÿ™ÿ≠ÿ±ŸÉÿ© ŸÇŸäÿØ ÿßŸÑÿ™ÿ∑ŸàŸäÿ±', 'info');
        }

        // ÿßŸÇÿ™ÿ®ÿßÿ≥ ÿ±ÿ≥ÿßŸÑÿ©
        function quoteMessage(messageId, author, content) {
            quotedMessage = { id: messageId, author, content };
            const quotedDiv = document.getElementById('quotedMessage');
            quotedDiv.style.display = 'flex';
            quotedDiv.querySelector('.quoted-author').textContent = author;
            quotedDiv.querySelector('.quoted-text').textContent = content.substring(0, 50) + (content.length > 50 ? '...' : '');
            document.getElementById('messageInput').focus();
        }

        // ÿ•ŸÑÿ∫ÿßÿ° ÿßŸÑÿßŸÇÿ™ÿ®ÿßÿ≥
        function cancelQuote() {
            quotedMessage = null;
            document.getElementById('quotedMessage').style.display = 'none';
        }

        // ŸÅÿ™ÿ≠ ÿµŸàÿ±ÿ© ŸÅŸä ŸÖŸàÿØÿßŸÑ
        function openImageModal(imageUrl) {
            const modal = document.createElement('div');
            modal.className = 'modal show';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 90vw; max-height: 90vh; padding: 0; background: transparent; border: none; box-shadow: none;">
                    <img src="${imageUrl}" style="width: 100%; height: 100%; object-fit: contain; border-radius: 12px;" onclick="this.parentElement.parentElement.remove()">
                </div>
            `;
            modal.onclick = (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            };
            document.body.appendChild(modal);
        }

        // ŸÖÿ≥ÿ≠ ÿßŸÑÿØÿ±ÿØÿ¥ÿ©
        async function clearChat() {
            if (!hasPermission('delete_message') && currentUser?.role !== 'owner') {
                showError('ÿ∫Ÿäÿ± ŸÖÿ≥ŸÖŸàÿ≠ - ŸÑŸÑÿ•ÿØÿßÿ±ŸäŸäŸÜ ŸÅŸÇÿ∑');
                return;
            }
            if (confirm('ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ŸÖÿ≥ÿ≠ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ±ÿ≥ÿßÿ¶ŸÑ ŸÅŸä Ÿáÿ∞Ÿá ÿßŸÑÿ∫ÿ±ŸÅÿ©ÿü')) {
                try {
                    const response = await fetch(`/api/rooms/${currentRoom}/clear`, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${localStorage.getItem('chatToken')}`
                        }
                    });
                    if (response.ok) {
                        document.getElementById('messagesContainer').innerHTML = '';
                        showNotification('ÿ™ŸÖ ŸÖÿ≥ÿ≠ ÿßŸÑÿØÿ±ÿØÿ¥ÿ© ÿ®ŸÜÿ¨ÿßÿ≠', 'success');
                    } else {
                        showError('ŸÅÿ¥ŸÑ ŸÅŸä ŸÖÿ≥ÿ≠ ÿßŸÑÿØÿ±ÿØÿ¥ÿ©');
                    }
                } catch (error) {
                    showError('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ŸÖÿ≥ÿ≠ ÿßŸÑÿØÿ±ÿØÿ¥ÿ©');
                }
            }
        }

        // ÿ•ÿ∏Ÿáÿßÿ± ÿ™ÿ®ŸàŸäÿ®ÿßÿ™ ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿØÿÆŸàŸÑ
        function showLoginTab(tabName) {
            // ÿ•ÿÆŸÅÿßÿ° ÿ¨ŸÖŸäÿπ ÿßŸÑŸÜŸÖÿßÿ∞ÿ¨
            document.querySelectorAll('.auth-form').forEach(form => {
                form.classList.remove('active');
            });
            // ÿ•ÿ≤ÿßŸÑÿ© ÿßŸÑŸÅÿ¶ÿ© ÿßŸÑŸÜÿ¥ÿ∑ÿ© ŸÖŸÜ ÿ¨ŸÖŸäÿπ ÿßŸÑÿ£ÿ≤ÿ±ÿßÿ±
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            // ÿπÿ±ÿ∂ ÿßŸÑŸÜŸÖŸàÿ∞ÿ¨ ÿßŸÑŸÖÿ≠ÿØÿØ
            document.getElementById(`${tabName}Form`).classList.add('active');
            // ÿ™ŸÅÿπŸäŸÑ ÿßŸÑÿ≤ÿ± ÿßŸÑŸÖÿ≠ÿØÿØ
            event.target.classList.add('active');
        }

        // ÿßŸÑÿ™ŸÖÿ±Ÿäÿ± ŸÑÿ£ÿ≥ŸÅŸÑ
        function scrollToBottom() {
            const container = document.getElementById('messagesContainer');
            container.scrollTop = container.scrollHeight;
        }

        // ÿ•ÿ∏Ÿáÿßÿ± ÿ±ÿ≥ÿßŸÑÿ© ÿÆÿ∑ÿ£
        function showError(message) {
            const errorDiv = document.getElementById('loginError');
            if (errorDiv) {
                errorDiv.textContent = message;
                errorDiv.classList.add('show');
                setTimeout(() => {
                    errorDiv.classList.remove('show');
                }, 5000);
            } else {
                showNotification(message, 'error');
            }
        }

        // ÿ•ÿ∏Ÿáÿßÿ± ÿ≠ÿßŸÑÿ© ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ
        function showLoading(show) {
            const spinner = document.getElementById('loadingSpinner');
            if (spinner) {
                spinner.style.display = show ? 'flex' : 'none';
            }
        }

        // ÿ•ÿ∏Ÿáÿßÿ± ÿ•ÿ¥ÿπÿßÿ±
        function showNotification(message, type = 'info') {
            const container = document.getElementById('toastContainer');
            if (!container) return;
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            container.appendChild(toast);
            // ÿ•ÿ≤ÿßŸÑÿ© ÿßŸÑÿ•ÿ¥ÿπÿßÿ± ÿ®ÿπÿØ 5 ÿ´ŸàÿßŸÜ
            setTimeout(() => {
                toast.remove();
            }, 5000);
        }

        // ÿ•ÿ¥ÿπÿßÿ± ÿ±ÿ≥ÿßŸÑÿ© ÿÆÿßÿµÿ©
        function showPrivateMessageNotification(message) {
            const notification = new Notification('ÿ±ÿ≥ÿßŸÑÿ© ÿÆÿßÿµÿ© ÿ¨ÿØŸäÿØÿ©', {
                body: `${message.display_name}: ${message.message.substring(0, 50)}...`,
                icon: 'https://images.pexels.com/photos/771742/pexels-photo-771742.jpeg?auto=compress&cs=tinysrgb&w=100&h=100&fit=crop'
            });
            notification.onclick = function() {
                window.focus();
                startPrivateChat(message.user_id, message.display_name);
                this.close();
            };
        }

        // ŸÅÿ™ÿ≠ ŸÖŸàÿØÿßŸÑ
        function openModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.add('show');
                document.body.style.overflow = 'hidden';
            }
        }

        // ÿ•ÿ∫ŸÑÿßŸÇ ŸÖŸàÿØÿßŸÑ
        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.remove('show');
                document.body.style.overflow = 'auto';
            }
        }

        // ÿ•ÿ∫ŸÑÿßŸÇ ÿ¨ŸÖŸäÿπ ÿßŸÑŸÖŸàÿØÿßŸÑÿßÿ™
        function closeAllModals() {
            document.querySelectorAll('.modal').forEach(modal => {
                modal.classList.remove('show');
            });
            document.body.style.overflow = 'auto';
        }

        // ÿ•ÿ∫ŸÑÿßŸÇ ÿ•ÿ¨ÿ±ÿßÿ°ÿßÿ™ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ
        function closeUserActionsModal() {
            closeModal('userActionsModal');
            selectedUserId = null;
        }

        // ÿ™ŸáŸäÿ¶ÿ© ÿßŸÑÿ£ÿµŸàÿßÿ™
        function initializeAudio() {
            // ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ£ÿµŸàÿßÿ™ ÿßŸÑŸÖÿ≠ŸÅŸàÿ∏ÿ©
            const soundEnabled = localStorage.getItem('soundNotifications');
            if (soundEnabled !== null) {
                document.getElementById('soundNotifications').checked = soundEnabled === 'true';
            }
            
            // ÿ∑ŸÑÿ® ÿ•ÿ∞ŸÜ ÿßŸÑÿ•ÿ¥ÿπÿßÿ±ÿßÿ™
            if (Notification.permission !== "granted") {
                Notification.requestPermission();
            }
        }

        // ÿ™ÿ¥ÿ∫ŸäŸÑ ÿµŸàÿ™ ÿßŸÑÿ•ÿ¥ÿπÿßÿ±
        function playNotificationSound() {
            const soundEnabled = document.getElementById('soundNotifications')?.checked;
            if (soundEnabled !== false) {
                const audio = document.getElementById('notificationSound');
                if (audio) {
                    audio.play().catch(() => {
                        // ÿ™ÿ¨ÿßŸáŸÑ ÿßŸÑÿ£ÿÆÿ∑ÿßÿ° ÿ•ÿ∞ÿß ŸÑŸÖ Ÿäÿ™ŸÖŸÉŸÜ ŸÖŸÜ ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿµŸàÿ™
                    });
                }
            }
        }

        // ÿ™ŸÜÿ∏ŸäŸÅ HTML
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // ŸÖÿπÿßŸÑÿ¨ ÿßŸÑÿ£ÿÆÿ∑ÿßÿ° ÿßŸÑÿπÿßŸÖÿ©
        window.addEventListener('error', function(e) {
            console.error('ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ:', e.error);
            showNotification('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ∫Ÿäÿ± ŸÖÿ™ŸàŸÇÿπ', 'error');
        });

        // ŸÖÿπÿßŸÑÿ¨ ÿßŸÑÿ£ÿÆÿ∑ÿßÿ° ÿ∫Ÿäÿ± ÿßŸÑŸÖÿπÿßŸÑÿ¨ÿ©
        window.addEventListener('unhandledrejection', function(e) {
            console.error('ÿÆÿ∑ÿ£ ÿ∫Ÿäÿ± ŸÖÿπÿßŸÑÿ¨:', e.reason);
            showNotification('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿ¥ÿ®ŸÉÿ©', 'error');
        });

        // ==================== ÿßŸÑŸÖŸäÿ≤ÿßÿ™ ÿßŸÑÿ¨ÿØŸäÿØÿ© ====================
        // ŸÖÿ™ÿ∫Ÿäÿ±ÿßÿ™ ÿßŸÑÿ•ÿ¥ÿπÿßÿ±ÿßÿ™ ŸàÿßŸÑŸÖŸäÿ≤ÿßÿ™ ÿßŸÑÿ¨ÿØŸäÿØÿ©
        let onlineUsersList = [];
        let allUsersList = [];
        let notificationsList = [];
        let privateChatMinimized = false;
        let currentPrivateChatUser = null;
        // ŸÖÿ™ÿ∫Ÿäÿ±ÿßÿ™ ŸÑŸÑŸÖŸäÿ≤ÿßÿ™ ÿßŸÑÿ¨ÿØŸäÿØÿ©
        var currentMusicPlayer = null;
        var isContestActive = false;
        var contestTimer = null;

        // Ÿàÿ∏ÿßÿ¶ŸÅ ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿµŸàÿ±
        function openImagePicker() {
            const imageInput = document.createElement('input');
            imageInput.type = 'file';
            imageInput.accept = 'image/*';
            imageInput.multiple = true;
            imageInput.onchange = function(event) {
                const files = event.target.files;
                if (files.length > 0) {
                    for (let i = 0; i < files.length; i++) {
                        uploadImage(files[i]);
                    }
                }
            };
            imageInput.click();
        }

        function uploadImage(file) {
            if (file.size > 10 * 1024 * 1024) { // 10MB limit
                alert('ÿ≠ÿ¨ŸÖ ÿßŸÑÿµŸàÿ±ÿ© ŸÉÿ®Ÿäÿ± ÿ¨ÿØÿßŸã! ÿßŸÑÿ≠ÿØ ÿßŸÑÿ£ŸÇÿµŸâ 10 ŸÖŸäÿ¨ÿßÿ®ÿßŸäÿ™');
                return;
            }
            const formData = new FormData();
            formData.append('image', file);
            formData.append('roomId', currentRoom);
            // ÿπÿ±ÿ∂ ŸÖÿ§ÿ¥ÿ± ÿßŸÑÿ™ÿ≠ŸÖŸäŸÑ
            showUploadProgress('ÿ¨ÿßÿ±Ÿä ÿ±ŸÅÿπ ÿßŸÑÿµŸàÿ±ÿ©...');
            fetch('/upload-image', {
                method: 'POST',
                headers: {
                    'Authorization': 'Bearer ' + localStorage.getItem('chatToken')
                },
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                hideUploadProgress();
                if (data.success) {
                    // ÿ•ÿ±ÿ≥ÿßŸÑ ÿ±ÿ≥ÿßŸÑÿ© ŸÖÿπ ÿ±ÿßÿ®ÿ∑ ÿßŸÑÿµŸàÿ±ÿ©
                    socket.emit('sendMessage', {
                        message: '',
                        imageUrl: data.imageUrl,
                        roomId: currentRoom,
                        type: 'image'
                    });
                } else {
                    alert('ŸÅÿ¥ŸÑ ŸÅŸä ÿ±ŸÅÿπ ÿßŸÑÿµŸàÿ±ÿ©: ' + data.message);
                }
            })
            .catch(error => {
                hideUploadProgress();
                console.error('ÿÆÿ∑ÿ£ ŸÅŸä ÿ±ŸÅÿπ ÿßŸÑÿµŸàÿ±ÿ©:', error);
                alert('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ±ŸÅÿπ ÿßŸÑÿµŸàÿ±ÿ©');
            });
        }

        function openPrivateImagePicker(receiverId) {
            const imageInput = document.createElement('input');
            imageInput.type = 'file';
            imageInput.accept = 'image/*';
            imageInput.onchange = function(event) {
                const file = event.target.files[0];
                if (file) {
                    uploadPrivateImage(file, receiverId);
                }
            };
            imageInput.click();
        }

        function uploadPrivateImage(file, receiverId) {
            if (file.size > 10 * 1024 * 1024) { 
                alert('ÿ≠ÿ¨ŸÖ ÿßŸÑÿµŸàÿ±ÿ© ŸÉÿ®Ÿäÿ± ÿ¨ÿØÿßŸã! ÿßŸÑÿ≠ÿØ ÿßŸÑÿ£ŸÇÿµŸâ 10 ŸÖŸäÿ¨ÿßÿ®ÿßŸäÿ™');
                return;
            }
            const formData = new FormData();
            formData.append('image', file);
            formData.append('receiverId', receiverId);
            showUploadProgress('ÿ¨ÿßÿ±Ÿä ÿ±ŸÅÿπ ÿßŸÑÿµŸàÿ±ÿ© ÿßŸÑÿÆÿßÿµÿ©...');
            fetch('/upload-private-image', {
                method: 'POST',
                headers: {
                    'Authorization': 'Bearer ' + localStorage.getItem('chatToken')
                },
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                hideUploadProgress();
                if (data.success) {
                    socket.emit('sendPrivateMessage', {
                        message: '',
                        imageUrl: data.imageUrl,
                        receiverId: receiverId,
                        type: 'image'
                    });
                } else {
                    alert('ŸÅÿ¥ŸÑ ŸÅŸä ÿ±ŸÅÿπ ÿßŸÑÿµŸàÿ±ÿ©: ' + data.message);
                }
            })
            .catch(error => {
                hideUploadProgress();
                console.error('ÿÆÿ∑ÿ£ ŸÅŸä ÿ±ŸÅÿπ ÿßŸÑÿµŸàÿ±ÿ© ÿßŸÑÿÆÿßÿµÿ©:', error);
                alert('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ÿ£ÿ´ŸÜÿßÿ° ÿ±ŸÅÿπ ÿßŸÑÿµŸàÿ±ÿ©');
            });
        }

        function showUploadProgress(message) {
            const progressDiv = document.createElement('div');
            progressDiv.id = 'uploadProgress';
            progressDiv.className = 'upload-progress';
            progressDiv.innerHTML = `
                <div class="upload-progress-content">
                    <div class="upload-spinner"></div>
                    <span>${message}</span>
                </div>
            `;
            document.body.appendChild(progressDiv);
        }

        function hideUploadProgress() {
            const progressDiv = document.getElementById('uploadProgress');
            if (progressDiv) {
                progressDiv.remove();
            }
        }

        // Ÿàÿ∏ÿßÿ¶ŸÅ ŸÖÿπÿßŸäŸÜÿ© ŸÅŸäÿØŸäŸà ŸäŸàÿ™ŸäŸàÿ®
        function detectAndProcessYouTubeLinks(message) {
            const youtubeRegex = /(?:https?:\/\/)?(?:www\.)?(?:youtube\.com\/watch\?v=|youtu\.be\/)([a-zA-Z0-9_-]{11})/g;
            const matches = message.match(youtubeRegex);
            if (matches) {
                matches.forEach(match => {
                    const videoId = extractYouTubeVideoId(match);
                    if (videoId) {
                        message = message.replace(match, createYouTubeEmbed(videoId));
                    }
                });
            }
            return message;
        }

        function extractYouTubeVideoId(url) {
            const regex = /(?:https?:\/\/)?(?:www\.)?(?:youtube\.com\/watch\?v=|youtu\.be\/)([a-zA-Z0-9_-]{11})/;
            const match = url.match(regex);
            return match ? match[1] : null;
        }

        function createYouTubeEmbed(videoId) {
            return `
                <div class="youtube-embed">
                    <iframe 
                        width="300" 
                        height="200" 
                        src="https://www.youtube.com/embed/${videoId}" 
                        frameborder="0" 
                        allowfullscreen>
                    </iframe>
                    <div class="youtube-info">
                        <span>üé• ŸÅŸäÿØŸäŸà ŸäŸàÿ™ŸäŸàÿ®</span>
                    </div>
                </div>
            `;
        }

        // Ÿàÿ∏ÿßÿ¶ŸÅ ÿ≠ÿ∞ŸÅ ÿßŸÑÿ±ÿ≥ÿßÿ¶ŸÑ
        function deleteMessage(messageId, messageElement) {
            if (confirm('ŸáŸÑ ÿ£ŸÜÿ™ ŸÖÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ≠ÿ∞ŸÅ Ÿáÿ∞Ÿá ÿßŸÑÿ±ÿ≥ÿßŸÑÿ©ÿü')) {
                fetch('/api/delete-message', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('chatToken')}`
                    },
                    body: JSON.stringify({ messageId: messageId })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        messageElement.innerHTML = '<em>ÿ™ŸÖ ÿ≠ÿ∞ŸÅ Ÿáÿ∞Ÿá ÿßŸÑÿ±ÿ≥ÿßŸÑÿ©</em>';
                        messageElement.classList.add('deleted-message');
                        // ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ° ŸÅŸä ÿ≥ÿ¨ŸÑ ÿßŸÑÿ±ŸÇÿßÿ®ÿ©
                        logAuditAction('delete_message', currentUser?.id, 'ÿ≠ÿ∞ŸÅ ÿ±ÿ≥ÿßŸÑÿ©', messageId);
                    } else {
                        alert('ŸÅÿ¥ŸÑ ŸÅŸä ÿ≠ÿ∞ŸÅ ÿßŸÑÿ±ÿ≥ÿßŸÑÿ©: ' + data.message);
                    }
                })
                .catch(error => {
                    console.error('ÿÆÿ∑ÿ£ ŸÅŸä ÿ≠ÿ∞ŸÅ ÿßŸÑÿ±ÿ≥ÿßŸÑÿ©:', error);
                });
            }
        }

        // Ÿàÿ∏ÿßÿ¶ŸÅ ÿßŸÑÿ∑ÿ±ÿØ ŸàÿßŸÑŸÉÿ™ŸÖ
        function kickUser(userId, userName) {
            if (!hasPermission('ban_user')) {
                showError('ÿ∫Ÿäÿ± ŸÖÿ≥ŸÖŸàÿ≠ ŸÑŸÉ ÿ®ÿ™ŸÜŸÅŸäÿ∞ Ÿáÿ∞ÿß ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ°');
                return;
            }
            if (confirm(`ŸáŸÑ ÿ™ÿ±ŸäÿØ ÿ∑ÿ±ÿØ ${userName} ŸÖŸÜ ÿßŸÑÿ∫ÿ±ŸÅÿ©ÿü`)) {
                socket.emit('kickUser', {
                    userId: userId,
                    roomId: currentRoom
                });
                // ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ° ŸÅŸä ÿ≥ÿ¨ŸÑ ÿßŸÑÿ±ŸÇÿßÿ®ÿ©
                logAuditAction('kick', userId, 'ÿ∑ÿ±ÿØ ŸÖŸÜ ÿßŸÑÿ∫ÿ±ŸÅÿ©', currentRoom);
            }
        }

        function muteUser(userId, userName) {
            if (!hasPermission('mute_user')) {
                showError('ÿ∫Ÿäÿ± ŸÖÿ≥ŸÖŸàÿ≠ ŸÑŸÉ ÿ®ÿ™ŸÜŸÅŸäÿ∞ Ÿáÿ∞ÿß ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ°');
                return;
            }
            const duration = prompt(`ŸÉŸÖ ÿØŸÇŸäŸÇÿ© ÿ™ÿ±ŸäÿØ ŸÉÿ™ŸÖ ${userName}ÿü (ÿßÿ™ÿ±ŸÉ ŸÅÿßÿ±ÿ∫ÿßŸã ŸÑŸÑŸÉÿ™ŸÖ ÿßŸÑÿØÿßÿ¶ŸÖ)`, '10');
            if (duration !== null) {
                const muteMinutes = duration === '' ? null : parseInt(duration);
                socket.emit('muteUser', {
                    userId: userId,
                    roomId: currentRoom,
                    duration: muteMinutes
                });
                // ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ° ŸÅŸä ÿ≥ÿ¨ŸÑ ÿßŸÑÿ±ŸÇÿßÿ®ÿ©
                logAuditAction('mute', userId, 'ŸÉÿ™ŸÖ ŸÅŸä ÿßŸÑÿ∫ÿ±ŸÅÿ©', `${duration} ÿØŸÇÿßÿ¶ŸÇ`);
            }
        }

        function unmuteUser(userId, userName) {
            if (!hasPermission('mute_user')) {
                showError('ÿ∫Ÿäÿ± ŸÖÿ≥ŸÖŸàÿ≠ ŸÑŸÉ ÿ®ÿ™ŸÜŸÅŸäÿ∞ Ÿáÿ∞ÿß ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ°');
                return;
            }
            if (confirm(`ŸáŸÑ ÿ™ÿ±ŸäÿØ ÿ•ŸÑÿ∫ÿßÿ° ŸÉÿ™ŸÖ ${userName}ÿü`)) {
                socket.emit('unmuteUser', {
                    userId: userId,
                    roomId: currentRoom
                });
                // ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ° ŸÅŸä ÿ≥ÿ¨ŸÑ ÿßŸÑÿ±ŸÇÿßÿ®ÿ©
                logAuditAction('unmute', userId, 'ÿ•ŸÑÿ∫ÿßÿ° ŸÉÿ™ŸÖ', currentRoom);
            }
        }

        // Ÿàÿ∏ÿßÿ¶ŸÅ ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑÿ∫ÿ±ŸÅ
        function openCreateRoomModal() {
            if (!hasPermission('create_room') && currentUser?.role !== 'owner') {
                showError('ÿ∫Ÿäÿ± ŸÖÿ≥ŸÖŸàÿ≠ - ŸÑŸÑÿ•ÿØÿßÿ±ŸäŸäŸÜ ŸÅŸÇÿ∑');
                return;
            }
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.id = 'createRoomModal';
            modal.innerHTML = `
                <div class="modal-content">
                    <span class="close" onclick="closeCreateRoomModal()">&times;</span>
                    <h2>üè† ÿ•ŸÜÿ¥ÿßÿ° ÿ∫ÿ±ŸÅÿ© ÿ¨ÿØŸäÿØÿ©</h2>
                    <div class="room-form">
                        <div class="form-group">
                            <label>ÿßÿ≥ŸÖ ÿßŸÑÿ∫ÿ±ŸÅÿ©:</label>
                            <input type="text" id="roomName" placeholder="ÿßÿØÿÆŸÑ ÿßÿ≥ŸÖ ÿßŸÑÿ∫ÿ±ŸÅÿ©" required>
                        </div>
                        <div class="form-group">
                            <label>ŸàÿµŸÅ ÿßŸÑÿ∫ÿ±ŸÅÿ©:</label>
                            <textarea id="roomDescription" placeholder="ÿßÿØÿÆŸÑ ŸàÿµŸÅ ŸÑŸÑÿ∫ÿ±ŸÅÿ©"></textarea>
                        </div>
                        <div class="form-group">
                            <label>ŸÜŸàÿπ ÿßŸÑÿ∫ÿ±ŸÅÿ©:</label>
                            <select id="roomType">
                                <option value="public">ÿπÿßŸÖÿ©</option>
                                <option value="private">ÿÆÿßÿµÿ©</option>
                                <option value="quiz">ŸÖÿ≥ÿßÿ®ŸÇÿßÿ™</option>
                                <option value="music">ŸÖŸàÿ≥ŸäŸÇŸâ</option>
                                <option value="game">ÿ£ŸÑÿπÿßÿ®</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>ÿßŸÑÿ≠ÿØ ÿßŸÑÿ£ŸÇÿµŸâ ŸÑŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ:</label>
                            <input type="number" id="maxUsers" value="50" min="2" max="200">
                        </div>
                        <div class="form-group">
                            <label>ÿµŸÑÿßÿ≠Ÿäÿßÿ™ ÿßŸÑÿØÿÆŸàŸÑ:</label>
                            <select id="roomAccessRank">
                                <option value="visitor">ÿßŸÑÿ¨ŸÖŸäÿπ</option>
                                <option value="bronze">ÿ®ÿ±ŸàŸÜÿ≤Ÿä ŸÅŸÖÿß ŸÅŸàŸÇ</option>
                                <option value="silver">ŸÅÿ∂Ÿä ŸÅŸÖÿß ŸÅŸàŸÇ</option>
                                <option value="gold">ÿ∞Ÿáÿ®Ÿä ŸÅŸÖÿß ŸÅŸàŸÇ</option>
                                <option value="diamond">ÿßŸÑŸÖÿßÿ≥ ŸÅŸÖÿß ŸÅŸàŸÇ</option>
                                <option value="moderator">ÿßŸÑŸÖÿ¥ÿ±ŸÅŸàŸÜ ŸÅŸÖÿß ŸÅŸàŸÇ</option>
                            </select>
                        </div>
                        <div class="room-actions">
                            <button onclick="createRoom()" class="btn save-btn">ÿ•ŸÜÿ¥ÿßÿ° ÿßŸÑÿ∫ÿ±ŸÅÿ©</button>
                            <button onclick="closeCreateRoomModal()" class="btn cancel-btn">ÿ•ŸÑÿ∫ÿßÿ°</button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function closeCreateRoomModal() {
            const modal = document.getElementById('createRoomModal');
            if (modal) {
                modal.remove();
            }
        }

        function createRoom() {
            const roomName = document.getElementById('roomName').value.trim();
            const roomDescription = document.getElementById('roomDescription').value.trim();
            const roomType = document.getElementById('roomType').value;
            const maxUsers = parseInt(document.getElementById('maxUsers').value);
            const accessRank = document.getElementById('roomAccessRank').value;
            if (!roomName) {
                alert('Ÿäÿ±ÿ¨Ÿâ ÿ•ÿØÿÆÿßŸÑ ÿßÿ≥ŸÖ ÿßŸÑÿ∫ÿ±ŸÅÿ©');
                return;
            }
            socket.emit('createRoom', {
                name: roomName,
                description: roomDescription,
                type: roomType,
                maxUsers: maxUsers,
                accessRank: accessRank
            });
            // ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ° ŸÅŸä ÿ≥ÿ¨ŸÑ ÿßŸÑÿ±ŸÇÿßÿ®ÿ©
            logAuditAction('create_room', currentUser?.id, 'ÿ•ŸÜÿ¥ÿßÿ° ÿ∫ÿ±ŸÅÿ© ÿ¨ÿØŸäÿØÿ©', roomName);
            closeCreateRoomModal();
        }

        // ==================== Ÿàÿ∏ÿßÿ¶ŸÅ ÿßŸÑÿ•ÿ¥ÿπÿßÿ±ÿßÿ™ ====================
        // ŸÅÿ™ÿ≠ ŸÖŸàÿØÿßŸÑ ÿ•ÿ±ÿ≥ÿßŸÑ ÿ•ÿ¥ÿπÿßÿ±
        function openSendNotificationModal() {
            if (!hasPermission('send_global_notification') && currentUser?.role !== 'owner') {
                showNotification('ÿ∫Ÿäÿ± ŸÖÿ≥ŸÖŸàÿ≠ - ŸÑŸÑÿ•ÿØÿßÿ±ŸäŸäŸÜ ŸÅŸÇÿ∑', 'error');
                return;
            }
            openModal('sendNotificationModal');
            loadUsersForNotification();
            closeMainMenu();
        }

        // ÿ•ÿ∫ŸÑÿßŸÇ ŸÖŸàÿØÿßŸÑ ÿ•ÿ±ÿ≥ÿßŸÑ ÿ•ÿ¥ÿπÿßÿ±
        function closeSendNotificationModal() {
            closeModal('sendNotificationModal');
            document.getElementById('notificationMessage').value = '';
            document.getElementById('notificationRecipient').value = '';
        }

        // ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ ŸÑŸÇÿßÿ¶ŸÖÿ© ÿßŸÑÿ•ÿ¥ÿπÿßÿ±ÿßÿ™
        async function loadUsersForNotification() {
            try {
                const response = await fetch('/api/all-users-list', {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('chatToken')}`
                    }
                });
                if (response.ok) {
                    const users = await response.json();
                    const select = document.getElementById('notificationRecipient');
                    select.innerHTML = '<option value="">ÿßÿÆÿ™ÿ± ŸÖÿ≥ÿ™ÿÆÿØŸÖ...</option>';
                    users.forEach(user => {
                        const option = document.createElement('option');
                        option.value = user.id;
                        option.textContent = `${user.display_name} (${RANKS[user.rank]?.name || 'ÿ≤ÿßÿ¶ÿ±'})`;
                        select.appendChild(option);
                    });
                }
            } catch (error) {
                console.error('ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ:', error);
            }
        }

        // ÿ•ÿ±ÿ≥ÿßŸÑ ÿ•ÿ¥ÿπÿßÿ± ŸÑŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ
        async function sendNotificationToUser() {
            const recipientId = document.getElementById('notificationRecipient').value;
            const message = document.getElementById('notificationMessage').value.trim();
            const type = document.getElementById('notificationType').value;
            if (!recipientId) {
                showNotification('Ÿäÿ±ÿ¨Ÿâ ÿßÿÆÿ™Ÿäÿßÿ± ŸÖÿ≥ÿ™ÿÆÿØŸÖ', 'warning');
                return;
            }
            if (!message) {
                showNotification('Ÿäÿ±ÿ¨Ÿâ ŸÉÿ™ÿßÿ®ÿ© ÿ±ÿ≥ÿßŸÑÿ© ÿßŸÑÿ•ÿ¥ÿπÿßÿ±', 'warning');
                return;
            }
            try {
                showLoading(true);
                const response = await fetch('/api/send-notification', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('chatToken')}`
                    },
                    body: JSON.stringify({
                        recipientId: parseInt(recipientId),
                        message,
                        type
                    })
                });
                const data = await response.json();
                if (response.ok) {
                    // ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ° ŸÅŸä ÿ≥ÿ¨ŸÑ ÿßŸÑÿ±ŸÇÿßÿ®ÿ©
                    logAuditAction('send_notification', currentUser?.id, 'ÿ•ÿ±ÿ≥ÿßŸÑ ÿ•ÿ¥ÿπÿßÿ±', `ÿ•ŸÑŸâ ${recipientId}: ${message}`);
                    showNotification('ÿ™ŸÖ ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ•ÿ¥ÿπÿßÿ± ÿ®ŸÜÿ¨ÿßÿ≠', 'success');
                    closeSendNotificationModal();
                } else {
                    showNotification(data.error || 'ŸÅÿ¥ŸÑ ŸÅŸä ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ•ÿ¥ÿπÿßÿ±', 'error');
                }
            } catch (error) {
                showNotification('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ•ÿ¥ÿπÿßÿ±', 'error');
            } finally {
                showLoading(false);
            }
        }

        // ==================== ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖÿ™ÿµŸÑŸäŸÜ ÿ≠ÿßŸÑŸäÿßŸã ====================
        // ŸÅÿ™ÿ≠ ŸÖŸàÿØÿßŸÑ ÿßŸÑŸÖÿ™ÿµŸÑŸäŸÜ ÿ≠ÿßŸÑŸäÿßŸã
        function openOnlineUsersModal() {
            openModal('onlineUsersModal');
            displayOnlineUsers();
            closeMainMenu();
        }

        // ÿ•ÿ∫ŸÑÿßŸÇ ŸÖŸàÿØÿßŸÑ ÿßŸÑŸÖÿ™ÿµŸÑŸäŸÜ ÿ≠ÿßŸÑŸäÿßŸã
        function closeOnlineUsersModal() {
            closeModal('onlineUsersModal');
        }

        // ÿπÿ±ÿ∂ ÿßŸÑŸÖÿ™ÿµŸÑŸäŸÜ ÿ≠ÿßŸÑŸäÿßŸã
        function displayOnlineUsers() {
            const container = document.getElementById('onlineUsersList');
            if (onlineUsersList.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--text-secondary); padding: 20px;">ŸÑÿß ŸäŸàÿ¨ÿØ ŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ ŸÖÿ™ÿµŸÑŸäŸÜ ÿ≠ÿßŸÑŸäÿßŸã</p>';
                return;
            }
            container.innerHTML = '';
            onlineUsersList.forEach(user => {
                if (user.userId === currentUser?.id) return; // ŸÑÿß ŸÜÿπÿ±ÿ∂ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ÿßŸÑÿ≠ÿßŸÑŸä
                const userDiv = document.createElement('div');
                userDiv.className = 'online-user-item';
                const rank = RANKS[user.rank] || RANKS.visitor;
                userDiv.innerHTML = `
                    <div class="online-user-info">
                        <div class="online-status-indicator"></div>
                        <div class="user-details">
                            <span class="user-name">${escapeHtml(user.displayName)}</span>
                            <span class="user-rank">${rank.emoji} ${rank.name}</span>
                        </div>
                    </div>
                    <div class="online-user-actions">
                        <button onclick="startPrivateChat(${user.userId}, '${escapeHtml(user.displayName)}')" class="btn btn-sm btn-primary" title="ÿØÿ±ÿØÿ¥ÿ© ÿÆÿßÿµÿ©">
                            <i class="fas fa-comment"></i>
                        </button>
                        ${hasPermission('send_global_notification') ? `
                            <button onclick="openNotificationModalForUser(${user.userId}, '${escapeHtml(user.displayName)}')" class="btn btn-sm btn-info" title="ÿ•ÿ±ÿ≥ÿßŸÑ ÿ•ÿ¥ÿπÿßÿ±">
                                <i class="fas fa-bell"></i>
                            </button>
                        ` : ''}
                    </div>
                `;
                container.appendChild(userDiv);
            });
        }

        // ÿ®ÿØÿ° ÿØÿ±ÿØÿ¥ÿ© ÿÆÿßÿµÿ©
        function startPrivateChat(userId, userName) {
            currentPrivateChatUser = { id: userId, name: userName };
            openPrivateChatBox();
            closeOnlineUsersModal();
            // ÿ™ÿ≠ÿØŸäÿ´ ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ ŸÅŸä ÿµŸÜÿØŸàŸÇ ÿßŸÑÿØÿ±ÿØÿ¥ÿ© ÿßŸÑÿÆÿßÿµÿ©
            const select = document.getElementById('privateChatUserSelect');
            select.value = userId;
            // ÿ™ÿ≠ÿØŸäÿ´ ÿπŸÜŸàÿßŸÜ ÿµŸÜÿØŸàŸÇ ÿßŸÑÿØÿ±ÿØÿ¥ÿ©
            const titleSpan = document.querySelector('.chat-box-title span');
            titleSpan.textContent = `ÿØÿ±ÿØÿ¥ÿ© ÿÆÿßÿµÿ© ŸÖÿπ ${userName}`;
            // ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ±ÿ≥ÿßÿ¶ŸÑ ÿßŸÑÿÆÿßÿµÿ©
            loadPrivateMessages(userId);
        }

        // ==================== ÿµŸÜÿØŸàŸÇ ÿßŸÑÿØÿ±ÿØÿ¥ÿ© ÿßŸÑÿÆÿßÿµÿ© ====================
        // ŸÅÿ™ÿ≠ ÿµŸÜÿØŸàŸÇ ÿßŸÑÿØÿ±ÿØÿ¥ÿ© ÿßŸÑÿÆÿßÿµÿ©
        function openPrivateChatBox() {
            const chatBox = document.getElementById('privateChatBox');
            chatBox.style.display = 'block';
            privateChatMinimized = false;
            // ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ ŸÅŸä ÿßŸÑŸÇÿßÿ¶ŸÖÿ©
            loadUsersForPrivateChat();
            closeMainMenu();
        }

        // ÿ•ÿ∫ŸÑÿßŸÇ ÿµŸÜÿØŸàŸÇ ÿßŸÑÿØÿ±ÿØÿ¥ÿ© ÿßŸÑÿÆÿßÿµÿ©
        function closePrivateChatBox() {
            const chatBox = document.getElementById('privateChatBox');
            chatBox.style.display = 'none';
            currentPrivateChatUser = null;
        }

        // ÿ™ÿµÿ∫Ÿäÿ± ÿµŸÜÿØŸàŸÇ ÿßŸÑÿØÿ±ÿØÿ¥ÿ© ÿßŸÑÿÆÿßÿµÿ©
        function minimizePrivateChatBox() {
            const chatBox = document.getElementById('privateChatBox');
            const body = chatBox.querySelector('.chat-box-body');
            if (privateChatMinimized) {
                body.style.display = 'block';
                privateChatMinimized = false;
            } else {
                body.style.display = 'none';
                privateChatMinimized = true;
            }
        }

        // ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ ŸÑŸÑÿØÿ±ÿØÿ¥ÿ© ÿßŸÑÿÆÿßÿµÿ©
        async function loadUsersForPrivateChat() {
            try {
                const response = await fetch('/api/all-users-list', {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('chatToken')}`
                    }
                });
                if (response.ok) {
                    const users = await response.json();
                    const select = document.getElementById('privateChatUserSelect');
                    select.innerHTML = '<option value="">ÿßÿÆÿ™ÿ± ŸÖÿ≥ÿ™ÿÆÿØŸÖ...</option>';
                    users.forEach(user => {
                        const option = document.createElement('option');
                        option.value = user.id;
                        option.textContent = `${user.display_name} ${user.is_online ? 'üü¢' : 'üî¥'}`;
                        select.appendChild(option);
                    });
                }
            } catch (error) {
                console.error('ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖŸäŸÜ:', error);
            }
        }

        // ÿ•ÿ±ÿ≥ÿßŸÑ ÿ±ÿ≥ÿßŸÑÿ© ÿÆÿßÿµÿ©
        function sendPrivateChatMessage() {
            const input = document.getElementById('privateChatInput');
            const userSelect = document.getElementById('privateChatUserSelect');
            const message = input.value.trim();
            const receiverId = userSelect.value;
            if (!message) {
                showNotification('Ÿäÿ±ÿ¨Ÿâ ŸÉÿ™ÿßÿ®ÿ© ÿ±ÿ≥ÿßŸÑÿ©', 'warning');
                return;
            }
            if (!receiverId) {
                showNotification('Ÿäÿ±ÿ¨Ÿâ ÿßÿÆÿ™Ÿäÿßÿ± ŸÖÿ≥ÿ™ÿÆÿØŸÖ', 'warning');
                return;
            }
            if (socket) {
                socket.emit('sendPrivateMessage', {
                    message: message,
                    receiverId: parseInt(receiverId)
                });
                input.value = '';
            }
        }

        // ÿπÿ±ÿ∂ ÿ±ÿ≥ÿßŸÑÿ© ÿÆÿßÿµÿ© ŸÅŸä ÿµŸÜÿØŸàŸÇ ÿßŸÑÿØÿ±ÿØÿ¥ÿ©
        function displayPrivateMessage(message) {
            const container = document.getElementById('privateChatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `private-message ${message.user_id === currentUser?.id ? 'own' : ''}`;
            const time = new Date(message.timestamp).toLocaleTimeString('ar-SA', {
                hour: '2-digit',
                minute: '2-digit'
            });
            messageDiv.innerHTML = `
                <div class="private-message-content">
                    <div class="private-message-header">
                        <span class="private-message-author">${escapeHtml(message.display_name)}</span>
                        <span class="private-message-time">${time}</span>
                    </div>
                    <div class="private-message-text">${escapeHtml(message.message)}</div>
                </div>
            `;
            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;
        }

        // ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ±ÿ≥ÿßÿ¶ŸÑ ÿßŸÑÿÆÿßÿµÿ©
        async function loadPrivateMessages(userId) {
            try {
                const response = await fetch(`/api/private-messages/${userId}`, {
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('chatToken')}`
                    }
                });
                if (response.ok) {
                    const messages = await response.json();
                    const container = document.getElementById('privateChatMessages');
                    container.innerHTML = '';
                    if (messages.length === 0) {
                        container.innerHTML = '<p style="text-align: center; color: var(--text-secondary); padding: 20px;">ŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ±ÿ≥ÿßÿ¶ŸÑ ÿ®ÿπÿØÿå ÿßÿ®ÿØÿ£ ÿßŸÑŸÖÿ≠ÿßÿØÿ´ÿ©!</p>';
                    } else {
                        messages.forEach(message => {
                            displayPrivateMessage(message);
                        });
                    }
                }
            } catch (error) {
                console.error('ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ±ÿ≥ÿßÿ¶ŸÑ ÿßŸÑÿÆÿßÿµÿ©:', error);
            }
        }

        // ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿ£ÿ∫ŸÜŸäÿ© ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã ŸÅŸä ÿßŸÑÿ®ÿ±ŸàŸÅÿßŸäŸÑ
        function autoPlayProfileMusic(musicUrl) {
            if (musicUrl) {
                const audio = new Audio(musicUrl);
                audio.volume = 0.3;
                audio.loop = false;
                // ŸÖÿ≠ÿßŸàŸÑÿ© ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿ£ÿ∫ŸÜŸäÿ©
                audio.play().catch(error => {
                    console.log('ŸÑÿß ŸäŸÖŸÉŸÜ ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿ£ÿ∫ŸÜŸäÿ© ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã:', error);
                    // ÿ•ÿ∂ÿßŸÅÿ© ÿ≤ÿ± ÿ™ÿ¥ÿ∫ŸäŸÑ ÿ•ÿ∞ÿß ŸÅÿ¥ŸÑ ÿßŸÑÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿ™ŸÑŸÇÿßÿ¶Ÿä
                    addManualPlayButton(audio);
                });
                return audio;
            }
        }

        function addManualPlayButton(audio) {
            const playButton = document.createElement('button');
            playButton.innerHTML = 'üéµ ÿ™ÿ¥ÿ∫ŸäŸÑ ÿßŸÑÿ£ÿ∫ŸÜŸäÿ©';
            playButton.className = 'play-music-btn';
            playButton.onclick = () => {
                audio.play();
                playButton.style.display = 'none';
            };
            const profileModal = document.querySelector('.modal.active .modal-content');
            if (profileModal) {
                profileModal.appendChild(playButton);
            }
        }

        // ÿ®ŸÑÿßÿ∫ ÿπŸÜ ÿ±ÿ≥ÿßŸÑÿ©
        function reportMessage(messageId) {
            const reason = prompt('Ÿäÿ±ÿ¨Ÿâ ŸÉÿ™ÿßÿ®ÿ© ÿ≥ÿ®ÿ® ÿßŸÑÿ®ŸÑÿßÿ∫:');
            if (reason) {
                // ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ®ŸÑÿßÿ∫ ŸÑŸÑÿ•ÿØÿßÿ±ÿ©
                socket.emit('reportMessage', {
                    messageId: messageId,
                    reporterId: currentUser?.id,
                    reason: reason
                });
                showNotification('ÿ™ŸÖ ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ®ŸÑÿßÿ∫ ŸÑŸÑÿ•ÿØÿßÿ±ÿ©', 'success');
                // ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ° ŸÅŸä ÿ≥ÿ¨ŸÑ ÿßŸÑÿ±ŸÇÿßÿ®ÿ©
                logAuditAction('report_message', currentUser?.id, reason, messageId);
            }
        }

        // ÿ•ÿ¥ÿπÿßÿ± ÿ≠ŸàŸÑ ÿ±ÿ≥ÿßŸÑÿ©
        function notifyAboutMessage(messageId, author) {
            const message = prompt('ÿßŸÉÿ™ÿ® ÿ±ÿ≥ÿßŸÑÿ© ÿßŸÑÿ•ÿ¥ÿπÿßÿ±:');
            if (message) {
                socket.emit('notifyAboutMessage', {
                    messageId: messageId,
                    senderId: currentUser?.id,
                    message: message,
                    author: author
                });
                showNotification('ÿ™ŸÖ ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ•ÿ¥ÿπÿßÿ±', 'success');
            }
        }

        // ŸÅÿ™ÿ≠ ŸÖŸàÿØÿßŸÑ ÿ•ÿ±ÿ≥ÿßŸÑ ÿ•ÿ¥ÿπÿßÿ± ŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ŸÖÿ≠ÿØÿØ ŸÖŸÜ ŸÇÿßÿ¶ŸÖÿ© ÿßŸÑŸÖÿ™ÿµŸÑŸäŸÜ
        function openNotificationModalForUser(userId, userName) {
            if (!hasPermission('send_global_notification')) {
                showError('ÿ∫Ÿäÿ± ŸÖÿ≥ŸÖŸàÿ≠ ŸÑŸÉ ÿ®ÿ™ŸÜŸÅŸäÿ∞ Ÿáÿ∞ÿß ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ°');
                return;
            }
            document.getElementById('notificationRecipient').value = userId;
            openSendNotificationModal();
        }

        // ÿ™ÿ≥ÿ¨ŸäŸÑ ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ° ŸÅŸä ÿ≥ÿ¨ŸÑ ÿßŸÑÿ±ŸÇÿßÿ®ÿ©
        function logAuditAction(action, targetUserId, reason, details = null) {
            const auditLog = {
                timestamp: new Date().toISOString(),
                adminId: currentUser?.id,
                adminName: currentUser?.display_name,
                action: action,
                targetUserId: targetUserId,
                reason: reason,
                details: details
            };

            // ÿ•ÿ∂ÿßŸÅÿ© ÿ•ŸÑŸâ ŸÇÿßÿ¶ŸÖÿ© ÿ≥ÿ¨ŸÑ ÿßŸÑÿ±ŸÇÿßÿ®ÿ© ŸÅŸä ÿßŸÑÿ∞ÿßŸÉÿ±ÿ©
            let auditLogs = JSON.parse(localStorage.getItem('auditLogs') || '[]');
            auditLogs.push(auditLog);
            localStorage.setItem('auditLogs', JSON.stringify(auditLogs));

            // ÿ™ÿ≠ÿØŸäÿ´ Ÿàÿßÿ¨Ÿáÿ© ÿ≥ÿ¨ŸÑ ÿßŸÑÿ±ŸÇÿßÿ®ÿ© ÿ•ÿ∞ÿß ŸÉÿßŸÜÿ™ ŸÖŸÅÿ™Ÿàÿ≠ÿ©
            updateAuditLogDisplay();
        }

        // ÿ™ÿ≠ÿØŸäÿ´ ÿπÿ±ÿ∂ ÿ≥ÿ¨ŸÑ ÿßŸÑÿ±ŸÇÿßÿ®ÿ©
        function updateAuditLogDisplay() {
            const auditLogList = document.getElementById('auditLogList');
            if (!auditLogList) return;

            const logs = JSON.parse(localStorage.getItem('auditLogs') || '[]');
            auditLogList.innerHTML = '';

            logs.reverse().forEach(log => {
                const item = document.createElement('div');
                item.className = 'audit-item';
                item.innerHTML = `
                    <span class="timestamp">[${new Date(log.timestamp).toLocaleString('ar-SA')}]</span>
                    <span class="admin">[ÿßŸÑŸÖÿ¥ÿ±ŸÅ: ${log.adminName}]</span>
                    <span class="action">${getActionText(log.action)} ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ [${log.targetUserId}] ÿ®ÿ≥ÿ®ÿ® [${log.reason}] ${log.details ? `(${log.details})` : ''}</span>
                `;
                auditLogList.appendChild(item);
            });
        }

        // ÿßŸÑÿ≠ÿµŸàŸÑ ÿπŸÑŸâ ŸÜÿµ ÿßŸÑÿ•ÿ¨ÿ±ÿßÿ°
        function getActionText(action) {
            const actions = {
                'ban': 'ÿ≠ÿ∏ÿ±',
                'mute': 'ŸÉÿ™ŸÖ',
                'kick': 'ÿ∑ÿ±ÿØ',
                'assign_rank': 'ÿ™ÿπŸäŸäŸÜ ÿ±ÿ™ÿ®ÿ©',
                'give_coins': 'ÿ•ÿπÿ∑ÿßÿ° ŸÜŸÇÿßÿ∑',
                'create_room': 'ÿ•ŸÜÿ¥ÿßÿ° ÿ∫ÿ±ŸÅÿ©',
                'delete_message': 'ÿ≠ÿ∞ŸÅ ÿ±ÿ≥ÿßŸÑÿ©',
                'send_notification': 'ÿ•ÿ±ÿ≥ÿßŸÑ ÿ•ÿ¥ÿπÿßÿ±',
                'play_music': 'ÿ™ÿ¥ÿ∫ŸäŸÑ ŸÖŸàÿ≥ŸäŸÇŸâ',
                'report_message': 'ÿ®ŸÑÿßÿ∫ ÿπŸÜ ÿ±ÿ≥ÿßŸÑÿ©'
            };
            return actions[action] || action;
        }

        // ÿ™ÿ≠ŸÖŸäŸÑ ÿ≥ÿ¨ŸÑ ÿßŸÑÿ±ŸÇÿßÿ®ÿ©
        function loadAuditLog() {
            updateAuditLogDisplay();
        }
    </script>
</body>
</html>
